---
title: 企业商业智能
titleSuffix: Azure Reference Architectures
description: 使用 Azure 从本地存储的关系数据获取业务见解。
author: MikeWasson
ms.date: 11/06/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18
ms.openlocfilehash: 14adb9de7f46c3196e893451859385d87212b375
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54482374"
---
# <a name="enterprise-bi-in-azure-with-sql-data-warehouse"></a><span data-ttu-id="03dbb-103">将 Azure 中的 Enterprise BI 与 SQL 数据仓库配合使用</span><span class="sxs-lookup"><span data-stu-id="03dbb-103">Enterprise BI in Azure with SQL Data Warehouse</span></span>

<span data-ttu-id="03dbb-104">此参考体系结构实现[提取、加载和转换 (ELT)](../../data-guide/relational-data/etl.md#extract-load-and-transform-elt) 管道，该管道可将数据从本地 SQL Server 数据库移到 SQL 数据仓库，并转换数据以进行分析。</span><span class="sxs-lookup"><span data-stu-id="03dbb-104">This reference architecture implements an [extract, load, and transform (ELT)](../../data-guide/relational-data/etl.md#extract-load-and-transform-elt) pipeline that moves data from an on-premises SQL Server database into SQL Data Warehouse and transforms the data for analysis.</span></span>

<span data-ttu-id="03dbb-105">[GitHub][github-folder] 中提供了本体系结构的参考实现。</span><span class="sxs-lookup"><span data-stu-id="03dbb-105">A reference implementation for this architecture is available on [GitHub][github-folder].</span></span>

![将 Azure 中的企业 BI 与 SQL 数据仓库配合使用的体系结构图](./images/enterprise-bi-sqldw.png)

<span data-ttu-id="03dbb-107">**场景**：某个组织在本地的 SQL Server 数据库中存储了大型 OLTP 数据集。</span><span class="sxs-lookup"><span data-stu-id="03dbb-107">**Scenario**: An organization has a large OLTP data set stored in a SQL Server database on premises.</span></span> <span data-ttu-id="03dbb-108">该组织想要使用 SQL 数据仓库通过 Power BI 执行分析。</span><span class="sxs-lookup"><span data-stu-id="03dbb-108">The organization wants to use SQL Data Warehouse to perform analysis using Power BI.</span></span>

<span data-ttu-id="03dbb-109">此参考体系结构是针对一次性或按需作业设计的。</span><span class="sxs-lookup"><span data-stu-id="03dbb-109">This reference architecture is designed for one-time or on-demand jobs.</span></span> <span data-ttu-id="03dbb-110">如果需要持续移动数据（每小时或每日），我们建议使用 Azure 数据工厂来定义自动化工作流。</span><span class="sxs-lookup"><span data-stu-id="03dbb-110">If you need to move data on a continuing basis (hourly or daily), we recommend using Azure Data Factory to define an automated workflow.</span></span> <span data-ttu-id="03dbb-111">如需使用数据工厂的参考体系结构，请参阅[将自动化企业 BI 与 SQL 数据仓库和 Azure 数据工厂配合使用][adf-ra]。</span><span class="sxs-lookup"><span data-stu-id="03dbb-111">For a reference architecture that uses Data Factory, see [Automated enterprise BI with SQL Data Warehouse and Azure Data Factory][adf-ra].</span></span>

## <a name="architecture"></a><span data-ttu-id="03dbb-112">体系结构</span><span class="sxs-lookup"><span data-stu-id="03dbb-112">Architecture</span></span>

<span data-ttu-id="03dbb-113">该体系结构包括以下组件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-113">The architecture consists of the following components.</span></span>

### <a name="data-source"></a><span data-ttu-id="03dbb-114">数据源</span><span class="sxs-lookup"><span data-stu-id="03dbb-114">Data source</span></span>

<span data-ttu-id="03dbb-115">**SQL Server**。</span><span class="sxs-lookup"><span data-stu-id="03dbb-115">**SQL Server**.</span></span> <span data-ttu-id="03dbb-116">源数据位于本地的 SQL Server 数据库中。</span><span class="sxs-lookup"><span data-stu-id="03dbb-116">The source data is located in a SQL Server database on premises.</span></span> <span data-ttu-id="03dbb-117">为了模拟本地环境，此体系结构的部署脚本将在 Azure 中预配一个装有 SQL Server 的 VM。</span><span class="sxs-lookup"><span data-stu-id="03dbb-117">To simulate the on-premises environment, the deployment scripts for this architecture provision a VM in Azure with SQL Server installed.</span></span> <span data-ttu-id="03dbb-118">[Wide World Importers OLTP 示例数据库][wwi]用作源数据库。</span><span class="sxs-lookup"><span data-stu-id="03dbb-118">The [Wide World Importers OLTP sample database][wwi] is used as the source data.</span></span>

### <a name="ingestion-and-data-storage"></a><span data-ttu-id="03dbb-119">引入和数据存储</span><span class="sxs-lookup"><span data-stu-id="03dbb-119">Ingestion and data storage</span></span>

<span data-ttu-id="03dbb-120">**Blob 存储**。</span><span class="sxs-lookup"><span data-stu-id="03dbb-120">**Blob Storage**.</span></span> <span data-ttu-id="03dbb-121">Blob 存储用作临时区域，在将数据载入 SQL 数据仓库之前，会先将数据复制到该区域。</span><span class="sxs-lookup"><span data-stu-id="03dbb-121">Blob storage is used as a staging area to copy the data before loading it into SQL Data Warehouse.</span></span>

<span data-ttu-id="03dbb-122">**Azure SQL 数据仓库**。</span><span class="sxs-lookup"><span data-stu-id="03dbb-122">**Azure SQL Data Warehouse**.</span></span> <span data-ttu-id="03dbb-123">[SQL 数据仓库](/azure/sql-data-warehouse/)是分布式系统，旨在对大型数据执行分析。</span><span class="sxs-lookup"><span data-stu-id="03dbb-123">[SQL Data Warehouse](/azure/sql-data-warehouse/) is a distributed system designed to perform analytics on large data.</span></span> <span data-ttu-id="03dbb-124">它支持大规模并行处理 (MPP)，因此很适合用于运行高性能分析。</span><span class="sxs-lookup"><span data-stu-id="03dbb-124">It supports massive parallel processing (MPP), which makes it suitable for running high-performance analytics.</span></span>

### <a name="analysis-and-reporting"></a><span data-ttu-id="03dbb-125">分析和报告</span><span class="sxs-lookup"><span data-stu-id="03dbb-125">Analysis and reporting</span></span>

<span data-ttu-id="03dbb-126">**Azure Analysis Services**。</span><span class="sxs-lookup"><span data-stu-id="03dbb-126">**Azure Analysis Services**.</span></span> <span data-ttu-id="03dbb-127">[Analysis Services](/azure/analysis-services/) 是提供数据建模功能的完全托管服务。</span><span class="sxs-lookup"><span data-stu-id="03dbb-127">[Analysis Services](/azure/analysis-services/) is a fully managed service that provides data modeling capabilities.</span></span> <span data-ttu-id="03dbb-128">使用 Analysis Services 能够创建用户可查询的语义模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-128">Use Analysis Services to create a semantic model that users can query.</span></span> <span data-ttu-id="03dbb-129">Analysis Services 在 BI 仪表板场景中尤其有用。</span><span class="sxs-lookup"><span data-stu-id="03dbb-129">Analysis Services is especially useful in a BI dashboard scenario.</span></span> <span data-ttu-id="03dbb-130">在此体系结构中，Analysis Services 从数据仓库读取数据以处理语义模型，并有效地为仪表板查询提供服务。</span><span class="sxs-lookup"><span data-stu-id="03dbb-130">In this architecture, Analysis Services reads data from the data warehouse to process the semantic model, and efficiently serves dashboard queries.</span></span> <span data-ttu-id="03dbb-131">它还通过横向扩展副本来加快查询处理的速度，以支持弹性并发性。</span><span class="sxs-lookup"><span data-stu-id="03dbb-131">It also supports elastic concurrency, by scaling out replicas for faster query processing.</span></span>

<span data-ttu-id="03dbb-132">目前，Azure Analysis Services 支持表格模型，但不支持多维模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-132">Currently, Azure Analysis Services supports tabular models but not multidimensional models.</span></span> <span data-ttu-id="03dbb-133">表格模型使用关系建模构造（表和列），而多维模型使用 OLAP 建模构造（多维数据集、维度和度量值）。</span><span class="sxs-lookup"><span data-stu-id="03dbb-133">Tabular models use relational modeling constructs (tables and columns), whereas multidimensional models use OLAP modeling constructs (cubes, dimensions, and measures).</span></span> <span data-ttu-id="03dbb-134">如果需要多维模型，请使用 SQL Server Analysis Services (SSAS)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-134">If you require multidimensional models, use SQL Server Analysis Services (SSAS).</span></span> <span data-ttu-id="03dbb-135">有关详细信息，请参阅[表格和多维解决方案的比较](/sql/analysis-services/comparing-tabular-and-multidimensional-solutions-ssas)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-135">For more information, see [Comparing tabular and multidimensional solutions](/sql/analysis-services/comparing-tabular-and-multidimensional-solutions-ssas).</span></span>

<span data-ttu-id="03dbb-136">**Power BI**。</span><span class="sxs-lookup"><span data-stu-id="03dbb-136">**Power BI**.</span></span> <span data-ttu-id="03dbb-137">Power BI 是一套商业分析工具，用于分析数据以获取商业见解。</span><span class="sxs-lookup"><span data-stu-id="03dbb-137">Power BI is a suite of business analytics tools to analyze data for business insights.</span></span> <span data-ttu-id="03dbb-138">在此体系结构中，Power BI 查询 Analysis Services 中存储的语义模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-138">In this architecture, it queries the semantic model stored in Analysis Services.</span></span>

### <a name="authentication"></a><span data-ttu-id="03dbb-139">身份验证</span><span class="sxs-lookup"><span data-stu-id="03dbb-139">Authentication</span></span>

<span data-ttu-id="03dbb-140">**Azure Active Directory (Azure AD)** 通过 Power BI 对连接到 Analysis Services 服务器的用户进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="03dbb-140">**Azure Active Directory (Azure AD)** authenticates users who connect to the Analysis Services server through Power BI.</span></span>

## <a name="data-pipeline"></a><span data-ttu-id="03dbb-141">数据管道</span><span class="sxs-lookup"><span data-stu-id="03dbb-141">Data pipeline</span></span>

<span data-ttu-id="03dbb-142">此参考体系结构使用 [WorldWideImporters](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) 示例数据库作为数据源。</span><span class="sxs-lookup"><span data-stu-id="03dbb-142">This reference architecture uses the [WorldWideImporters](/sql/sample/world-wide-importers/wide-world-importers-oltp-database) sample database as a data source.</span></span> <span data-ttu-id="03dbb-143">数据管道具有以下阶段：</span><span class="sxs-lookup"><span data-stu-id="03dbb-143">The data pipeline has the following stages:</span></span>

1. <span data-ttu-id="03dbb-144">将数据从 SQL Server 导出到平面文件（bcp 实用工具）。</span><span class="sxs-lookup"><span data-stu-id="03dbb-144">Export the data from SQL Server to flat files (bcp utility).</span></span>
2. <span data-ttu-id="03dbb-145">将平面文件复制到 Azure Blob 存储 (AzCopy)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-145">Copy the flat files to Azure Blob Storage (AzCopy).</span></span>
3. <span data-ttu-id="03dbb-146">将数据载入 SQL 数据仓库 (PolyBase)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-146">Load the data into SQL Data Warehouse (PolyBase).</span></span>
4. <span data-ttu-id="03dbb-147">将数据转换为星型架构 (T-SQL)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-147">Transform the data into a star schema (T-SQL).</span></span>
5. <span data-ttu-id="03dbb-148">将语义模型载入 Analysis Services (SQL Server Data Tools)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-148">Load a semantic model into Analysis Services (SQL Server Data Tools).</span></span>

![企业 BI 管道图](./images/enterprise-bi-sqldw-pipeline.png)

> [!NOTE]
> <span data-ttu-id="03dbb-150">对于步骤 1 &ndash; 3，请考虑使用 Redgate Data Platform Studio。</span><span class="sxs-lookup"><span data-stu-id="03dbb-150">For steps 1 &ndash; 3, consider using Redgate Data Platform Studio.</span></span> <span data-ttu-id="03dbb-151">Data Platform Studio 应用了适当的兼容性修补程序和优化措施，可以快速启动 SQL 数据仓库操作。</span><span class="sxs-lookup"><span data-stu-id="03dbb-151">Data Platform Studio applies the most appropriate compatibility fixes and optimizations, so it's the quickest way to get started with SQL Data Warehouse.</span></span> <span data-ttu-id="03dbb-152">有关详细信息，请参阅[使用 Redgate Data Platform Studio 加载数据](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-152">For more information, see [Load data with Redgate Data Platform Studio](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate).</span></span>
>

<span data-ttu-id="03dbb-153">后续部分将会更详细地介绍这些阶段。</span><span class="sxs-lookup"><span data-stu-id="03dbb-153">The next sections describe these stages in more detail.</span></span>

### <a name="export-data-from-sql-server"></a><span data-ttu-id="03dbb-154">从 SQL Server 导出数据</span><span class="sxs-lookup"><span data-stu-id="03dbb-154">Export data from SQL Server</span></span>

<span data-ttu-id="03dbb-155">使用 [bcp](/sql/tools/bcp-utility)（批量复制程序）实用工具可以从 SQL 表快速创建平面文本文件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-155">The [bcp](/sql/tools/bcp-utility) (bulk copy program) utility is a fast way to create flat text files from SQL tables.</span></span> <span data-ttu-id="03dbb-156">在此步骤中，请选择想要导出的列，但不要转换数据。</span><span class="sxs-lookup"><span data-stu-id="03dbb-156">In this step, you select the columns that you want to export, but don't transform the data.</span></span> <span data-ttu-id="03dbb-157">所有数据转换应在 SQL 数据仓库中进行。</span><span class="sxs-lookup"><span data-stu-id="03dbb-157">Any data transformations should happen in SQL Data Warehouse.</span></span>

<span data-ttu-id="03dbb-158">**建议：**</span><span class="sxs-lookup"><span data-stu-id="03dbb-158">**Recommendations:**</span></span>

<span data-ttu-id="03dbb-159">请尽量将数据提取安排在非高峰期，以最大程度地减少生产环境中的资源争用情况。</span><span class="sxs-lookup"><span data-stu-id="03dbb-159">If possible, schedule data extraction during off-peak hours, to minimize resource contention in the production environment.</span></span>

<span data-ttu-id="03dbb-160">避免在数据库服务器上运行 bcp，</span><span class="sxs-lookup"><span data-stu-id="03dbb-160">Avoid running bcp on the database server.</span></span> <span data-ttu-id="03dbb-161">应该从另一台计算机运行 bcp。</span><span class="sxs-lookup"><span data-stu-id="03dbb-161">Instead, run it from another machine.</span></span> <span data-ttu-id="03dbb-162">将文件写入本地驱动器。</span><span class="sxs-lookup"><span data-stu-id="03dbb-162">Write the files to a local drive.</span></span> <span data-ttu-id="03dbb-163">确保有足够的 I/O 资源用于处理并发写入。</span><span class="sxs-lookup"><span data-stu-id="03dbb-163">Ensure that you have sufficient I/O resources to handle the concurrent writes.</span></span> <span data-ttu-id="03dbb-164">为获得最佳性能，请将文件导出到专用的高速存储驱动器。</span><span class="sxs-lookup"><span data-stu-id="03dbb-164">For best performance, export the files to dedicated fast storage drives.</span></span>

<span data-ttu-id="03dbb-165">以 Gzip 压缩格式保存导出的数据可以加速网络传输。</span><span class="sxs-lookup"><span data-stu-id="03dbb-165">You can speed up the network transfer by saving the exported data in Gzip compressed format.</span></span> <span data-ttu-id="03dbb-166">但是，将压缩文件载入仓库的速度比加载非压缩文件要慢，因此，加快网络传输速度与加快加载速度之间各有利弊。</span><span class="sxs-lookup"><span data-stu-id="03dbb-166">However, loading compressed files into the warehouse is slower than loading uncompressed files, so there is a tradeoff between faster network transfer versus faster loading.</span></span> <span data-ttu-id="03dbb-167">如果决定使用 Gzip 压缩，请不要创建单个 Gzip 文件，</span><span class="sxs-lookup"><span data-stu-id="03dbb-167">If you decide to use Gzip compression, don't create a single Gzip file.</span></span> <span data-ttu-id="03dbb-168">而是将数据拆分为多个压缩文件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-168">Instead, split the data into multiple compressed files.</span></span>

### <a name="copy-flat-files-into-blob-storage"></a><span data-ttu-id="03dbb-169">将平面文件复制到 Blob 存储中</span><span class="sxs-lookup"><span data-stu-id="03dbb-169">Copy flat files into blob storage</span></span>

<span data-ttu-id="03dbb-170">[AzCopy](/azure/storage/common/storage-use-azcopy) 实用工具旨在以较高的性能将数据复制到 Azure Blob 存储。</span><span class="sxs-lookup"><span data-stu-id="03dbb-170">The [AzCopy](/azure/storage/common/storage-use-azcopy) utility is designed for high-performance copying of data into Azure blob storage.</span></span>

<span data-ttu-id="03dbb-171">**建议：**</span><span class="sxs-lookup"><span data-stu-id="03dbb-171">**Recommendations:**</span></span>

<span data-ttu-id="03dbb-172">在靠近源数据位置的区域中创建存储帐户。</span><span class="sxs-lookup"><span data-stu-id="03dbb-172">Create the storage account in a region near the location of the source data.</span></span> <span data-ttu-id="03dbb-173">在同一区域中部署存储帐户和 SQL 数据仓库实例。</span><span class="sxs-lookup"><span data-stu-id="03dbb-173">Deploy the storage account and the SQL Data Warehouse instance in the same region.</span></span>

<span data-ttu-id="03dbb-174">不要在运行生产工作负荷的同一台计算机上运行 AzCopy，因为 CPU 和 I/O 消耗可能会干扰生产工作负荷。</span><span class="sxs-lookup"><span data-stu-id="03dbb-174">Don't run AzCopy on the same machine that runs your production workloads, because the CPU and I/O consumption can interfere with the production workload.</span></span>

<span data-ttu-id="03dbb-175">首先测试上传，以确定大致的上传速度。</span><span class="sxs-lookup"><span data-stu-id="03dbb-175">Test the upload first to see what the upload speed is like.</span></span> <span data-ttu-id="03dbb-176">可以在 AzCopy 中使用 /NC 选项来指定并发复制操作的数目。</span><span class="sxs-lookup"><span data-stu-id="03dbb-176">You can use the /NC option in AzCopy to specify the number of concurrent copy operations.</span></span> <span data-ttu-id="03dbb-177">使用默认值启动，然后使用此设置进行试验，以优化性能。</span><span class="sxs-lookup"><span data-stu-id="03dbb-177">Start with the default value, then experiment with this setting to tune the performance.</span></span> <span data-ttu-id="03dbb-178">在低带宽环境中，过多的并发操作可能会使网络连接瘫痪，并导致操作无法彻底完成。</span><span class="sxs-lookup"><span data-stu-id="03dbb-178">In a low-bandwidth environment, too many concurrent operations can overwhelm the network connection and prevent the operations from completing successfully.</span></span>

<span data-ttu-id="03dbb-179">AzCopy 通过公共 Internet 将数据移到存储中。</span><span class="sxs-lookup"><span data-stu-id="03dbb-179">AzCopy moves data to storage over the public internet.</span></span> <span data-ttu-id="03dbb-180">如果速度不够快，请考虑设置 [ExpressRoute](/azure/expressroute/) 线路。</span><span class="sxs-lookup"><span data-stu-id="03dbb-180">If this isn't fast enough, consider setting up an [ExpressRoute](/azure/expressroute/) circuit.</span></span> <span data-ttu-id="03dbb-181">ExpressRoute 是通过专用连接将数据路由到 Azure 的服务。</span><span class="sxs-lookup"><span data-stu-id="03dbb-181">ExpressRoute is a service that routes your data through a dedicated private connection to Azure.</span></span> <span data-ttu-id="03dbb-182">如果网络连接速度太慢，可以采用另一种做法，即以物理方式将磁盘上的数据传送到 Azure 数据中心。</span><span class="sxs-lookup"><span data-stu-id="03dbb-182">Another option, if your network connection is too slow, is to physically ship the data on disk to an Azure datacenter.</span></span> <span data-ttu-id="03dbb-183">有关详细信息，请参阅[将数据传入和传出 Azure](/azure/architecture/data-guide/scenarios/data-transfer)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-183">For more information, see [Transferring data to and from Azure](/azure/architecture/data-guide/scenarios/data-transfer).</span></span>

<span data-ttu-id="03dbb-184">在执行复制操作期间，AzCopy 将创建一个临时日记文件，使 AzCopy 在操作中断（例如，由于网络错误）时重启操作。</span><span class="sxs-lookup"><span data-stu-id="03dbb-184">During a copy operation, AzCopy creates a temporary journal file, which enables AzCopy to restart the operation if it gets interrupted (for example, due to a network error).</span></span> <span data-ttu-id="03dbb-185">确保有足够的磁盘空间用于存储日记文件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-185">Make sure there is enough disk space to store the journal files.</span></span> <span data-ttu-id="03dbb-186">可以使用 /Z 选项指定日记文件的写入位置。</span><span class="sxs-lookup"><span data-stu-id="03dbb-186">You can use the /Z option to specify where the journal files are written.</span></span>

### <a name="load-data-into-sql-data-warehouse"></a><span data-ttu-id="03dbb-187">将数据载入 SQL 数据仓库</span><span class="sxs-lookup"><span data-stu-id="03dbb-187">Load data into SQL Data Warehouse</span></span>

<span data-ttu-id="03dbb-188">使用 [PolyBase](/sql/relational-databases/polybase/polybase-guide) 将文件从 Blob 存储载入数据仓库。</span><span class="sxs-lookup"><span data-stu-id="03dbb-188">Use [PolyBase](/sql/relational-databases/polybase/polybase-guide) to load the files from blob storage into the data warehouse.</span></span> <span data-ttu-id="03dbb-189">PolyBase 利用 SQL 数据仓库的 MPP（大规模并行处理）体系结构，因此是将数据载入 Azure SQL 数据仓库的最快方式。</span><span class="sxs-lookup"><span data-stu-id="03dbb-189">PolyBase is designed to leverage the MPP (Massively Parallel Processing) architecture of SQL Data Warehouse, which makes it the fastest way to load data into SQL Data Warehouse.</span></span>

<span data-ttu-id="03dbb-190">加载数据的过程包括两个步骤：</span><span class="sxs-lookup"><span data-stu-id="03dbb-190">Loading the data is a two-step process:</span></span>

1. <span data-ttu-id="03dbb-191">为数据创建一组外部表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-191">Create a set of external tables for the data.</span></span> <span data-ttu-id="03dbb-192">外部表是指向仓库外部存储的数据（在本例中，为 Blob 存储中的平面文件）的表定义。</span><span class="sxs-lookup"><span data-stu-id="03dbb-192">An external table is a table definition that points to data stored outside of the warehouse &mdash; in this case, the flat files in blob storage.</span></span> <span data-ttu-id="03dbb-193">此步骤不会将任何数据移入仓库。</span><span class="sxs-lookup"><span data-stu-id="03dbb-193">This step does not move any data into the warehouse.</span></span>
2. <span data-ttu-id="03dbb-194">创建临时表，并将数据载入临时表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-194">Create staging tables, and load the data into the staging tables.</span></span> <span data-ttu-id="03dbb-195">此步骤将数据复制到仓库中。</span><span class="sxs-lookup"><span data-stu-id="03dbb-195">This step copies the data into the warehouse.</span></span>

<span data-ttu-id="03dbb-196">**建议：**</span><span class="sxs-lookup"><span data-stu-id="03dbb-196">**Recommendations:**</span></span>

<span data-ttu-id="03dbb-197">如果有大量的数据（超过 1 TB），并在运行受益于并行度的分析工作负荷，请考虑使用 SQL 数据仓库。</span><span class="sxs-lookup"><span data-stu-id="03dbb-197">Consider SQL Data Warehouse when you have large amounts of data (more than 1 TB) and are running an analytics workload that will benefit from parallelism.</span></span> <span data-ttu-id="03dbb-198">SQL 数据仓库并不很适合 OLTP 工作负荷或较小的数据集（小于 250 GB）。</span><span class="sxs-lookup"><span data-stu-id="03dbb-198">SQL Data Warehouse is not a good fit for OLTP workloads or smaller data sets (< 250GB).</span></span> <span data-ttu-id="03dbb-199">对于小于 250 GB 的数据集，请考虑使用 Azure SQL 数据库或 SQL Server。</span><span class="sxs-lookup"><span data-stu-id="03dbb-199">For data sets less than 250GB, consider Azure SQL Database or SQL Server.</span></span> <span data-ttu-id="03dbb-200">有关详细信息，请参阅[数据仓库](../../data-guide/relational-data/data-warehousing.md)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-200">For more information, see [Data warehousing](../../data-guide/relational-data/data-warehousing.md).</span></span>

<span data-ttu-id="03dbb-201">将临时表创建为未编制索引的堆表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-201">Create the staging tables as heap tables, which are not indexed.</span></span> <span data-ttu-id="03dbb-202">创建生产表的查询将导致全表扫描，因此没有理由为临时表编制索引。</span><span class="sxs-lookup"><span data-stu-id="03dbb-202">The queries that create the production tables will result in a full table scan, so there is no reason to index the staging tables.</span></span>

<span data-ttu-id="03dbb-203">PolyBase 自动利用仓库中的并行度。</span><span class="sxs-lookup"><span data-stu-id="03dbb-203">PolyBase automatically takes advantage of parallelism in the warehouse.</span></span> <span data-ttu-id="03dbb-204">负载性能会随着 DWU 的增加而扩展。</span><span class="sxs-lookup"><span data-stu-id="03dbb-204">The load performance scales as you increase DWUs.</span></span> <span data-ttu-id="03dbb-205">为获得最佳性能，请使用单个加载操作。</span><span class="sxs-lookup"><span data-stu-id="03dbb-205">For best performance, use a single load operation.</span></span> <span data-ttu-id="03dbb-206">将输入数据分解为区块和运行多个并发负载不会带来任何性能优势。</span><span class="sxs-lookup"><span data-stu-id="03dbb-206">There is no performance benefit to breaking the input data into chunks and running multiple concurrent loads.</span></span>

<span data-ttu-id="03dbb-207">PolyBase 可以读取 Gzip 压缩文件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-207">PolyBase can read Gzip compressed files.</span></span> <span data-ttu-id="03dbb-208">但是，只会对每个压缩文件使用单个读取器，因为解压缩文件是单线程操作。</span><span class="sxs-lookup"><span data-stu-id="03dbb-208">However, only a single reader is used per compressed file, because uncompressing the file is a single-threaded operation.</span></span> <span data-ttu-id="03dbb-209">因此，请避免加载单个大型压缩文件。</span><span class="sxs-lookup"><span data-stu-id="03dbb-209">Therefore, avoid loading a single large compressed file.</span></span> <span data-ttu-id="03dbb-210">应该将数据拆分为多个压缩文件，以利用并行度。</span><span class="sxs-lookup"><span data-stu-id="03dbb-210">Instead, split the data into multiple compressed files, in order to take advantage of parallelism.</span></span>

<span data-ttu-id="03dbb-211">注意以下限制：</span><span class="sxs-lookup"><span data-stu-id="03dbb-211">Be aware of the following limitations:</span></span>

- <span data-ttu-id="03dbb-212">PolyBase 支持的最大列大小为 `varchar(8000)`、`nvarchar(4000)` 或 `varbinary(8000)`。</span><span class="sxs-lookup"><span data-stu-id="03dbb-212">PolyBase supports a maximum column size of `varchar(8000)`, `nvarchar(4000)`, or `varbinary(8000)`.</span></span> <span data-ttu-id="03dbb-213">如果数据超过这些限制，一种做法是在导出数据时将数据分解为区块，然后在导入后重新汇编区块。</span><span class="sxs-lookup"><span data-stu-id="03dbb-213">If you have data that exceeds these limits, one option is to break the data up into chunks when you export it, and then reassemble the chunks after import.</span></span>

- <span data-ttu-id="03dbb-214">PolyBase 使用固定行终止符 \n 或换行符。</span><span class="sxs-lookup"><span data-stu-id="03dbb-214">PolyBase uses a fixed row terminator of \n or newline.</span></span> <span data-ttu-id="03dbb-215">如果源数据中显示换行符，则可能会导致问题。</span><span class="sxs-lookup"><span data-stu-id="03dbb-215">This can cause problems if newline characters appear in the source data.</span></span>

- <span data-ttu-id="03dbb-216">源数据架构可能包含 SQL 数据仓库中不支持的数据类型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-216">Your source data schema might contain data types that are not supported in SQL Data Warehouse.</span></span>

<span data-ttu-id="03dbb-217">若要解决这些限制，可以创建一个执行所需转换的存储过程。</span><span class="sxs-lookup"><span data-stu-id="03dbb-217">To work around these limitations, you can create a stored procedure that performs the necessary conversions.</span></span> <span data-ttu-id="03dbb-218">运行 bcp 时引用此存储过程。</span><span class="sxs-lookup"><span data-stu-id="03dbb-218">Reference this stored procedure when you run bcp.</span></span> <span data-ttu-id="03dbb-219">或者，使用 [Redgate Data Platform Studio](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate) 自动转换 SQL 数据仓库中不支持的数据类型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-219">Alternatively, [Redgate Data Platform Studio](/azure/sql-data-warehouse/sql-data-warehouse-load-with-redgate) automatically converts data types that aren’t supported in SQL Data Warehouse.</span></span>

<span data-ttu-id="03dbb-220">有关详细信息，请参阅以下文章：</span><span class="sxs-lookup"><span data-stu-id="03dbb-220">For more information, see the following articles:</span></span>

- <span data-ttu-id="03dbb-221">[将数据载入 Azure SQL 数据仓库的最佳做法](/azure/sql-data-warehouse/guidance-for-loading-data)</span><span class="sxs-lookup"><span data-stu-id="03dbb-221">[Best practices for loading data into Azure SQL Data Warehouse](/azure/sql-data-warehouse/guidance-for-loading-data).</span></span>
- [<span data-ttu-id="03dbb-222">将架构迁移到 SQL 数据仓库</span><span class="sxs-lookup"><span data-stu-id="03dbb-222">Migrate your schemas to SQL Data Warehouse</span></span>](/azure/sql-data-warehouse/sql-data-warehouse-migrate-schema)
- [<span data-ttu-id="03dbb-223">有关为 SQL 数据仓库中的表定义数据类型的指南</span><span class="sxs-lookup"><span data-stu-id="03dbb-223">Guidance for defining data types for tables in SQL Data Warehouse</span></span>](/azure/sql-data-warehouse/sql-data-warehouse-tables-data-types)

### <a name="transform-the-data"></a><span data-ttu-id="03dbb-224">转换数据</span><span class="sxs-lookup"><span data-stu-id="03dbb-224">Transform the data</span></span>

<span data-ttu-id="03dbb-225">转换数据，并将其移入生产表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-225">Transform the data and move it into production tables.</span></span> <span data-ttu-id="03dbb-226">在此步骤中，数据将转换为包含维度表和事实数据表且适用于语义建模的星型架构。</span><span class="sxs-lookup"><span data-stu-id="03dbb-226">In this step, the data is transformed into a star schema with dimension tables and fact tables, suitable for semantic modeling.</span></span>

<span data-ttu-id="03dbb-227">创建具有聚集列存储索引并提供最佳整体查询性能的生产表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-227">Create the production tables with clustered columnstore indexes, which offer the best overall query performance.</span></span> <span data-ttu-id="03dbb-228">列存储索引已针对扫描大量记录的查询进行优化。</span><span class="sxs-lookup"><span data-stu-id="03dbb-228">Columnstore indexes are optimized for queries that scan many records.</span></span> <span data-ttu-id="03dbb-229">列存储索引并不是很适合用于单一实例查找（即，查找单个行）。</span><span class="sxs-lookup"><span data-stu-id="03dbb-229">Columnstore indexes don't perform as well for singleton lookups (that is, looking up a single row).</span></span> <span data-ttu-id="03dbb-230">如果需要执行频繁的单一实例查找，可以在表中添加非聚集索引。</span><span class="sxs-lookup"><span data-stu-id="03dbb-230">If you need to perform frequent singleton lookups, you can add a non-clustered index to a table.</span></span> <span data-ttu-id="03dbb-231">使用非聚集索引能够明显加快单一实例查找的运行速度。</span><span class="sxs-lookup"><span data-stu-id="03dbb-231">Singleton lookups can run significantly faster using a non-clustered index.</span></span> <span data-ttu-id="03dbb-232">但是，与在 OLTP 工作负荷中相比，单一实例查找在数据仓库场景中通常不太常见。</span><span class="sxs-lookup"><span data-stu-id="03dbb-232">However, singleton lookups are typically less common in data warehouse scenarios than OLTP workloads.</span></span> <span data-ttu-id="03dbb-233">有关详细信息，请参阅[为 SQL 数据仓库中的表编制索引](/azure/sql-data-warehouse/sql-data-warehouse-tables-index)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-233">For more information, see [Indexing tables in SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-tables-index).</span></span>

> [!NOTE]
> <span data-ttu-id="03dbb-234">聚集列存储表不支持 `varchar(max)`、`nvarchar(max)` 或 `varbinary(max)` 数据类型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-234">Clustered columnstore tables do not support `varchar(max)`, `nvarchar(max)`, or `varbinary(max)` data types.</span></span> <span data-ttu-id="03dbb-235">在这种情况下，请考虑堆或聚集索引。</span><span class="sxs-lookup"><span data-stu-id="03dbb-235">In that case, consider a heap or clustered index.</span></span> <span data-ttu-id="03dbb-236">可将这些列放入单独的表中。</span><span class="sxs-lookup"><span data-stu-id="03dbb-236">You might put those columns into a separate table.</span></span>

<span data-ttu-id="03dbb-237">由于示例数据库不是很大，因此我们创建了不带分区的复制表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-237">Because the sample database is not very large, we created replicated tables with no partitions.</span></span> <span data-ttu-id="03dbb-238">对于生产工作负荷，使用分布式表可能会提高查询性能。</span><span class="sxs-lookup"><span data-stu-id="03dbb-238">For production workloads, using distributed tables is likely to improve query performance.</span></span> <span data-ttu-id="03dbb-239">请参阅[有关在 Azure SQL 数据仓库中设计分布式表的指南](/azure/sql-data-warehouse/sql-data-warehouse-tables-distribute)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-239">See [Guidance for designing distributed tables in Azure SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-tables-distribute).</span></span> <span data-ttu-id="03dbb-240">示例脚本使用静态[资源类](/azure/sql-data-warehouse/resource-classes-for-workload-management)运行查询。</span><span class="sxs-lookup"><span data-stu-id="03dbb-240">Our example scripts run the queries using a static [resource class](/azure/sql-data-warehouse/resource-classes-for-workload-management).</span></span>

### <a name="load-the-semantic-model"></a><span data-ttu-id="03dbb-241">加载语义模型</span><span class="sxs-lookup"><span data-stu-id="03dbb-241">Load the semantic model</span></span>

<span data-ttu-id="03dbb-242">将数据载入 Azure Analysis Services 中的表格模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-242">Load the data into a tabular model in Azure Analysis Services.</span></span> <span data-ttu-id="03dbb-243">在此步骤中，我们将使用 SQL Server Data Tools (SSDT) 创建语义数据模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-243">In this step, you create a semantic data model by using SQL Server Data Tools (SSDT).</span></span> <span data-ttu-id="03dbb-244">也可以通过从 Power BI Desktop 文件导入一个模型来创建该模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-244">You can also create a model by importing it from a Power BI Desktop file.</span></span> <span data-ttu-id="03dbb-245">由于 SQL 数据仓库不支持外键，因为必须将关系添加到语义模型，以便可以跨表联接。</span><span class="sxs-lookup"><span data-stu-id="03dbb-245">Because SQL Data Warehouse does not support foreign keys, you must add the relationships to the semantic model, so that you can join across tables.</span></span>

### <a name="use-power-bi-to-visualize-the-data"></a><span data-ttu-id="03dbb-246">使用 Power BI 将数据可视化</span><span class="sxs-lookup"><span data-stu-id="03dbb-246">Use Power BI to visualize the data</span></span>

<span data-ttu-id="03dbb-247">Power BI 支持使用两个选项连接到 Azure Analysis Services：</span><span class="sxs-lookup"><span data-stu-id="03dbb-247">Power BI supports two options for connecting to Azure Analysis Services:</span></span>

- <span data-ttu-id="03dbb-248">导入。</span><span class="sxs-lookup"><span data-stu-id="03dbb-248">Import.</span></span> <span data-ttu-id="03dbb-249">将数据导入 Power BI 模型。</span><span class="sxs-lookup"><span data-stu-id="03dbb-249">The data is imported into the Power BI model.</span></span>
- <span data-ttu-id="03dbb-250">实时连接。</span><span class="sxs-lookup"><span data-stu-id="03dbb-250">Live Connection.</span></span> <span data-ttu-id="03dbb-251">直接从 Analysis Services 提取数据。</span><span class="sxs-lookup"><span data-stu-id="03dbb-251">Data is pulled directly from Analysis Services.</span></span>

<span data-ttu-id="03dbb-252">我们建议使用“实时连接”，因为此选项不需要将数据复制到 Power BI 模型中。</span><span class="sxs-lookup"><span data-stu-id="03dbb-252">We recommend Live Connection because it doesn't require copying data into the Power BI model.</span></span> <span data-ttu-id="03dbb-253">此外，使用 DirectQuery 可确保结果始终与最新源数据保持一致。</span><span class="sxs-lookup"><span data-stu-id="03dbb-253">Also, using DirectQuery ensures that results are always consistent with the latest source data.</span></span> <span data-ttu-id="03dbb-254">有关详细信息，请参阅[使用 Power BI 进行连接](/azure/analysis-services/analysis-services-connect-pbi)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-254">For more information, see [Connect with Power BI](/azure/analysis-services/analysis-services-connect-pbi).</span></span>

<span data-ttu-id="03dbb-255">**建议：**</span><span class="sxs-lookup"><span data-stu-id="03dbb-255">**Recommendations:**</span></span>

<span data-ttu-id="03dbb-256">避免直接对数据仓库运行 BI 仪表板查询。</span><span class="sxs-lookup"><span data-stu-id="03dbb-256">Avoid running BI dashboard queries directly against the data warehouse.</span></span> <span data-ttu-id="03dbb-257">BI 仪表板要求的响应时间很短，针对仓库直接运行查询可能无法满足该要求。</span><span class="sxs-lookup"><span data-stu-id="03dbb-257">BI dashboards require very low response times, which direct queries against the warehouse may be unable to satisfy.</span></span> <span data-ttu-id="03dbb-258">此外，刷新仪表板的操作将计入并发查询次数，这可能会影响性能。</span><span class="sxs-lookup"><span data-stu-id="03dbb-258">Also, refreshing the dashboard will count against the number of concurrent queries, which could impact performance.</span></span>

<span data-ttu-id="03dbb-259">Azure Analysis Services 旨在处理 BI 仪表板的查询要求，因此建议的做法是从 Power BI 查询 Analysis Services。</span><span class="sxs-lookup"><span data-stu-id="03dbb-259">Azure Analysis Services is designed to handle the query requirements of a BI dashboard, so the recommended practice is to query Analysis Services from Power BI.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="03dbb-260">可伸缩性注意事项</span><span class="sxs-lookup"><span data-stu-id="03dbb-260">Scalability considerations</span></span>

### <a name="sql-data-warehouse"></a><span data-ttu-id="03dbb-261">SQL 数据仓库</span><span class="sxs-lookup"><span data-stu-id="03dbb-261">SQL Data Warehouse</span></span>

<span data-ttu-id="03dbb-262">使用 SQL 数据仓库可以按需横向扩展计算资源。</span><span class="sxs-lookup"><span data-stu-id="03dbb-262">With SQL Data Warehouse, you can scale out your compute resources on demand.</span></span> <span data-ttu-id="03dbb-263">查询引擎基于计算节点数目优化并行处理的查询，并按需在节点之间移动数据。</span><span class="sxs-lookup"><span data-stu-id="03dbb-263">The query engine optimizes queries for parallel processing based on the number of compute nodes, and moves data between nodes as necessary.</span></span> <span data-ttu-id="03dbb-264">有关详细信息，请参阅[管理 Azure SQL 数据仓库中的计算资源](/azure/sql-data-warehouse/sql-data-warehouse-manage-compute-overview)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-264">For more information, see [Manage compute in Azure SQL Data Warehouse](/azure/sql-data-warehouse/sql-data-warehouse-manage-compute-overview).</span></span>

### <a name="analysis-services"></a><span data-ttu-id="03dbb-265">Analysis Services</span><span class="sxs-lookup"><span data-stu-id="03dbb-265">Analysis Services</span></span>

<span data-ttu-id="03dbb-266">对于生产工作负荷，我们建议使用 Azure Analysis Services 的标准层，因为该层支持分区和 DirectQuery。</span><span class="sxs-lookup"><span data-stu-id="03dbb-266">For production workloads, we recommend the Standard Tier for Azure Analysis Services, because it supports partitioning and DirectQuery.</span></span> <span data-ttu-id="03dbb-267">在层中，实例大小确定内存和处理能力。</span><span class="sxs-lookup"><span data-stu-id="03dbb-267">Within a tier, the instance size determines the memory and processing power.</span></span> <span data-ttu-id="03dbb-268">处理能力以查询处理单位 (QPU) 来计量。</span><span class="sxs-lookup"><span data-stu-id="03dbb-268">Processing power is measured in Query Processing Units (QPUs).</span></span> <span data-ttu-id="03dbb-269">请监视 QPU 使用率以选择适当的大小。</span><span class="sxs-lookup"><span data-stu-id="03dbb-269">Monitor your QPU usage to select the appropriate size.</span></span> <span data-ttu-id="03dbb-270">有关详细信息，请参阅[监视服务器指标](/azure/analysis-services/analysis-services-monitor)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-270">For more information, see [Monitor server metrics](/azure/analysis-services/analysis-services-monitor).</span></span>

<span data-ttu-id="03dbb-271">在负载较高的情况下，查询性能可能因查询并发性而下降。</span><span class="sxs-lookup"><span data-stu-id="03dbb-271">Under high load, query performance can become degraded due to query concurrency.</span></span> <span data-ttu-id="03dbb-272">可以通过创建副本池来处理查询，以横向扩展 Analysis Services，从而能够并行执行更多的查询。</span><span class="sxs-lookup"><span data-stu-id="03dbb-272">You can scale out Analysis Services by creating a pool of replicas to process queries, so that more queries can be performed concurrently.</span></span> <span data-ttu-id="03dbb-273">处理数据模型的工作始终在主服务器上进行。</span><span class="sxs-lookup"><span data-stu-id="03dbb-273">The work of processing the data model always happens on the primary server.</span></span> <span data-ttu-id="03dbb-274">默认情况下，主服务器也会处理查询。</span><span class="sxs-lookup"><span data-stu-id="03dbb-274">By default, the primary server also handles queries.</span></span> <span data-ttu-id="03dbb-275">（可选）可以指定以独占方式运行处理的主服务器，让查询池处理所有查询。</span><span class="sxs-lookup"><span data-stu-id="03dbb-275">Optionally, you can designate the primary server to run processing exclusively, so that the query pool handles all queries.</span></span> <span data-ttu-id="03dbb-276">如果处理要求较高，应将处理负载与查询池隔离开来。</span><span class="sxs-lookup"><span data-stu-id="03dbb-276">If you have high processing requirements, you should separate the processing from the query pool.</span></span> <span data-ttu-id="03dbb-277">如果查询负载较高，而处理负载相对较低，则可以在查询池中包含主服务器。</span><span class="sxs-lookup"><span data-stu-id="03dbb-277">If you have high query loads, and relatively light processing, you can include the primary server in the query pool.</span></span> <span data-ttu-id="03dbb-278">有关详细信息，请参阅 [Azure Analysis Services 横向扩展](/azure/analysis-services/analysis-services-scale-out)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-278">For more information, see [Azure Analysis Services scale-out](/azure/analysis-services/analysis-services-scale-out).</span></span>

<span data-ttu-id="03dbb-279">若要减少不必要的处理量，请考虑使用分区将表格模型划分为逻辑部分。</span><span class="sxs-lookup"><span data-stu-id="03dbb-279">To reduce the amount of unnecessary processing, consider using partitions to divide the tabular model into logical parts.</span></span> <span data-ttu-id="03dbb-280">可以单独处理每个分区。</span><span class="sxs-lookup"><span data-stu-id="03dbb-280">Each partition can be processed separately.</span></span> <span data-ttu-id="03dbb-281">有关详细信息，请参阅[分区](/sql/analysis-services/tabular-models/partitions-ssas-tabular)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-281">For more information, see [Partitions](/sql/analysis-services/tabular-models/partitions-ssas-tabular).</span></span>

## <a name="security-considerations"></a><span data-ttu-id="03dbb-282">安全注意事项</span><span class="sxs-lookup"><span data-stu-id="03dbb-282">Security considerations</span></span>

### <a name="ip-whitelisting-of-analysis-services-clients"></a><span data-ttu-id="03dbb-283">Analysis Services 客户端的 IP 允许列表</span><span class="sxs-lookup"><span data-stu-id="03dbb-283">IP whitelisting of Analysis Services clients</span></span>

<span data-ttu-id="03dbb-284">考虑使用 Analysis Services 防火墙功能将客户端 IP 地址加入允许列表。</span><span class="sxs-lookup"><span data-stu-id="03dbb-284">Consider using the Analysis Services firewall feature to whitelist client IP addresses.</span></span> <span data-ttu-id="03dbb-285">如果已启用防火墙，防火墙会阻止其规则中指定的连接以外的所有客户端连接。</span><span class="sxs-lookup"><span data-stu-id="03dbb-285">If enabled, the firewall blocks all client connections other than those specified in the firewall rules.</span></span> <span data-ttu-id="03dbb-286">默认规则会将 Power BI 服务加入允许列表，但你可以根据需要禁用此规则。</span><span class="sxs-lookup"><span data-stu-id="03dbb-286">The default rules whitelist the Power BI service, but you can disable this rule if desired.</span></span> <span data-ttu-id="03dbb-287">有关详细信息，请参阅[使用新防火墙功能强化 Azure Analysis Services](https://azure.microsoft.com/blog/hardening-azure-analysis-services-with-the-new-firewall-capability/)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-287">For more information, see [Hardening Azure Analysis Services with the new firewall capability](https://azure.microsoft.com/blog/hardening-azure-analysis-services-with-the-new-firewall-capability/).</span></span>

### <a name="authorization"></a><span data-ttu-id="03dbb-288">授权</span><span class="sxs-lookup"><span data-stu-id="03dbb-288">Authorization</span></span>

<span data-ttu-id="03dbb-289">Azure Analysis Services 使用 Azure Active Directory (Azure AD) 对连接到 Analysis Services 服务器的用户进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="03dbb-289">Azure Analysis Services uses Azure Active Directory (Azure AD) to authenticate users who connect to an Analysis Services server.</span></span> <span data-ttu-id="03dbb-290">可以通过创建角色，然后将 Azure AD 用户或组分配到这些角色，来限制特定的用户可以查看哪些数据。</span><span class="sxs-lookup"><span data-stu-id="03dbb-290">You can restrict what data a particular user is able to view, by creating roles and then assigning Azure AD users or groups to those roles.</span></span> <span data-ttu-id="03dbb-291">对于每个角色，可以：</span><span class="sxs-lookup"><span data-stu-id="03dbb-291">For each role, you can:</span></span>

- <span data-ttu-id="03dbb-292">保护表或单个列。</span><span class="sxs-lookup"><span data-stu-id="03dbb-292">Protect tables or individual columns.</span></span>
- <span data-ttu-id="03dbb-293">基于筛选表达式保护单个行。</span><span class="sxs-lookup"><span data-stu-id="03dbb-293">Protect individual rows based on filter expressions.</span></span>

<span data-ttu-id="03dbb-294">有关详细信息，请参阅[管理数据库角色和用户](/azure/analysis-services/analysis-services-database-users)。</span><span class="sxs-lookup"><span data-stu-id="03dbb-294">For more information, see [Manage database roles and users](/azure/analysis-services/analysis-services-database-users).</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="03dbb-295">部署解决方案</span><span class="sxs-lookup"><span data-stu-id="03dbb-295">Deploy the solution</span></span>

<span data-ttu-id="03dbb-296">若要部署并运行参考实现，请按 [GitHub 自述文件][github-folder]中的步骤操作。</span><span class="sxs-lookup"><span data-stu-id="03dbb-296">To the deploy and run the reference implementation, follow the steps in the [GitHub readme][github-folder].</span></span> <span data-ttu-id="03dbb-297">它将部署以下部分：</span><span class="sxs-lookup"><span data-stu-id="03dbb-297">It deploys the following:</span></span>

- <span data-ttu-id="03dbb-298">一个用于模拟本地数据库服务器的 Windows VM。</span><span class="sxs-lookup"><span data-stu-id="03dbb-298">A Windows VM to simulate an on-premises database server.</span></span> <span data-ttu-id="03dbb-299">该 VM 包含 SQL Server 2017 和相关工具以及 Power BI Desktop。</span><span class="sxs-lookup"><span data-stu-id="03dbb-299">It includes SQL Server 2017 and related tools, along with Power BI Desktop.</span></span>
- <span data-ttu-id="03dbb-300">一个 Azure 存储帐户。该帐户提供 Blob 存储用于保存从 SQL Server 数据库导出的数据。</span><span class="sxs-lookup"><span data-stu-id="03dbb-300">An Azure storage account that provides Blob storage to hold data exported from the SQL Server database.</span></span>
- <span data-ttu-id="03dbb-301">一个 Azure SQL 数据仓库实例。</span><span class="sxs-lookup"><span data-stu-id="03dbb-301">An Azure SQL Data Warehouse instance.</span></span>
- <span data-ttu-id="03dbb-302">一个 Azure Analysis Services 实例。</span><span class="sxs-lookup"><span data-stu-id="03dbb-302">An Azure Analysis Services instance.</span></span>

## <a name="next-steps"></a><span data-ttu-id="03dbb-303">后续步骤</span><span class="sxs-lookup"><span data-stu-id="03dbb-303">Next steps</span></span>

- <span data-ttu-id="03dbb-304">使用 Azure 数据工厂将 ELT 管道自动化。</span><span class="sxs-lookup"><span data-stu-id="03dbb-304">Use Azure Data Factory to automate the ELT pipeline.</span></span> <span data-ttu-id="03dbb-305">请参阅[将自动化企业 BI 与 SQL 数据仓库和 Azure 数据工厂配合使用][adf-ra]。</span><span class="sxs-lookup"><span data-stu-id="03dbb-305">See [Automated enterprise BI with SQL Data Warehouse and Azure Data Factory][adf-ra].</span></span>

## <a name="related-resources"></a><span data-ttu-id="03dbb-306">相关资源</span><span class="sxs-lookup"><span data-stu-id="03dbb-306">Related resources</span></span>

<span data-ttu-id="03dbb-307">可以查看以下 [Azure 示例方案](/azure/architecture/example-scenario)，了解使用部分相同技术的具体解决方案：</span><span class="sxs-lookup"><span data-stu-id="03dbb-307">You may want to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="03dbb-308">用于销售和市场营销的数据仓库和分析</span><span class="sxs-lookup"><span data-stu-id="03dbb-308">Data warehousing and analytics for sales and marketing</span></span>](/azure/architecture/example-scenario/data/data-warehouse)
- [<span data-ttu-id="03dbb-309">将混合 ETL 与现有本地 SSIS 和 Azure 数据工厂配合使用</span><span class="sxs-lookup"><span data-stu-id="03dbb-309">Hybrid ETL with existing on-premises SSIS and Azure Data Factory</span></span>](/azure/architecture/example-scenario/data/hybrid-etl-with-adf)

<!-- links -->

[adf-ra]: ./enterprise-bi-adf.md
[github-folder]: https://github.com/mspnp/reference-architectures/tree/master/data/enterprise_bi_sqldw
[wwi]: /sql/sample/world-wide-importers/wide-world-importers-oltp-database
