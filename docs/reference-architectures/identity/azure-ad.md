---
title: 将本地 AD 域与 Azure AD 集成
titleSuffix: Azure Reference Architectures
description: 使用 Azure Active Directory (Azure AD) 实现安全的混合网络体系结构。
author: telmosampaio
ms.date: 11/28/2016
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, identity
ms.openlocfilehash: 3dc70c7eaea18f010d67befa5969d1be0423239c
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54484391"
---
# <a name="integrate-on-premises-active-directory-domains-with-azure-active-directory"></a><span data-ttu-id="56583-103">将本地 Active Directory 域与 Azure Active Directory 集成</span><span class="sxs-lookup"><span data-stu-id="56583-103">Integrate on-premises Active Directory domains with Azure Active Directory</span></span>

<span data-ttu-id="56583-104">Azure Active Directory (Azure AD) 是一种基于云的多租户目录和标识服务。</span><span class="sxs-lookup"><span data-stu-id="56583-104">Azure Active Directory (Azure AD) is a cloud based multi-tenant directory and identity service.</span></span> <span data-ttu-id="56583-105">此参考体系结构展示了将本地 Active Directory 域与 Azure AD 集成以提供基于云的标识身份验证的最佳做法。</span><span class="sxs-lookup"><span data-stu-id="56583-105">This reference architecture shows best practices for integrating on-premises Active Directory domains with Azure AD to provide cloud-based identity authentication.</span></span> <span data-ttu-id="56583-106">[**部署此解决方案**](#deploy-the-solution)。</span><span class="sxs-lookup"><span data-stu-id="56583-106">[**Deploy this solution**](#deploy-the-solution).</span></span>

![使用 Azure Active Directory 的云标识体系结构](./images/azure-ad.png)

<span data-ttu-id="56583-108">下载此体系结构的 [Visio 文件][visio-download]。</span><span class="sxs-lookup"><span data-stu-id="56583-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="56583-109">为简单起见，此图仅展示了与 Azure AD 直接相关的连接，而未展示在身份验证和联合身份验证过程中可能产生的协议相关流量。</span><span class="sxs-lookup"><span data-stu-id="56583-109">For simplicity, this diagram only shows the connections directly related to Azure AD, and not protocol-related traffic that may occur as part of authentication and identity federation.</span></span> <span data-ttu-id="56583-110">例如，Web 应用程序可能重定向 Web 浏览器，以便通过 Azure AD 对请求进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="56583-110">For example, a web application may redirect the web browser to authenticate the request through Azure AD.</span></span> <span data-ttu-id="56583-111">经过身份验证后，可以将带有相应标识信息的请求传递回 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="56583-111">Once authenticated, the request can be passed back to the web application, with the appropriate identity information.</span></span>
>

<span data-ttu-id="56583-112">此参考体系结构的典型用途包括：</span><span class="sxs-lookup"><span data-stu-id="56583-112">Typical uses for this reference architecture include:</span></span>

- <span data-ttu-id="56583-113">部署在 Azure 中的 Web 应用程序，用于为属于组织的远程用户提供访问权限。</span><span class="sxs-lookup"><span data-stu-id="56583-113">Web applications deployed in Azure that provide access to remote users who belong to your organization.</span></span>
- <span data-ttu-id="56583-114">为最终用户实现自助服务功能，比如重置其密码，以及委派组管理。</span><span class="sxs-lookup"><span data-stu-id="56583-114">Implementing self-service capabilities for end-users, such as resetting their passwords, and delegating group management.</span></span> <span data-ttu-id="56583-115">请注意，这需要 Azure AD Premium 版本。</span><span class="sxs-lookup"><span data-stu-id="56583-115">Note that this requires Azure AD Premium edition.</span></span>
- <span data-ttu-id="56583-116">本地网络和应用程序的 Azure VNet 不使用 VPN 隧道或 ExpressRoute 线路进行连接的体系结构。</span><span class="sxs-lookup"><span data-stu-id="56583-116">Architectures in which the on-premises network and the application's Azure VNet are not connected using a VPN tunnel or ExpressRoute circuit.</span></span>

> [!NOTE]
> <span data-ttu-id="56583-117">Azure AD 可以对组织目录中存在的用户和应用程序的标识进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="56583-117">Azure AD can authenticate the identity of users and applications that exist in an organization’s directory.</span></span> <span data-ttu-id="56583-118">某些应用程序和服务（如 SQL Server）可能需要进行计算机身份验证，此解决方案不适合这种情况。</span><span class="sxs-lookup"><span data-stu-id="56583-118">Some applications and services, such as SQL Server, may require computer authentication, in which case this solution is not appropriate.</span></span>
>

<span data-ttu-id="56583-119">有关其他注意事项，请参阅[选择用于将本地 Active Directory 与 Azure 相集成的解决方案][considerations]。</span><span class="sxs-lookup"><span data-stu-id="56583-119">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span>

## <a name="architecture"></a><span data-ttu-id="56583-120">体系结构</span><span class="sxs-lookup"><span data-stu-id="56583-120">Architecture</span></span>

<span data-ttu-id="56583-121">该体系结构具有以下组件。</span><span class="sxs-lookup"><span data-stu-id="56583-121">The architecture has the following components.</span></span>

- <span data-ttu-id="56583-122">**Azure AD 租户**。</span><span class="sxs-lookup"><span data-stu-id="56583-122">**Azure AD tenant**.</span></span> <span data-ttu-id="56583-123">由组织创建的 [Azure AD][azure-active-directory] 实例。</span><span class="sxs-lookup"><span data-stu-id="56583-123">An instance of [Azure AD][azure-active-directory] created by your organization.</span></span> <span data-ttu-id="56583-124">它通过存储从本地 Active Directory 中复制的对象，充当云应用程序的目录服务，并提供标识服务。</span><span class="sxs-lookup"><span data-stu-id="56583-124">It acts as a directory service for cloud applications by storing objects copied from the on-premises Active Directory and provides identity services.</span></span>
- <span data-ttu-id="56583-125">**Web 层子网**。</span><span class="sxs-lookup"><span data-stu-id="56583-125">**Web tier subnet**.</span></span> <span data-ttu-id="56583-126">此子网包含运行 Web 应用程序的 VM。</span><span class="sxs-lookup"><span data-stu-id="56583-126">This subnet holds VMs that run a web application.</span></span> <span data-ttu-id="56583-127">Azure AD 可充当此应用程序的标识代理。</span><span class="sxs-lookup"><span data-stu-id="56583-127">Azure AD can act as an identity broker for this application.</span></span>
- <span data-ttu-id="56583-128">**本地 AD DS 服务器**。</span><span class="sxs-lookup"><span data-stu-id="56583-128">**On-premises AD DS server**.</span></span> <span data-ttu-id="56583-129">一种本地目录和标识服务。</span><span class="sxs-lookup"><span data-stu-id="56583-129">An on-premise directory and identity service.</span></span> <span data-ttu-id="56583-130">AD DS 目录可与 Azure AD 同步，从而能够对本地用户进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="56583-130">The AD DS directory can be synchronized with Azure AD to enable it to authenticate on-premise users.</span></span>
- <span data-ttu-id="56583-131">**Azure AD Connect 同步服务器**。</span><span class="sxs-lookup"><span data-stu-id="56583-131">**Azure AD Connect sync server**.</span></span> <span data-ttu-id="56583-132">运行 [Azure AD Connect][azure-ad-connect] 同步服务的本地计算机。</span><span class="sxs-lookup"><span data-stu-id="56583-132">An on-premises computer that runs the [Azure AD Connect][azure-ad-connect] sync service.</span></span> <span data-ttu-id="56583-133">此服务可将本地 Active Directory 中保存的信息同步到 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="56583-133">This service synchronizes information held in the on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="56583-134">例如，如果在本地预配或取消设置组和用户，这些更改会传播到 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="56583-134">For example, if you provision or deprovision groups and users on-premises, these changes propagate to Azure AD.</span></span>

  > [!NOTE]
  > <span data-ttu-id="56583-135">出于安全原因，Azure AD 以哈希形式存储用户的密码。</span><span class="sxs-lookup"><span data-stu-id="56583-135">For security reasons, Azure AD stores user's passwords as a hash.</span></span> <span data-ttu-id="56583-136">如果用户需要重置密码，则必须在本地执行，并且必须将新哈希发送到 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="56583-136">If a user requires a password reset, this must be performed on-premises and the new hash must be sent to Azure AD.</span></span> <span data-ttu-id="56583-137">Azure AD Premium 版本包含一些可自动执行此任务的功能，让用户能够重置自己的密码。</span><span class="sxs-lookup"><span data-stu-id="56583-137">Azure AD Premium editions include features that can automate this task to enable users to reset their own passwords.</span></span>
  >

- <span data-ttu-id="56583-138">**N 层应用程序所用的 VM**。</span><span class="sxs-lookup"><span data-stu-id="56583-138">**VMs for N-tier application**.</span></span> <span data-ttu-id="56583-139">该部署包括 N 层应用程序的基础结构。</span><span class="sxs-lookup"><span data-stu-id="56583-139">The deployment includes infrastructure for an N-tier application.</span></span> <span data-ttu-id="56583-140">有关这些资源的详细信息，请参阅[运行 N 层体系结构所用的 VM][implementing-a-multi-tier-architecture-on-Azure]。</span><span class="sxs-lookup"><span data-stu-id="56583-140">For more information about these resources, see [Run VMs for an N-tier architecture][implementing-a-multi-tier-architecture-on-Azure].</span></span>

## <a name="recommendations"></a><span data-ttu-id="56583-141">建议</span><span class="sxs-lookup"><span data-stu-id="56583-141">Recommendations</span></span>

<span data-ttu-id="56583-142">以下建议适用于大多数方案。</span><span class="sxs-lookup"><span data-stu-id="56583-142">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="56583-143">除非有优先于这些建议的特定要求，否则请遵循这些建议。</span><span class="sxs-lookup"><span data-stu-id="56583-143">Follow these recommendations unless you have a specific requirement that overrides them.</span></span>

### <a name="azure-ad-connect-sync-service"></a><span data-ttu-id="56583-144">Azure AD Connect 同步服务</span><span class="sxs-lookup"><span data-stu-id="56583-144">Azure AD Connect sync service</span></span>

<span data-ttu-id="56583-145">Azure AD Connect 同步服务可确保存储在云中的标识信息与保存在本地的标识信息保持一致。</span><span class="sxs-lookup"><span data-stu-id="56583-145">The Azure AD Connect sync service ensures that identity information stored in the cloud is consistent with that held on-premises.</span></span> <span data-ttu-id="56583-146">可使用 Azure AD Connect 软件安装此服务。</span><span class="sxs-lookup"><span data-stu-id="56583-146">You install this service using the Azure AD Connect software.</span></span>

<span data-ttu-id="56583-147">在实施 Azure AD Connect 同步之前，先确定组织的同步要求。</span><span class="sxs-lookup"><span data-stu-id="56583-147">Before implementing Azure AD Connect sync, determine the synchronization requirements of your organization.</span></span> <span data-ttu-id="56583-148">例如，要从哪些域同步哪些内容，以及频率如何。</span><span class="sxs-lookup"><span data-stu-id="56583-148">For example, what to synchronize, from which domains, and how frequently.</span></span> <span data-ttu-id="56583-149">有关详细信息，请参阅[确定目录同步要求][aad-sync-requirements]。</span><span class="sxs-lookup"><span data-stu-id="56583-149">For more information, see [Determine directory synchronization requirements][aad-sync-requirements].</span></span>

<span data-ttu-id="56583-150">可以在本地托管的 VM 或计算机上运行 Azure AD Connect 同步服务。</span><span class="sxs-lookup"><span data-stu-id="56583-150">You can run the Azure AD Connect sync service on a VM or a computer hosted on-premises.</span></span> <span data-ttu-id="56583-151">与 Azure AD 初次同步后，Azure AD Connect 同步服务上的负载一般不会很高，具体取决于 Active Directory 目录中信息的易变性。</span><span class="sxs-lookup"><span data-stu-id="56583-151">Depending on the volatility of the information in your Active Directory directory, the load on the Azure AD Connect sync service is unlikely to be high after the initial synchronization with Azure AD.</span></span> <span data-ttu-id="56583-152">如果在 VM 上运行该服务，可以在需要时更轻松地缩放服务器。</span><span class="sxs-lookup"><span data-stu-id="56583-152">Running the service on a VM makes it easier to scale the server if needed.</span></span> <span data-ttu-id="56583-153">如“监视注意事项”部分中所述，监视 VM 上的活动，以确定是否有必要进行缩放。</span><span class="sxs-lookup"><span data-stu-id="56583-153">Monitor the activity on the VM as described in the Monitoring considerations section to determine whether scaling is necessary.</span></span>

<span data-ttu-id="56583-154">如果林中有多个本地域，则建议存储整个林的信息并将信息同步到单个 Azure AD 租户。</span><span class="sxs-lookup"><span data-stu-id="56583-154">If you have multiple on-premises domains in a forest, we recommend storing and synchronizing information for the entire forest to a single Azure AD tenant.</span></span> <span data-ttu-id="56583-155">对出现在多个域中的标识的信息进行筛选，以便每个标识在 Azure AD 中仅出现一次，而不是重复出现。</span><span class="sxs-lookup"><span data-stu-id="56583-155">Filter information for identities that occur in more than one domain, so that each identity appears only once in Azure AD, rather than being duplicated.</span></span> <span data-ttu-id="56583-156">重复项会导致数据同步时出现不一致。</span><span class="sxs-lookup"><span data-stu-id="56583-156">Duplication can lead to inconsistencies when data is synchronized.</span></span> <span data-ttu-id="56583-157">有关详细信息，请参阅下面的“拓扑”部分。</span><span class="sxs-lookup"><span data-stu-id="56583-157">For more information, see the Topology section below.</span></span>

<span data-ttu-id="56583-158">使用筛选，以便仅在 Azure AD 中存储必要的数据。</span><span class="sxs-lookup"><span data-stu-id="56583-158">Use filtering so that only necessary data is stored in Azure AD.</span></span> <span data-ttu-id="56583-159">例如，组织可能不想在 Azure AD 中存储有关停用帐户的信息。</span><span class="sxs-lookup"><span data-stu-id="56583-159">For example, your organization might not want to store information about inactive accounts in Azure AD.</span></span> <span data-ttu-id="56583-160">可以按组、按域、按组织单位 (OU) 或按属性进行筛选。</span><span class="sxs-lookup"><span data-stu-id="56583-160">Filtering can be group-based, domain-based, organization unit (OU)-based, or attribute-based.</span></span> <span data-ttu-id="56583-161">可以组合使用多个筛选器，以生成更复杂的规则。</span><span class="sxs-lookup"><span data-stu-id="56583-161">You can combine filters to generate more complex rules.</span></span> <span data-ttu-id="56583-162">例如，可以同步某个域中保存的、针对所选属性具有特定值的对象。</span><span class="sxs-lookup"><span data-stu-id="56583-162">For example, you could synchronize objects held in a domain that have a specific value in a selected attribute.</span></span> <span data-ttu-id="56583-163">有关详细信息，请参阅 [Azure AD Connect 同步：配置筛选][aad-filtering]。</span><span class="sxs-lookup"><span data-stu-id="56583-163">For detailed information, see [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

<span data-ttu-id="56583-164">若要实现 AD Connect 同步服务的高可用性，请运行辅助临时服务器。</span><span class="sxs-lookup"><span data-stu-id="56583-164">To implement high availability for the AD Connect sync service, run a secondary staging server.</span></span> <span data-ttu-id="56583-165">有关详细信息，请参阅“拓扑建议”部分。</span><span class="sxs-lookup"><span data-stu-id="56583-165">For more information, see the Topology recommendations section.</span></span>

### <a name="security-recommendations"></a><span data-ttu-id="56583-166">安全建议</span><span class="sxs-lookup"><span data-stu-id="56583-166">Security recommendations</span></span>

<span data-ttu-id="56583-167">**用户密码管理**。</span><span class="sxs-lookup"><span data-stu-id="56583-167">**User password management**.</span></span> <span data-ttu-id="56583-168">Azure AD Premium 版本支持密码回写，从而允许本地用户从 Azure 门户执行自助密码重置。</span><span class="sxs-lookup"><span data-stu-id="56583-168">The Azure AD Premium editions support password writeback, enabling your on-premises users to perform self-service password resets from within the Azure portal.</span></span> <span data-ttu-id="56583-169">若要启用此功能，必须先查看组织的密码安全策略。</span><span class="sxs-lookup"><span data-stu-id="56583-169">This feature should only be enabled after reviewing your organization's password security policy.</span></span> <span data-ttu-id="56583-170">例如，可限制哪些用户可以更改其密码，并定制密码管理体验。</span><span class="sxs-lookup"><span data-stu-id="56583-170">For example, you can restrict which users can change their passwords, and you can tailor the password management experience.</span></span> <span data-ttu-id="56583-171">有关详细信息，请参阅[自定义密码管理以满足组织的需求][aad-password-management]。</span><span class="sxs-lookup"><span data-stu-id="56583-171">For more information, see [Customizing Password Management to fit your organization's needs][aad-password-management].</span></span>

<span data-ttu-id="56583-172">**保护可从外部访问的本地应用程序。**</span><span class="sxs-lookup"><span data-stu-id="56583-172">**Protect on-premises applications that can be accessed externally.**</span></span> <span data-ttu-id="56583-173">可使用 Azure AD 应用程序代理，通过 Azure AD 为外部用户提供对本地 Web 应用程序的受控访问权限。</span><span class="sxs-lookup"><span data-stu-id="56583-173">Use the Azure AD Application Proxy to provide controlled access to on-premises web applications for external users through Azure AD.</span></span> <span data-ttu-id="56583-174">只有在你的 Azure 目录中具有有效凭据的用户才有权使用该应用程序。</span><span class="sxs-lookup"><span data-stu-id="56583-174">Only users that have valid credentials in your Azure directory have permission to use the application.</span></span> <span data-ttu-id="56583-175">有关详细信息，请参阅[在 Azure 门户中启用应用程序代理][aad-application-proxy]一文。</span><span class="sxs-lookup"><span data-stu-id="56583-175">For more information, see the article [Enable Application Proxy in the Azure portal][aad-application-proxy].</span></span>

<span data-ttu-id="56583-176">**主动监视 Azure AD 中的可疑活动迹象。**</span><span class="sxs-lookup"><span data-stu-id="56583-176">**Actively monitor Azure AD for signs of suspicious activity.**</span></span> <span data-ttu-id="56583-177">请考虑使用 Azure AD Premium P2 版本，该版本包括 Azure AD Identity Protection。</span><span class="sxs-lookup"><span data-stu-id="56583-177">Consider using Azure AD Premium P2 edition, which includes Azure AD Identity Protection.</span></span> <span data-ttu-id="56583-178">Identity Protection 使用自适应机器学习算法和启发式学习法来检测异常行为以及可能表示标识已遭入侵的风险事件。</span><span class="sxs-lookup"><span data-stu-id="56583-178">Identity Protection uses adaptive machine learning algorithms and heuristics to detect anomalies and risk events that may indicate that an identity has been compromised.</span></span> <span data-ttu-id="56583-179">例如，它可以检测到潜在的异常活动，比如异常登录活动，来自未知来源或活动可疑的 IP 地址的登录，或者来自可能受感染的设备的登录。</span><span class="sxs-lookup"><span data-stu-id="56583-179">For example, it can detect potentially unusual activity such as irregular sign-in activities, sign-ins from unknown sources or from IP addresses with suspicious activity, or sign-ins from devices that may be infected.</span></span> <span data-ttu-id="56583-180">Identity Protection 使用此数据生成报告和警报，使你能够调查这些风险事件并采取相应的措施。</span><span class="sxs-lookup"><span data-stu-id="56583-180">Using this data, Identity Protection generates reports and alerts that enables you to investigate these risk events and take appropriate action.</span></span> <span data-ttu-id="56583-181">有关详细信息，请参阅 [Azure Active Directory Identity Protection][aad-identity-protection]。</span><span class="sxs-lookup"><span data-stu-id="56583-181">For more information, see [Azure Active Directory Identity Protection][aad-identity-protection].</span></span>

<span data-ttu-id="56583-182">可以在 Azure 门户中使用 Azure AD 的报告功能，来监视系统中发生的与安全相关的活动。</span><span class="sxs-lookup"><span data-stu-id="56583-182">You can use the reporting feature of Azure AD in the Azure portal to monitor security-related activities occurring in your system.</span></span> <span data-ttu-id="56583-183">有关使用这些报告的详细信息，请参阅 [Azure Active Directory 报告指南][aad-reporting-guide]。</span><span class="sxs-lookup"><span data-stu-id="56583-183">For more information about using these reports, see [Azure Active Directory Reporting Guide][aad-reporting-guide].</span></span>

### <a name="topology-recommendations"></a><span data-ttu-id="56583-184">拓扑建议</span><span class="sxs-lookup"><span data-stu-id="56583-184">Topology recommendations</span></span>

<span data-ttu-id="56583-185">配置 Azure AD Connect，以实现最符合组织要求的拓扑。</span><span class="sxs-lookup"><span data-stu-id="56583-185">Configure Azure AD Connect to implement a topology that most closely matches the requirements of your organization.</span></span> <span data-ttu-id="56583-186">Azure AD Connect 支持的拓扑如下所示：</span><span class="sxs-lookup"><span data-stu-id="56583-186">Topologies that Azure AD Connect supports include the following:</span></span>

- <span data-ttu-id="56583-187">**单个林，单个 Azure AD 目录**。</span><span class="sxs-lookup"><span data-stu-id="56583-187">**Single forest, single Azure AD directory**.</span></span> <span data-ttu-id="56583-188">在此拓扑中，Azure AD Connect 将单个本地林的一个或多个域中的对象和标识信息同步到单个 Azure AD 租户。</span><span class="sxs-lookup"><span data-stu-id="56583-188">In this topology, Azure AD Connect synchronizes objects and identity information from one or more domains in a single on-premises forest into a single Azure AD tenant.</span></span> <span data-ttu-id="56583-189">这是通过 Azure AD Connect 的快速安装实现的默认拓扑。</span><span class="sxs-lookup"><span data-stu-id="56583-189">This is the default topology implemented by the express installation of Azure AD Connect.</span></span>

  > [!NOTE]
  > <span data-ttu-id="56583-190">除非在临时模式下运行服务器（如下所述），否则不要使用多台 Azure AD Connect 同步服务器将同一本地林中的不同域连接到同一 Azure AD 租户。</span><span class="sxs-lookup"><span data-stu-id="56583-190">Don't use multiple Azure AD Connect sync servers to connect different domains in the same on-premises forest to the same Azure AD tenant, unless you are running a server in staging mode, described below.</span></span>
  >
  >

- <span data-ttu-id="56583-191">**多个林，单个 Azure AD 目录**。</span><span class="sxs-lookup"><span data-stu-id="56583-191">**Multiple forests, single Azure AD directory**.</span></span> <span data-ttu-id="56583-192">在此拓扑中，Azure AD Connect 将多个林中的对象和标识信息同步到单个 Azure AD 租户。</span><span class="sxs-lookup"><span data-stu-id="56583-192">In this topology, Azure AD Connect synchronizes objects and identity information from multiple forests into a single Azure AD tenant.</span></span> <span data-ttu-id="56583-193">如果组织有多个本地林，则使用此拓扑。</span><span class="sxs-lookup"><span data-stu-id="56583-193">Use this topology if your organization has more than one on-premises forest.</span></span> <span data-ttu-id="56583-194">你可以合并标识信息，以便每个唯一的用户在 Azure AD 目录中只出现一次，即使同一用户存在于多个林也是如此。</span><span class="sxs-lookup"><span data-stu-id="56583-194">You can consolidate identity information so that each unique user is represented once in the Azure AD directory, even if the same user exists in more than one forest.</span></span> <span data-ttu-id="56583-195">所有林使用同一台 Azure AD Connect 同步服务器。</span><span class="sxs-lookup"><span data-stu-id="56583-195">All forests use the same Azure AD Connect sync server.</span></span> <span data-ttu-id="56583-196">Azure AD Connect 同步服务器不必属于任何域，但必须可从所有林访问该服务器。</span><span class="sxs-lookup"><span data-stu-id="56583-196">The Azure AD Connect sync server does not have to be part of any domain, but it must be reachable from all forests.</span></span>

  > [!NOTE]
  > <span data-ttu-id="56583-197">在此拓扑中，请勿使用不同的 Azure AD Connect 同步服务器将每个本地林连接到单个 Azure AD 租户。</span><span class="sxs-lookup"><span data-stu-id="56583-197">In this topology, don't use separate Azure AD Connect sync servers to connect each on-premises forest to a single Azure AD tenant.</span></span> <span data-ttu-id="56583-198">如果用户同时存在于多个林，这会导致 Azure AD 中的标识信息重复。</span><span class="sxs-lookup"><span data-stu-id="56583-198">This can result in duplicated identity information in Azure AD if users are present in more than one forest.</span></span>
  >

- <span data-ttu-id="56583-199">**多个林，不同的拓扑**。</span><span class="sxs-lookup"><span data-stu-id="56583-199">**Multiple forests, separate topologies**.</span></span> <span data-ttu-id="56583-200">此拓扑将不同林中的标识信息合并到单个 Azure AD 租户，并视所有林为不同的实体。</span><span class="sxs-lookup"><span data-stu-id="56583-200">This topology merges identity information from separate forests into a single Azure AD tenant, treating all forests as separate entities.</span></span> <span data-ttu-id="56583-201">如果合并来自不同组织的林，并且每个用户的标识信息仅保存在一个林中，则此拓扑非常有用。</span><span class="sxs-lookup"><span data-stu-id="56583-201">This topology is useful if you are combining forests from different organizations and the identity information for each user is held in only one forest.</span></span>

  > [!NOTE]
  > <span data-ttu-id="56583-202">如果同步每个林中的全局地址列表 (GAL)，则一个林中的用户可能会以联系人的身份出现在另一个林中。</span><span class="sxs-lookup"><span data-stu-id="56583-202">If the global address lists (GAL) in each forest are synchronized, a user in one forest may be present in another as a contact.</span></span> <span data-ttu-id="56583-203">如果组织已使用 Forefront Identity Manager 2010 或 Microsoft Identity Manager 2016 实现 GALSync，则会出现此问题。</span><span class="sxs-lookup"><span data-stu-id="56583-203">This can occur if your organization has implemented GALSync with Forefront Identity manager 2010 or Microsoft Identity Manager 2016.</span></span> <span data-ttu-id="56583-204">在这种情况下，可以指定应通过 *Mail* 属性识别用户。</span><span class="sxs-lookup"><span data-stu-id="56583-204">In this scenario, you can specify that users should be identified by their *Mail* attribute.</span></span> <span data-ttu-id="56583-205">也可以使用 *ObjectSID* 和 *msExchMasterAccountSID* 属性匹配标识。</span><span class="sxs-lookup"><span data-stu-id="56583-205">You can also match identities using the *ObjectSID* and *msExchMasterAccountSID* attributes.</span></span> <span data-ttu-id="56583-206">如果有一个或多个包含已禁用帐户的资源林，则此方法很有用。</span><span class="sxs-lookup"><span data-stu-id="56583-206">This is useful if you have one or more resource forests with disabled accounts.</span></span>
  >

- <span data-ttu-id="56583-207">**临时服务器**。</span><span class="sxs-lookup"><span data-stu-id="56583-207">**Staging server**.</span></span> <span data-ttu-id="56583-208">在此配置中，将 Azure AD Connect 同步服务器的第二个实例与第一个实例并行运行。</span><span class="sxs-lookup"><span data-stu-id="56583-208">In this configuration, you run a second instance of the Azure AD Connect sync server in parallel with the first.</span></span> <span data-ttu-id="56583-209">此结构支持如下方案：</span><span class="sxs-lookup"><span data-stu-id="56583-209">This structure supports scenarios such as:</span></span>

  - <span data-ttu-id="56583-210">高可用性。</span><span class="sxs-lookup"><span data-stu-id="56583-210">High availability.</span></span>
  - <span data-ttu-id="56583-211">测试和部署 Azure AD Connect 同步服务器的新配置。</span><span class="sxs-lookup"><span data-stu-id="56583-211">Testing and deploying a new configuration of the Azure AD Connect sync server.</span></span>
  - <span data-ttu-id="56583-212">引入新服务器，并取消旧配置。</span><span class="sxs-lookup"><span data-stu-id="56583-212">Introducing a new server and decommissioning an old configuration.</span></span>

    <span data-ttu-id="56583-213">在这些方案中，第二个实例在*临时模式*下运行。</span><span class="sxs-lookup"><span data-stu-id="56583-213">In these scenarios, the second instance runs in *staging mode*.</span></span> <span data-ttu-id="56583-214">服务器将导入的对象和同步数据记录到数据库中，但不将数据传递给 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="56583-214">The server records imported objects and synchronization data in its database, but does not pass the data to Azure AD.</span></span> <span data-ttu-id="56583-215">如果禁用临时模式，服务器除了开始将数据写入到 Azure AD，还会在本地目录中的适当位置开始执行密码回写。</span><span class="sxs-lookup"><span data-stu-id="56583-215">If you disable staging mode, the server starts writing data to Azure AD, and also starts performing password write-backs into the on-premises directories where appropriate.</span></span> <span data-ttu-id="56583-216">有关详细信息，请参阅 [Azure AD Connect 同步：操作任务和注意事项][aad-connect-sync-operational-tasks]。</span><span class="sxs-lookup"><span data-stu-id="56583-216">For more information, see [Azure AD Connect sync: Operational tasks and considerations][aad-connect-sync-operational-tasks].</span></span>

- <span data-ttu-id="56583-217">**多个 Azure AD 目录**。</span><span class="sxs-lookup"><span data-stu-id="56583-217">**Multiple Azure AD directories**.</span></span> <span data-ttu-id="56583-218">建议为组织创建单个 Azure AD 目录，但在某些情况下，可能需要将信息分区到不同的 Azure AD 目录中。</span><span class="sxs-lookup"><span data-stu-id="56583-218">It is recommended that you create a single Azure AD directory for an organization, but there may be situations where you need to partition information across separate Azure AD directories.</span></span> <span data-ttu-id="56583-219">在这种情况下，应确保本地林中的每个对象仅在一个 Azure AD 目录中出现，以免出现同步和密码回写问题。</span><span class="sxs-lookup"><span data-stu-id="56583-219">In this case, avoid synchronization and password write-back issues by ensuring that each object from the on-premises forest appears in only one Azure AD directory.</span></span> <span data-ttu-id="56583-220">若要实现此方案，请为每个 Azure AD 目录配置不同的 Azure AD Connect 同步服务器，并使用筛选，以便各 Azure AD Connect 同步服务器在一组互相排斥的对象上运行。</span><span class="sxs-lookup"><span data-stu-id="56583-220">To implement this scenario, configure separate Azure AD Connect sync servers for each Azure AD directory, and use filtering so that each Azure AD Connect sync server operates on a mutually exclusive set of objects.</span></span>

<span data-ttu-id="56583-221">有关这些拓扑的详细信息，请参阅 [Azure AD Connect 的拓扑][aad-topologies]。</span><span class="sxs-lookup"><span data-stu-id="56583-221">For more information about these topologies, see [Topologies for Azure AD Connect][aad-topologies].</span></span>

### <a name="user-authentication"></a><span data-ttu-id="56583-222">用户身份验证</span><span class="sxs-lookup"><span data-stu-id="56583-222">User authentication</span></span>

<span data-ttu-id="56583-223">默认情况下，Azure AD Connect 同步服务器会在本地域和 Azure AD 之间配置密码哈希同步，并且 Azure AD 服务假定用户通过提供他们在本地使用的密码进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="56583-223">By default, the Azure AD Connect sync server configures password hash synchronization between the on-premises domain and Azure AD, and the Azure AD service assumes that users authenticate by providing the same password that they use on-premises.</span></span> <span data-ttu-id="56583-224">许多组织支持这种做法，但你应当考虑自己组织现有的策略和基础结构。</span><span class="sxs-lookup"><span data-stu-id="56583-224">For many organizations, this is appropriate, but you should consider your organization's existing policies and infrastructure.</span></span> <span data-ttu-id="56583-225">例如：</span><span class="sxs-lookup"><span data-stu-id="56583-225">For example:</span></span>

- <span data-ttu-id="56583-226">组织的安全策略可能禁止将密码哈希同步到云。</span><span class="sxs-lookup"><span data-stu-id="56583-226">The security policy of your organization may prohibit synchronizing password hashes to the cloud.</span></span> <span data-ttu-id="56583-227">在这种情况下，组织应考虑[直通身份验证](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication)。</span><span class="sxs-lookup"><span data-stu-id="56583-227">In this case your organization should consider [pass-through authentication](/azure/active-directory/connect/active-directory-aadconnect-pass-through-authentication).</span></span>
- <span data-ttu-id="56583-228">你可能要求用户从公司网络访问已加入域的计算机中的云资源时，使用无缝单一登录 (SSO)。</span><span class="sxs-lookup"><span data-stu-id="56583-228">You might require that users experience seamless single sign-on (SSO) when accessing cloud resources from domain-joined machines on the corporate network.</span></span>
- <span data-ttu-id="56583-229">贵组织可能已部署 Active Directory 联合身份验证服务 (AD FS) 或第三方联合身份验证提供程序。</span><span class="sxs-lookup"><span data-stu-id="56583-229">Your organization might already have Active Directory Federation Services (AD FS) or a third party federation provider deployed.</span></span> <span data-ttu-id="56583-230">你可以将 Azure AD 配置为使用此基础结构实施身份验证和 SSO，而不是使用保存在云中的密码信息。</span><span class="sxs-lookup"><span data-stu-id="56583-230">You can configure Azure AD to use this infrastructure to implement authentication and SSO rather than by using password information held in the cloud.</span></span>

<span data-ttu-id="56583-231">有关详细信息，请参阅 [Azure AD Connect 用户登录选项][aad-user-sign-in]。</span><span class="sxs-lookup"><span data-stu-id="56583-231">For more information, see [Azure AD Connect User Sign on options][aad-user-sign-in].</span></span>

### <a name="azure-ad-application-proxy"></a><span data-ttu-id="56583-232">Azure AD 应用程序代理</span><span class="sxs-lookup"><span data-stu-id="56583-232">Azure AD application proxy</span></span>

<span data-ttu-id="56583-233">使用 Azure AD 可提供对本地应用程序的访问。</span><span class="sxs-lookup"><span data-stu-id="56583-233">Use Azure AD to provide access to on-premises applications.</span></span>

<span data-ttu-id="56583-234">使用由 Azure AD 应用程序代理组件管理的应用程序代理连接器，公开本地 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="56583-234">Expose your on-premises web applications using application proxy connectors managed by the Azure AD application proxy component.</span></span> <span data-ttu-id="56583-235">应用程序代理连接器与 Azure AD 应用程序代理建立出站网络连接，远程用户的请求通过此连接从 Azure AD 路由回 Web 应用。</span><span class="sxs-lookup"><span data-stu-id="56583-235">The application proxy connector opens an outbound network connection to the Azure AD application proxy, and remote users' requests are routed back from Azure AD through this connection to the web apps.</span></span> <span data-ttu-id="56583-236">这无需在本地防火墙中打开入站端口，减少了贵组织暴露的受攻击面。</span><span class="sxs-lookup"><span data-stu-id="56583-236">This removes the need to open inbound ports in the on-premises firewall and reduces the attack surface exposed by your organization.</span></span>

<span data-ttu-id="56583-237">有关详细信息，请参阅[使用 Azure AD 应用程序代理发布应用程序][aad-application-proxy]。</span><span class="sxs-lookup"><span data-stu-id="56583-237">For more information, see [Publish applications using Azure AD Application proxy][aad-application-proxy].</span></span>

### <a name="object-synchronization"></a><span data-ttu-id="56583-238">对象同步</span><span class="sxs-lookup"><span data-stu-id="56583-238">Object synchronization</span></span>

<span data-ttu-id="56583-239">Azure AD Connect 的默认配置基于 [Azure AD Connect 同步：了解默认配置][aad-connect-sync-default-rules]一文中指定的规则，同步本地 Active Directory 目录中的对象。</span><span class="sxs-lookup"><span data-stu-id="56583-239">Azure AD Connect's default configuration synchronizes objects from your local Active Directory directory based on the rules specified in the article [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span> <span data-ttu-id="56583-240">将同步满足这些规则的对象，而忽略所有其他对象。</span><span class="sxs-lookup"><span data-stu-id="56583-240">Objects that satisfy these rules are synchronized while all other objects are ignored.</span></span> <span data-ttu-id="56583-241">一些示例规则：</span><span class="sxs-lookup"><span data-stu-id="56583-241">Some example rules:</span></span>

- <span data-ttu-id="56583-242">用户对象必须具有唯一的 *sourceAnchor* 属性，并且必须已填充 *accountEnabled* 属性。</span><span class="sxs-lookup"><span data-stu-id="56583-242">User objects must have a unique *sourceAnchor* attribute and the *accountEnabled* attribute must be populated.</span></span>
- <span data-ttu-id="56583-243">用户对象必须具有 *sAMAccountName* 属性，并且不能以文本 *Azure AD_* 或 *MSOL_* 开头。</span><span class="sxs-lookup"><span data-stu-id="56583-243">User objects must have a *sAMAccountName* attribute and cannot start with the text *Azure AD_* or *MSOL_*.</span></span>

<span data-ttu-id="56583-244">Azure AD Connect 可向 User、Contact、Group、ForeignSecurityPrincipal 和 Computer 对象应用多种规则。</span><span class="sxs-lookup"><span data-stu-id="56583-244">Azure AD Connect applies several rules to User, Contact, Group, ForeignSecurityPrincipal, and Computer objects.</span></span> <span data-ttu-id="56583-245">如果需要修改默认规则集，请使用随 Azure AD Connect 一起安装的同步规则编辑器。</span><span class="sxs-lookup"><span data-stu-id="56583-245">Use the Synchronization Rules Editor installed with Azure AD Connect if you need to modify the default set of rules.</span></span> <span data-ttu-id="56583-246">有关详细信息，请参阅 [Azure AD Connect 同步：了解默认配置][aad-connect-sync-default-rules]。</span><span class="sxs-lookup"><span data-stu-id="56583-246">For more information, see [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules]).</span></span>

<span data-ttu-id="56583-247">也可以定义自己的筛选器，以限制域或 OU 要同步的对象。</span><span class="sxs-lookup"><span data-stu-id="56583-247">You can also define your own filters to limit the objects to be synchronized by domain or OU.</span></span> <span data-ttu-id="56583-248">或者，还可以如 [Azure AD Connect 同步：配置筛选][aad-filtering]中所述，实施更复杂的自定义筛选。</span><span class="sxs-lookup"><span data-stu-id="56583-248">Alternatively, you can implement more complex custom filtering such as that described in [Azure AD Connect sync: Configure Filtering][aad-filtering].</span></span>

### <a name="monitoring"></a><span data-ttu-id="56583-249">监视</span><span class="sxs-lookup"><span data-stu-id="56583-249">Monitoring</span></span>

<span data-ttu-id="56583-250">运行状况监视由安装在本地的以下代理执行：</span><span class="sxs-lookup"><span data-stu-id="56583-250">Health monitoring is performed by the following agents installed on-premises:</span></span>

- <span data-ttu-id="56583-251">Azure AD Connect 安装了一个用于捕获同步操作相关信息的代理。</span><span class="sxs-lookup"><span data-stu-id="56583-251">Azure AD Connect installs an agent that captures information about synchronization operations.</span></span> <span data-ttu-id="56583-252">可使用 Azure 门户中的 Azure AD Connect Health 边栏选项卡监视其运行状况和性能。</span><span class="sxs-lookup"><span data-stu-id="56583-252">Use the Azure AD Connect Health blade in the Azure portal to monitor its health and performance.</span></span> <span data-ttu-id="56583-253">有关详细信息，请参阅[使用 Azure AD Connect Health 进行同步][aad-health]。</span><span class="sxs-lookup"><span data-stu-id="56583-253">For more information, see [Using Azure AD Connect Health for sync][aad-health].</span></span>
- <span data-ttu-id="56583-254">若要从 Azure 监视 AD DS 域和目录的运行状况，请在本地域内的计算机上安装用于 AD DS 代理的 Azure AD Connect Health。</span><span class="sxs-lookup"><span data-stu-id="56583-254">To monitor the health of the AD DS domains and directories from Azure, install the Azure AD Connect Health for AD DS agent on a machine within the on-premises domain.</span></span> <span data-ttu-id="56583-255">可使用 Azure 门户中的 Azure Active Directory Connect Health 边栏选项卡监视运行状况。</span><span class="sxs-lookup"><span data-stu-id="56583-255">Use the Azure Active Directory Connect Health blade in the Azure portal for health monitoring.</span></span> <span data-ttu-id="56583-256">有关详细信息，请参阅[在 AD DS 中使用 Azure AD Connect Health][aad-health-adds]</span><span class="sxs-lookup"><span data-stu-id="56583-256">For more information, see [Using Azure AD Connect Health with AD DS][aad-health-adds]</span></span>
- <span data-ttu-id="56583-257">安装用于 AD FS 代理的 Azure AD Connect Health，以监视本地运行的服务的运行状况，并使用 Azure 门户中的 Azure Active Directory Connect Health 边栏选项卡监视 AD FS。</span><span class="sxs-lookup"><span data-stu-id="56583-257">Install the Azure AD Connect Health for AD FS agent to monitor the health of services running on on-premises, and use the Azure Active Directory Connect Health blade in the Azure portal to monitor AD FS.</span></span> <span data-ttu-id="56583-258">有关详细信息，请参阅[在 AD FS 中使用 Azure AD Connect Health][aad-health-adfs]</span><span class="sxs-lookup"><span data-stu-id="56583-258">For more information, see [Using Azure AD Connect Health with AD FS][aad-health-adfs]</span></span>

<span data-ttu-id="56583-259">有关安装 AD Connect Health 代理及其要求的详细信息，请参阅 [Azure AD Connect Health 代理安装][aad-agent-installation]。</span><span class="sxs-lookup"><span data-stu-id="56583-259">For more information on installing the AD Connect Health agents and their requirements, see [Azure AD Connect Health Agent Installation][aad-agent-installation].</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="56583-260">可伸缩性注意事项</span><span class="sxs-lookup"><span data-stu-id="56583-260">Scalability considerations</span></span>

<span data-ttu-id="56583-261">Azure AD 服务支持基于副本（一个处理写入操作的主要副本，以及多个只读次要副本）的可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="56583-261">The Azure AD service supports scalability based on replicas, with a single primary replica that handles write operations plus multiple read-only secondary replicas.</span></span> <span data-ttu-id="56583-262">Azure AD 将对次要副本尝试进行的写入操作以透明方式重定向到主要副本，并提供最终一致性。</span><span class="sxs-lookup"><span data-stu-id="56583-262">Azure AD transparently redirects attempted writes made against secondary replicas to the primary replica and provides eventual consistency.</span></span> <span data-ttu-id="56583-263">对主要副本进行的所有更改都会传播到次要副本。</span><span class="sxs-lookup"><span data-stu-id="56583-263">All changes made to the primary replica are propagated to the secondary replicas.</span></span> <span data-ttu-id="56583-264">此体系结构的可伸缩性良好，因为针对 Azure AD 的大多数操作都是读取操作，而非写入操作。</span><span class="sxs-lookup"><span data-stu-id="56583-264">This architecture scales well because most operations against Azure AD are reads rather than writes.</span></span> <span data-ttu-id="56583-265">有关详细信息，请参阅 [Azure AD：揭秘异地冗余且高度可用的分布式云目录][aad-scalability]。</span><span class="sxs-lookup"><span data-stu-id="56583-265">For more information, see [Azure AD: Under the hood of our geo-redundant, highly available, distributed cloud directory][aad-scalability].</span></span>

<span data-ttu-id="56583-266">对于 Azure AD Connect 同步服务器，应确定可能从本地目录同步的对象数。</span><span class="sxs-lookup"><span data-stu-id="56583-266">For the Azure AD Connect sync server, determine how many objects you are likely to synchronize from your local directory.</span></span> <span data-ttu-id="56583-267">如果对象数少于 100,000 个，则可以使用 Azure AD Connect 随附的默认 SQL Server Express LocalDB 软件。</span><span class="sxs-lookup"><span data-stu-id="56583-267">If you have less than 100,000 objects, you can use the default SQL Server Express LocalDB software provided with Azure AD Connect.</span></span> <span data-ttu-id="56583-268">如果对象数超过此数，则应安装 SQL Server 的生产版本，并执行 Azure AD Connect 的自定义安装，以指定它应使用 SQL Server 的现有实例。</span><span class="sxs-lookup"><span data-stu-id="56583-268">If you have a larger number of objects, you should install a production version of SQL Server and perform a custom installation of Azure AD Connect, specifying that it should use an existing instance of SQL Server.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="56583-269">可用性注意事项</span><span class="sxs-lookup"><span data-stu-id="56583-269">Availability considerations</span></span>

<span data-ttu-id="56583-270">Azure AD 服务是一种异地分布式服务，它在分布于世界各地的多个数据中心内运行，并提供自动故障转移功能。</span><span class="sxs-lookup"><span data-stu-id="56583-270">The Azure AD service is geo-distributed and runs in multiple data centers spread around the world with automated failover.</span></span> <span data-ttu-id="56583-271">如果某个数据中心变得不可用，Azure AD 可确保分散在不同区域的至少两个数据中心的目录数据可供实例访问。</span><span class="sxs-lookup"><span data-stu-id="56583-271">If a data center becomes unavailable, Azure AD ensures that your directory data is available for instance access in at least two more regionally dispersed data centers.</span></span>

> [!NOTE]
> <span data-ttu-id="56583-272">Azure AD Basic 和 Premium 服务的服务级别协议 (SLA) 保证至少 99.9% 的可用性。</span><span class="sxs-lookup"><span data-stu-id="56583-272">The service level agreement (SLA) for Azure AD Basic and Premium services guarantees at least 99.9% availability.</span></span> <span data-ttu-id="56583-273">Azure AD 免费层没有 SLA。</span><span class="sxs-lookup"><span data-stu-id="56583-273">There is no SLA for the Free tier of Azure AD.</span></span> <span data-ttu-id="56583-274">有关详细信息，请参阅 [Azure Active Directory 的 SLA][sla-aad]。</span><span class="sxs-lookup"><span data-stu-id="56583-274">For more information, see [SLA for Azure Active Directory][sla-aad].</span></span>
>

<span data-ttu-id="56583-275">请考虑在临时模式下预配 Azure AD Connect 同步服务器的第二个实例来提高可用性，如“拓扑建议”部分中所述。</span><span class="sxs-lookup"><span data-stu-id="56583-275">Consider provisioning a second instance of Azure AD Connect sync server in staging mode to increase availability, as discussed in the topology recommendations section.</span></span>

<span data-ttu-id="56583-276">如果未使用 Azure AD Connect 随附的 SQL Server Express LocalDB 实例，请考虑使用 SQL 群集来实现高可用性。</span><span class="sxs-lookup"><span data-stu-id="56583-276">If you are not using the SQL Server Express LocalDB instance that comes with Azure AD Connect, consider using SQL clustering to achieve high availability.</span></span> <span data-ttu-id="56583-277">Azure AD Connect 不支持镜像和 Always On 等解决方案。</span><span class="sxs-lookup"><span data-stu-id="56583-277">Solutions such as mirroring and Always On are not supported by Azure AD Connect.</span></span>

<span data-ttu-id="56583-278">有关如何实现 Azure AD Connect 同步服务器的高可用性以及如何在发生故障后恢复的其他注意事项，请参阅 [Azure AD Connect 同步：操作任务和注意事项 - 灾难恢复][aad-sync-disaster-recovery]。</span><span class="sxs-lookup"><span data-stu-id="56583-278">For additional considerations about achieving high availability of the Azure AD Connect sync server and also how to recover after a failure, see [Azure AD Connect sync: Operational tasks and considerations - Disaster Recovery][aad-sync-disaster-recovery].</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="56583-279">可管理性注意事项</span><span class="sxs-lookup"><span data-stu-id="56583-279">Manageability considerations</span></span>

<span data-ttu-id="56583-280">可从两方面管理 Azure AD：</span><span class="sxs-lookup"><span data-stu-id="56583-280">There are two aspects to managing Azure AD:</span></span>

- <span data-ttu-id="56583-281">在云中管理 Azure AD。</span><span class="sxs-lookup"><span data-stu-id="56583-281">Administering Azure AD in the cloud.</span></span>
- <span data-ttu-id="56583-282">维护 Azure AD Connect 同步服务器。</span><span class="sxs-lookup"><span data-stu-id="56583-282">Maintaining the Azure AD Connect sync servers.</span></span>

<span data-ttu-id="56583-283">Azure AD 提供以下选项，用于在云中管理域和目录：</span><span class="sxs-lookup"><span data-stu-id="56583-283">Azure AD provides the following options for managing domains and directories in the cloud:</span></span>

- <span data-ttu-id="56583-284">**Azure Active Directory PowerShell 模块**。</span><span class="sxs-lookup"><span data-stu-id="56583-284">**Azure Active Directory PowerShell Module**.</span></span> <span data-ttu-id="56583-285">如果需要编写常见 Azure AD 管理任务（比如用户管理、域管理和配置单一登录）的脚本，则使用此[模块][aad-powershell]。</span><span class="sxs-lookup"><span data-stu-id="56583-285">Use this [module][aad-powershell] if you need to script common Azure AD administrative tasks such as user management, domain management, and configuring single sign-on.</span></span>
- <span data-ttu-id="56583-286">**Azure 门户中的 Azure AD 管理边栏选项卡**。</span><span class="sxs-lookup"><span data-stu-id="56583-286">**Azure AD management blade in the Azure portal**.</span></span> <span data-ttu-id="56583-287">此边栏选项卡提供目录的交互式管理视图，并且可用于控制和配置 Azure AD 的大多数方面。</span><span class="sxs-lookup"><span data-stu-id="56583-287">This blade provides an interactive management view of the directory, and enables you to control and configure most aspects of Azure AD.</span></span>

<span data-ttu-id="56583-288">Azure AD Connect 通过安装以下工具来维护本地计算机中的 Azure AD Connect 同步服务：</span><span class="sxs-lookup"><span data-stu-id="56583-288">Azure AD Connect installs the following tools to maintain Azure AD Connect sync services from your on-premises machines:</span></span>

- <span data-ttu-id="56583-289">**Microsoft Azure Active Directory Connect 控制台**。</span><span class="sxs-lookup"><span data-stu-id="56583-289">**Microsoft Azure Active Directory Connect console**.</span></span> <span data-ttu-id="56583-290">此工具可用于修改 Azure AD Sync 服务器的配置、自定义同步方式、启用或禁用临时模式以及切换用户登录模式。</span><span class="sxs-lookup"><span data-stu-id="56583-290">This tool enables you to modify the configuration of the Azure AD Sync server, customize how synchronization occurs, enable or disable staging mode, and switch the user sign-in mode.</span></span> <span data-ttu-id="56583-291">请注意，可以使用本地基础结构启用 Active Directory FS 登录。</span><span class="sxs-lookup"><span data-stu-id="56583-291">Note that you can enable Active Directory FS sign-in using your on-premises infrastructure.</span></span>
- <span data-ttu-id="56583-292">**Synchronization Service Manager**。</span><span class="sxs-lookup"><span data-stu-id="56583-292">**Synchronization Service Manager**.</span></span> <span data-ttu-id="56583-293">此工具中的*操作*选项卡用于管理同步过程并检测该过程的任何环节是否失败。</span><span class="sxs-lookup"><span data-stu-id="56583-293">Use the *Operations* tab in this tool to manage the synchronization process and detect whether any parts of the process have failed.</span></span> <span data-ttu-id="56583-294">可以使用此工具手动触发同步。</span><span class="sxs-lookup"><span data-stu-id="56583-294">You can trigger synchronizations manually using this tool.</span></span> <span data-ttu-id="56583-295">*连接器*选项卡用于控制同步引擎附加到的域的连接。</span><span class="sxs-lookup"><span data-stu-id="56583-295">The *Connectors* tab enables you to control the connections for the domains that the synchronization engine is attached to.</span></span>
- <span data-ttu-id="56583-296">**同步规则编辑器**。</span><span class="sxs-lookup"><span data-stu-id="56583-296">**Synchronization Rules Editor**.</span></span> <span data-ttu-id="56583-297">此工具用于自定义在本地目录与 Azure AD 之间复制对象时对象的转换方式。</span><span class="sxs-lookup"><span data-stu-id="56583-297">Use this tool to customize the way objects are transformed when they are copied between an on-premises directory and Azure AD.</span></span> <span data-ttu-id="56583-298">使用此工具，可指定同步的其他属性和对象，然后执行筛选器以确定应该同步或不应该同步的对象。</span><span class="sxs-lookup"><span data-stu-id="56583-298">This tool enables you to specify additional attributes and objects for synchronization, then executes filters to determine which objects should or should not be synchronized.</span></span> <span data-ttu-id="56583-299">有关详细信息，请参阅 [Azure AD Connect 同步：了解默认配置][aad-connect-sync-default-rules]文档中的“同步规则编辑器”部分。</span><span class="sxs-lookup"><span data-stu-id="56583-299">For more information, see the Synchronization Rule Editor section in the document [Azure AD Connect sync: Understanding the default configuration][aad-connect-sync-default-rules].</span></span>

<span data-ttu-id="56583-300">有关如何管理 Azure AD Connect 的详细信息和提示，请参阅 [Azure AD Connect 同步：更改默认配置的最佳做法][aad-sync-best-practices]。</span><span class="sxs-lookup"><span data-stu-id="56583-300">For more information and tips for managing Azure AD Connect, see [Azure AD Connect sync: Best practices for changing the default configuration][aad-sync-best-practices].</span></span>

## <a name="security-considerations"></a><span data-ttu-id="56583-301">安全注意事项</span><span class="sxs-lookup"><span data-stu-id="56583-301">Security considerations</span></span>

<span data-ttu-id="56583-302">可使用条件访问控制拒绝来自意外来源的身份验证请求：</span><span class="sxs-lookup"><span data-stu-id="56583-302">Use conditional access control to deny authentication requests from unexpected sources:</span></span>

- <span data-ttu-id="56583-303">如果用户尝试从不受信任的位置（比如从 Internet，而不是从受信任的网络）进行连接，则触发 [Azure 多重身份验证 (MFA)][azure-multifactor-authentication]。</span><span class="sxs-lookup"><span data-stu-id="56583-303">Trigger [Azure Multi-Factor Authentication (MFA)][azure-multifactor-authentication] if a user attempts to connect from a nontrusted location such as across the Internet instead of a trusted network.</span></span>

- <span data-ttu-id="56583-304">使用用户的设备平台类型（iOS、Android、Windows Mobile、Windows）来确定应用程序和功能的访问策略。</span><span class="sxs-lookup"><span data-stu-id="56583-304">Use the device platform type of the user (iOS, Android, Windows Mobile, Windows) to determine access policy to applications and features.</span></span>

- <span data-ttu-id="56583-305">记录用户设备的启用/禁用状态，并将此信息合并到访问策略检查中。</span><span class="sxs-lookup"><span data-stu-id="56583-305">Record the enabled/disabled state of users' devices, and incorporate this information into the access policy checks.</span></span> <span data-ttu-id="56583-306">例如，如果用户的电话丢失或被盗，应将它记录为已禁用，防止有人用它来获取访问权限。</span><span class="sxs-lookup"><span data-stu-id="56583-306">For example, if a user's phone is lost or stolen it should be recorded as disabled to prevent it from being used to gain access.</span></span>

- <span data-ttu-id="56583-307">基于组成员资格控制用户对资源的访问权限。</span><span class="sxs-lookup"><span data-stu-id="56583-307">Control user access to resources based on group membership.</span></span> <span data-ttu-id="56583-308">可使用 [Azure AD 动态成员资格规则][aad-dynamic-membership-rules]简化组管理。</span><span class="sxs-lookup"><span data-stu-id="56583-308">Use [Azure AD dynamic membership rules][aad-dynamic-membership-rules] to simplify group administration.</span></span> <span data-ttu-id="56583-309">有关其工作原理的简要概述，请参阅[组动态成员资格简介][aad-dynamic-memberships]。</span><span class="sxs-lookup"><span data-stu-id="56583-309">For a brief overview of how this works, see [Introduction to Dynamic Memberships for Groups][aad-dynamic-memberships].</span></span>

- <span data-ttu-id="56583-310">将条件访问风险策略与 Azure AD Identity Protection 结合使用，基于异常登录活动或其他事件提供高级保护。</span><span class="sxs-lookup"><span data-stu-id="56583-310">Use conditional access risk policies with Azure AD Identity Protection to provide advanced protection based on unusual sign-in activities or other events.</span></span>

<span data-ttu-id="56583-311">有关详细信息，请参阅 [Azure Active Directory 条件访问][aad-conditional-access]。</span><span class="sxs-lookup"><span data-stu-id="56583-311">For more information, see [Azure Active Directory conditional access][aad-conditional-access].</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="56583-312">部署解决方案</span><span class="sxs-lookup"><span data-stu-id="56583-312">Deploy the solution</span></span>

<span data-ttu-id="56583-313">GitHub 上提供了可实施这些建议和注意事项的参考体系结构部署。</span><span class="sxs-lookup"><span data-stu-id="56583-313">A deployment for a reference architecture that implements these recommendations and considerations is available on GitHub.</span></span> <span data-ttu-id="56583-314">此参考体系结构会在 Azure 中部署一个可用来测试和试验的模拟本地网络。</span><span class="sxs-lookup"><span data-stu-id="56583-314">This reference architecture deploys a simulated on-premises network in Azure that you can use to test and experiment.</span></span> <span data-ttu-id="56583-315">可以按照以下说明，使用 Windows VM 或 Linux VM 部署该参考体系结构：</span><span class="sxs-lookup"><span data-stu-id="56583-315">The reference architecture can be deployed with either with Windows or Linux VMs by following the directions below:</span></span>

<!-- markdownlint-disable MD033 -->

1. <span data-ttu-id="56583-316">单击下面的按钮：</span><span class="sxs-lookup"><span data-stu-id="56583-316">Click the button below:</span></span><br><a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fmspnp%2Fidentity-reference-architectures%2Fmaster%2Fazure-ad%2Fazuredeploy.json" target="_blank"><img src="https://azuredeploy.net/deploybutton.png"/></a>

2. <span data-ttu-id="56583-317">在 Azure 门户中打开该链接后，必须输入某些设置的值：</span><span class="sxs-lookup"><span data-stu-id="56583-317">Once the link has opened in the Azure portal, you must enter values for some of the settings:</span></span>
   - <span data-ttu-id="56583-318">参数文件中已定义**资源组**名称，因此请选择“新建”，并在文本框中输入 `ra-aad-onpremise-rg`。</span><span class="sxs-lookup"><span data-stu-id="56583-318">The **Resource group** name is already defined in the parameter file, so select **Create New** and enter `ra-aad-onpremise-rg` in the text box.</span></span>
   - <span data-ttu-id="56583-319">从“位置”下拉框中选择区域。</span><span class="sxs-lookup"><span data-stu-id="56583-319">Select the region from the **Location** drop down box.</span></span>
   - <span data-ttu-id="56583-320">不要编辑“模板根 URI”或“参数根 URI”文本框。</span><span class="sxs-lookup"><span data-stu-id="56583-320">Do not edit the **Template Root Uri** or the **Parameter Root Uri** text boxes.</span></span>
   - <span data-ttu-id="56583-321">从“OS 类型”下拉框中选择“Windows”或“Linux”。</span><span class="sxs-lookup"><span data-stu-id="56583-321">Select **windows** or **linux** in the **Os Type** the drop down box.</span></span>
   - <span data-ttu-id="56583-322">查看条款和条件，并单击“我同意上述条款和条件”复选框。</span><span class="sxs-lookup"><span data-stu-id="56583-322">Review the terms and conditions, then click the **I agree to the terms and conditions stated above** checkbox.</span></span>
   - <span data-ttu-id="56583-323">单击“购买”按钮。</span><span class="sxs-lookup"><span data-stu-id="56583-323">Click the **Purchase** button.</span></span>

3. <span data-ttu-id="56583-324">等待部署完成。</span><span class="sxs-lookup"><span data-stu-id="56583-324">Wait for the deployment to complete.</span></span>

4. <span data-ttu-id="56583-325">参数文件包括硬编码的管理员用户名和密码，强烈建议立即在所有 VM 上更改它们。</span><span class="sxs-lookup"><span data-stu-id="56583-325">The parameter files include a hard-coded administrator user names and passwords, and it is strongly recommended that you immediately change both on all the VMs.</span></span> <span data-ttu-id="56583-326">在 Azure 门户中单击每个 VM，然后，在“支持 + 故障排除”边栏选项卡中单击“重置密码”。</span><span class="sxs-lookup"><span data-stu-id="56583-326">Click each VM in the Azure Portal then click on **Reset password** in the **Support + troubleshooting** blade.</span></span> <span data-ttu-id="56583-327">从“模式”下拉框中选择“重置密码”，然后选择新的**用户名**和**密码**。</span><span class="sxs-lookup"><span data-stu-id="56583-327">Select **Reset password** in the **Mode** drop down box, then select a new **User name** and **Password**.</span></span> <span data-ttu-id="56583-328">单击“更新”按钮保存新用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="56583-328">Click the **Update** button to persist the new user name and password.</span></span>

<!-- markdownlint-disable MD033 -->

<!-- links -->

[implementing-a-multi-tier-architecture-on-Azure]: ../virtual-machines-windows/n-tier.md

[aad-agent-installation]: /azure/active-directory/active-directory-aadconnect-health-agent-install
[aad-application-proxy]: /azure/active-directory/active-directory-application-proxy-enable
[aad-conditional-access]: /azure/active-directory//active-directory-conditional-access
[aad-connect-sync-default-rules]: /azure/active-directory/hybrid/concept-azure-ad-connect-sync-default-configuration
[aad-connect-sync-operational-tasks]: /azure/active-directory/hybrid/how-to-connect-sync-operations
[aad-dynamic-memberships]: https://youtu.be/Tdiz2JqCl9Q
[aad-dynamic-membership-rules]: /azure/active-directory/active-directory-accessmanagement-groups-with-advanced-rules
[aad-editions]: /azure/active-directory/active-directory-editions
[aad-filtering]: /azure/active-directory/hybrid/how-to-connect-sync-configure-filtering
[aad-health]: /azure/active-directory/active-directory-aadconnect-health-sync
[aad-health-adds]: /azure/active-directory/active-directory-aadconnect-health-adds
[aad-health-adfs]: /azure/active-directory/active-directory-aadconnect-health-adfs
[aad-identity-protection]: /azure/active-directory/active-directory-identityprotection
[aad-password-management]: /azure/active-directory/active-directory-passwords-customize
[aad-powershell]: https://msdn.microsoft.com/library/azure/mt757189.aspx
[aad-reporting-guide]: /azure/active-directory/active-directory-reporting-guide
[aad-scalability]: https://blogs.technet.microsoft.com/enterprisemobility/2014/09/02/azure-ad-under-the-hood-of-our-geo-redundant-highly-available-distributed-cloud-directory/
[aad-sync-best-practices]: /azure/active-directory/hybrid/how-to-connect-sync-best-practices-changing-default-configuration
[aad-sync-disaster-recovery]: /azure/active-directory/hybrid/how-to-connect-sync-operations#disaster-recovery
[aad-sync-requirements]: /azure/active-directory/active-directory-hybrid-identity-design-considerations-directory-sync-requirements
[aad-topologies]: /azure/active-directory/hybrid/plan-connect-topologies
[aad-user-sign-in]: /azure/active-directory/hybrid/plan-connect-user-signin
[azure-active-directory]: /azure/active-directory-domain-services/active-directory-ds-overview
[azure-ad-connect]: /azure/active-directory/hybrid/whatis-hybrid-identity
[azure-multifactor-authentication]: /azure/multi-factor-authentication/multi-factor-authentication
[considerations]: ./considerations.md
[resource-manager-overview]: /azure/azure-resource-manager/resource-group-overview
[sla-aad]: https://azure.microsoft.com/support/legal/sla/active-directory
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
