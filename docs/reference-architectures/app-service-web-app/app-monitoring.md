---
title: Azure 上的 Web 应用程序监视
description: 监视 Azure 应用服务中托管的 Web 应用程序。
author: adamboeglin
ms.date: 12/12/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat
ms.openlocfilehash: 34c21f4b5356dc0acbd5c2c85124300a6ed13c99
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59640492"
---
# <a name="web-application-monitoring-on-azure"></a><span data-ttu-id="eb728-103">Azure 上的 Web 应用程序监视</span><span class="sxs-lookup"><span data-stu-id="eb728-103">Web application monitoring on Azure</span></span>

<span data-ttu-id="eb728-104">Azure 平台即服务 (PaaS) 产品/服务为你管理计算资源，并且影响你监视部署的方式。</span><span class="sxs-lookup"><span data-stu-id="eb728-104">Azure platform as a service (PaaS) offerings manage compute resources for you and affect how you monitor deployments.</span></span> <span data-ttu-id="eb728-105">Azure 包含多个监视服务，其中的每个服务发挥特定的作用。</span><span class="sxs-lookup"><span data-stu-id="eb728-105">Azure includes multiple monitoring services, each of which performs a specific role.</span></span> <span data-ttu-id="eb728-106">这些服务共同提供一个综合性的解决方案，可从应用程序及其使用的 Azure 资源收集、分析和处理遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-106">Together, these services deliver a comprehensive solution for collecting, analyzing, and acting on telemetry from your applications and the Azure resources they consume.</span></span>

<span data-ttu-id="eb728-107">本方案探讨可用的监视服务，并介绍可对多个数据源使用的数据流模型。</span><span class="sxs-lookup"><span data-stu-id="eb728-107">This scenario addresses the monitoring services you can use and describes a dataflow model for use with multiple data sources.</span></span> <span data-ttu-id="eb728-108">监视时，可将多个工具和服务用于 Azure 部署。</span><span class="sxs-lookup"><span data-stu-id="eb728-108">When it comes to monitoring, many tools and services work with Azure deployments.</span></span> <span data-ttu-id="eb728-109">在本方案中，我们确切地选择了随时可用的服务，因为它们易于使用。</span><span class="sxs-lookup"><span data-stu-id="eb728-109">In this scenario, we choose readily available services precisely because they are easy to consume.</span></span> <span data-ttu-id="eb728-110">本文稍后会介绍其他监视选项。</span><span class="sxs-lookup"><span data-stu-id="eb728-110">Other monitoring options are discussed later in this article.</span></span>

## <a name="relevant-use-cases"></a><span data-ttu-id="eb728-111">相关用例</span><span class="sxs-lookup"><span data-stu-id="eb728-111">Relevant use cases</span></span>

<span data-ttu-id="eb728-112">其他相关用例包括：</span><span class="sxs-lookup"><span data-stu-id="eb728-112">Other relevant use cases include:</span></span>

- <span data-ttu-id="eb728-113">检测一个用于监视遥测的 Web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="eb728-113">Instrumenting a web application for monitoring telemetry.</span></span>
- <span data-ttu-id="eb728-114">收集 Azure 上部署的某个应用程序的前端和后端遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-114">Collecting front-end and back-end telemetry for an application deployed on Azure.</span></span>
- <span data-ttu-id="eb728-115">监视与 Azure 上的服务关联的指标和配额。</span><span class="sxs-lookup"><span data-stu-id="eb728-115">Monitoring metrics and quotas associated with services on Azure.</span></span>

## <a name="architecture"></a><span data-ttu-id="eb728-116">体系结构</span><span class="sxs-lookup"><span data-stu-id="eb728-116">Architecture</span></span>

![“体系结构图”](./images/architecture-diagram-app-monitoring.svg)

<span data-ttu-id="eb728-118">本方案使用托管的 Azure 环境来托管应用程序和数据层。</span><span class="sxs-lookup"><span data-stu-id="eb728-118">This scenario uses a managed Azure environment to host an application and data tier.</span></span> <span data-ttu-id="eb728-119">数据流经方案的情形如下所示：</span><span class="sxs-lookup"><span data-stu-id="eb728-119">The data flows through the scenario as follows:</span></span>

1. <span data-ttu-id="eb728-120">用户与应用程序交互。</span><span class="sxs-lookup"><span data-stu-id="eb728-120">A user interacts with the application.</span></span>
2. <span data-ttu-id="eb728-121">浏览器和应用服务发出遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-121">The browser and app service emit telemetry.</span></span>
3. <span data-ttu-id="eb728-122">Application Insights 收集并分析应用程序运行状况、性能和使用情况数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-122">Application Insights collects and analyzes application health, performance, and usage data.</span></span>
4. <span data-ttu-id="eb728-123">开发人员和管理员可以查看运行状况、性能与使用情况信息。</span><span class="sxs-lookup"><span data-stu-id="eb728-123">Developers and administrators can review health, performance, and usage information.</span></span>
5. <span data-ttu-id="eb728-124">Azure SQL 数据库发出遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-124">Azure SQL Database emits telemetry.</span></span>
6. <span data-ttu-id="eb728-125">Azure Monitor 收集并分析基础结构指标和配额。</span><span class="sxs-lookup"><span data-stu-id="eb728-125">Azure Monitor collects and analyzes infrastructure metrics and quotas.</span></span>
7. <span data-ttu-id="eb728-126">Log Analytics 收集并分析日志和指标。</span><span class="sxs-lookup"><span data-stu-id="eb728-126">Log Analytics collects and analyzes logs and metrics.</span></span>
8. <span data-ttu-id="eb728-127">开发人员和管理员可以查看运行状况、性能与使用情况信息。</span><span class="sxs-lookup"><span data-stu-id="eb728-127">Developers and administrators can review health, performance, and usage information.</span></span>

### <a name="components"></a><span data-ttu-id="eb728-128">组件</span><span class="sxs-lookup"><span data-stu-id="eb728-128">Components</span></span>

- <span data-ttu-id="eb728-129">[Azure 应用服务](/azure/app-service/)是用于在托管虚拟机中生成和托管应用的 PaaS 服务。</span><span class="sxs-lookup"><span data-stu-id="eb728-129">[Azure App Service](/azure/app-service/) is a PaaS service for building and hosting apps in managed virtual machines.</span></span> <span data-ttu-id="eb728-130">系统会自动管理运行应用的底层计算基础结构。</span><span class="sxs-lookup"><span data-stu-id="eb728-130">The underlying compute infrastructures on which your apps run is managed for you.</span></span> <span data-ttu-id="eb728-131">应用服务提供资源使用配额和应用指标的监视、诊断信息的记录，以及基于指标的警报。</span><span class="sxs-lookup"><span data-stu-id="eb728-131">App Service provides monitoring of resource usage quotas and app metrics, logging of diagnostic information, and alerts based on metrics.</span></span> <span data-ttu-id="eb728-132">甚至可以使用 Application Insights 来创建[可用性测试][availability-tests]，以便在不同的区域测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="eb728-132">Even better, you can use Application Insights to create [availability tests][availability-tests] for testing your application from different regions.</span></span>
- <span data-ttu-id="eb728-133">[Application Insights][application-insights] 是支持多个平台的面向开发人员的可扩展应用程序性能管理 (APM) 服务。</span><span class="sxs-lookup"><span data-stu-id="eb728-133">[Application Insights][application-insights] is an extensible Application Performance Management (APM) service for developers and supports multiple platforms.</span></span> <span data-ttu-id="eb728-134">它可以监视应用程序、检测应用程序异常（例如性能不佳和故障），以及将遥测数据发送到 Azure 门户。</span><span class="sxs-lookup"><span data-stu-id="eb728-134">It monitors the application, detects application anomalies such as poor performance and failures, and sends telemetry to the Azure portal.</span></span> <span data-ttu-id="eb728-135">Application Insights 还可用于日志记录、分布式跟踪和自定义应用程序指标。</span><span class="sxs-lookup"><span data-stu-id="eb728-135">Application Insights can also be used for logging, distributed tracing, and custom application metrics.</span></span>
- <span data-ttu-id="eb728-136">[Azure Monitor][azure-monitor] 针对 Azure 中的大多数服务提供基本级别的基础结构[指标和日志][metrics]。</span><span class="sxs-lookup"><span data-stu-id="eb728-136">[Azure Monitor][azure-monitor] provides base-level infrastructure [metrics and logs][metrics] for most services in Azure.</span></span> <span data-ttu-id="eb728-137">可通过多种方式来与指标交互，包括在 Azure 门户中绘制指标图表、通过 REST API 访问指标，或者使用 PowerShell 或 CLI 查询指标。</span><span class="sxs-lookup"><span data-stu-id="eb728-137">You can interact with the metrics in several ways, including charting them in Azure portal, accessing them through the REST API, or querying them using PowerShell or CLI.</span></span> <span data-ttu-id="eb728-138">Azure Monitor 还直接在 [Log Analytics 和其他服务]中提供其数据，在这些服务中，可以查询 Azure Monitor 的数据，以及将这些数据与来自其他本地源或云中源的数据合并。</span><span class="sxs-lookup"><span data-stu-id="eb728-138">Azure Monitor also offers its data directly into [Log Analytics and other services], where you can query and combine it with data from other sources on premises or in the cloud.</span></span>
- <span data-ttu-id="eb728-139">[Log Analytics][log-analytics] 可以帮助将 Application Insights 收集的使用情况和性能数据与支持应用的 Azure 资源的配置和性能数据相关联。</span><span class="sxs-lookup"><span data-stu-id="eb728-139">[Log Analytics][log-analytics] helps correlate the usage and performance data collected by Application Insights with configuration and performance data across the Azure resources that support the app.</span></span> <span data-ttu-id="eb728-140">本方案使用 [Azure Log Analytics 代理][Azure Log Analytics agent]将 SQL Server 审核日志推送到 Log Analytics 中。</span><span class="sxs-lookup"><span data-stu-id="eb728-140">This scenario uses the [Azure Log Analytics agent][Azure Log Analytics agent] to push SQL Server audit logs into Log Analytics.</span></span> <span data-ttu-id="eb728-141">可在 Azure 门户的“Log Analytics”边栏选项卡中编写查询和查看数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-141">You can write queries and view data in the Log Analytics blade of the Azure portal.</span></span>

## <a name="considerations"></a><span data-ttu-id="eb728-142">注意事项</span><span class="sxs-lookup"><span data-stu-id="eb728-142">Considerations</span></span>

<span data-ttu-id="eb728-143">建议的做法是在开发期间使用 [Application Insights SDK][Application Insights SDKs] 将 Application Insights 添加到代码，然后根据应用程序进行自定义。</span><span class="sxs-lookup"><span data-stu-id="eb728-143">A recommended practice is adding Application Insights to your code during development using the [Application Insights SDKs][Application Insights SDKs], and customizing per application.</span></span> <span data-ttu-id="eb728-144">这些开源 SDK 适用于大多数应用程序框架。</span><span class="sxs-lookup"><span data-stu-id="eb728-144">These open-source SDKs are available for most application frameworks.</span></span> <span data-ttu-id="eb728-145">若要扩充和控制所收集的数据，可将用于测试和生产部署的 SDK 整合到开发过程中。</span><span class="sxs-lookup"><span data-stu-id="eb728-145">To enrich and control the data you collect, incorporate the use of the SDKs both for testing and production deployments into your development process.</span></span> <span data-ttu-id="eb728-146">应用要满足的主要要求是，通过面向 Internet 的地址直接或间接连接到托管的 Application Insights 引入终结点。</span><span class="sxs-lookup"><span data-stu-id="eb728-146">The main requirement is for the app to have a direct or indirect line of sight to the Applications Insights ingestion endpoint hosted with an Internet-facing address.</span></span> <span data-ttu-id="eb728-147">然后，可以添加遥测数据或扩充现有的遥测数据收集。</span><span class="sxs-lookup"><span data-stu-id="eb728-147">You can then add telemetry or enrich an existing telemetry collection.</span></span>

<span data-ttu-id="eb728-148">运行时监视是另一种简便的入门方法。</span><span class="sxs-lookup"><span data-stu-id="eb728-148">Runtime monitoring is another easy way to get started.</span></span> <span data-ttu-id="eb728-149">必须通过配置文件控制收集的遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-149">The telemetry that is collected must be controlled through configuration files.</span></span> <span data-ttu-id="eb728-150">例如，可以包含运行时方法，以便通过 [Application Insights 状态监视器][Application Insights Status Monitor]等工具将 SDK 部署到正确的文件夹，并添加适当的配置开始进行监视。</span><span class="sxs-lookup"><span data-stu-id="eb728-150">For example, you can include runtime methods that enable tools such as [Application Insights Status Monitor][Application Insights Status Monitor] to deploy the SDKs into the correct folder and add the right configurations to begin monitoring.</span></span>

<span data-ttu-id="eb728-151">与 Application Insights 一样，Log Analytics 提供相应的工具用于[分析不同源中的数据][analyzing data across sources]、创建复杂查询，以及根据指定的条件[发送主动警报][sending proactive alerts]。</span><span class="sxs-lookup"><span data-stu-id="eb728-151">Like Application Insights, Log Analytics provides tools for [analyzing data across sources][analyzing data across sources], creating complex queries, and [sending proactive alerts][sending proactive alerts] on specified conditions.</span></span> <span data-ttu-id="eb728-152">还可以在 [Azure 门户][the Azure portal]中查看遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-152">You can also view telemetry in [the Azure portal][the Azure portal].</span></span> <span data-ttu-id="eb728-153">Log Analytics 增大了 [Azure Monitor][azure-monitor] 等现有监视服务的价值，同时还能监视本地环境。</span><span class="sxs-lookup"><span data-stu-id="eb728-153">Log Analytics adds value to existing monitoring services such as [Azure Monitor][azure-monitor] and can also monitor on-premises environments.</span></span>

<span data-ttu-id="eb728-154">Application Insights 和 Log Analytics 都使用 [Azure Log Analytics 查询语言][Azure Log Analytics Query Language]。</span><span class="sxs-lookup"><span data-stu-id="eb728-154">Both Application Insights and Log Analytics use [Azure Log Analytics Query Language][Azure Log Analytics Query Language].</span></span> <span data-ttu-id="eb728-155">你也可以使用[跨资源查询](https://azure.microsoft.com/blog/query-across-resources)在单个查询中分析 Application Insights 和 Log Analytics 收集的遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-155">You can also use [cross-resource queries](https://azure.microsoft.com/blog/query-across-resources) to analyze the telemetry gathered by Application Insights and Log Analytics in a single query.</span></span>

<span data-ttu-id="eb728-156">Azure Monitor、Application Insights 和 Log Analytics 都会发送[警报](/azure/monitoring-and-diagnostics/monitoring-overview-alerts)。</span><span class="sxs-lookup"><span data-stu-id="eb728-156">Azure Monitor, Application Insights, and Log Analytics all send [alerts](/azure/monitoring-and-diagnostics/monitoring-overview-alerts).</span></span> <span data-ttu-id="eb728-157">例如，Azure Monitor 针对 CPU 利用率等平台级指标发出警报，而 Application Insights 则针对服务器响应时间等应用程序级指标发出警报。</span><span class="sxs-lookup"><span data-stu-id="eb728-157">For example, Azure Monitor alerts on platform-level metrics such as CPU utilization, while Application Insights alerts on application-level metrics such as server response time.</span></span> <span data-ttu-id="eb728-158">Azure Monitor 针对 Azure 活动日志中的新事件发出警报，而 Log Analytics 则可以针对配置为使用指标或事件数据的服务发出相关警报。</span><span class="sxs-lookup"><span data-stu-id="eb728-158">Azure Monitor alerts on new events in the Azure Activity Log, while Log Analytics can issue alerts about metrics or event data for the services configured to use it.</span></span> <span data-ttu-id="eb728-159">[Azure Monitor 中的统一警报](/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts)是 Azure 中使用不同分类的新统一警报体验。</span><span class="sxs-lookup"><span data-stu-id="eb728-159">[Unified alerts in Azure Monitor](/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts) is a new, unified alerting experience in Azure that uses a different taxonomy.</span></span>

### <a name="alternatives"></a><span data-ttu-id="eb728-160">备选项</span><span class="sxs-lookup"><span data-stu-id="eb728-160">Alternatives</span></span>

<span data-ttu-id="eb728-161">本文介绍可方便使用的监视选项和热门功能，但你也可以使用其他许多选项，包括用于创建自己的日志记录机制的选项。</span><span class="sxs-lookup"><span data-stu-id="eb728-161">This article describes conveniently available monitoring options with popular features, but you have many choices, including the option to create your own logging mechanisms.</span></span> <span data-ttu-id="eb728-162">建议的做法是在解决方案中构建层时添加监视服务。</span><span class="sxs-lookup"><span data-stu-id="eb728-162">A recommended practice is to add monitoring services as you build out tiers in a solution.</span></span> <span data-ttu-id="eb728-163">下面是一些可能的扩展和替代方法：</span><span class="sxs-lookup"><span data-stu-id="eb728-163">Here are some possible extensions and alternatives:</span></span>

- <span data-ttu-id="eb728-164">使用 [Azure Monitor Data Source For Grafana][Azure Monitor Data Source For Grafana] 在 Grafana 中整合 Azure Monitor 和 Application Insights 指标。</span><span class="sxs-lookup"><span data-stu-id="eb728-164">Consolidate Azure Monitor and Application Insights metrics in Grafana using the [Azure Monitor Data Source For Grafana][Azure Monitor Data Source For Grafana].</span></span>
- <span data-ttu-id="eb728-165">[Data Dog][data-dog] 为 Azure Monitor 提供连接器</span><span class="sxs-lookup"><span data-stu-id="eb728-165">[Data Dog][data-dog] features a connector for Azure Monitor</span></span>
- <span data-ttu-id="eb728-166">使用 [Azure 自动化][Azure Automation]将监视功能自动化。</span><span class="sxs-lookup"><span data-stu-id="eb728-166">Automate monitoring functions using [Azure Automation][Azure Automation].</span></span>
- <span data-ttu-id="eb728-167">使用 [ITSM 解决方案][ITSM solutions]添加通信功能。</span><span class="sxs-lookup"><span data-stu-id="eb728-167">Add communication with [ITSM solutions][ITSM solutions].</span></span>
- <span data-ttu-id="eb728-168">使用[管理解决方案][management solution]扩展 Log Analytics。</span><span class="sxs-lookup"><span data-stu-id="eb728-168">Extend Log Analytics with a [management solution][management solution].</span></span>

### <a name="scalability-and-availability"></a><span data-ttu-id="eb728-169">可伸缩性和可用性</span><span class="sxs-lookup"><span data-stu-id="eb728-169">Scalability and availability</span></span>

<span data-ttu-id="eb728-170">此方案侧重于主要用于监视的 PaaS 解决方案，因为这些解决方案可以方便地处理可用性和可伸缩性，并有服务级别协议 (SLA) 的保障。</span><span class="sxs-lookup"><span data-stu-id="eb728-170">This scenario focuses on PaaS solutions for monitoring in large part because they conveniently handle availability and scalability for you and are backed by service-level agreements (SLAs).</span></span> <span data-ttu-id="eb728-171">例如，应用服务为其可用性提供有保障的 [SLA][SLA]。</span><span class="sxs-lookup"><span data-stu-id="eb728-171">For example, App Services provides a guaranteed [SLA][SLA] for its availability.</span></span>

<span data-ttu-id="eb728-172">Application Insights 会[限制][app-insights-limits]每秒可以处理的请求数。</span><span class="sxs-lookup"><span data-stu-id="eb728-172">Application Insights has [limits][app-insights-limits] on how many requests can be processed per second.</span></span> <span data-ttu-id="eb728-173">如果超过请求数限制，消息可能会受到限制。</span><span class="sxs-lookup"><span data-stu-id="eb728-173">If you exceed the request limit, you may experience message throttling.</span></span> <span data-ttu-id="eb728-174">为防止发生限制，可以实施[筛选][message-filtering]或[采样][message-sampling]来降低数据速率</span><span class="sxs-lookup"><span data-stu-id="eb728-174">To prevent throttling, implement [filtering][message-filtering] or [sampling][message-sampling] to reduce the data rate</span></span>

<span data-ttu-id="eb728-175">但是，所运行的应用程序的高可用性考虑因素由开发人员负责。</span><span class="sxs-lookup"><span data-stu-id="eb728-175">High availability considerations for the app you run, however, are the developer's responsibility.</span></span> <span data-ttu-id="eb728-176">有关规模等方面的信息，请参阅基本 Web 应用程序参考体系结构中的[可伸缩性注意事项](./basic-web-app.md#scalability-considerations)部分。</span><span class="sxs-lookup"><span data-stu-id="eb728-176">For information about scale, for example, see the [Scalability considerations](./basic-web-app.md#scalability-considerations) section in the basic web application reference architecture.</span></span> <span data-ttu-id="eb728-177">部署应用后，可以设置测试，以使用 Application Insights [监视其可用性][monitor its availability]。</span><span class="sxs-lookup"><span data-stu-id="eb728-177">After an app is deployed, you can set up tests to [monitor its availability][monitor its availability] using Application Insights.</span></span>

### <a name="security"></a><span data-ttu-id="eb728-178">安全</span><span class="sxs-lookup"><span data-stu-id="eb728-178">Security</span></span>

<span data-ttu-id="eb728-179">敏感信息与合规要求会影响数据的收集、保留和存储。</span><span class="sxs-lookup"><span data-stu-id="eb728-179">Sensitive information and compliance requirements affect data collection, retention, and storage.</span></span> <span data-ttu-id="eb728-180">详细了解 [Application Insights][application-insights] 和 [Log Analytics][log-analytics] 如何处理遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-180">Learn more about how [Application Insights][application-insights] and [Log Analytics][log-analytics] handle telemetry.</span></span>

<span data-ttu-id="eb728-181">此外，可能需要注意以下安全事项：</span><span class="sxs-lookup"><span data-stu-id="eb728-181">The following security considerations may also apply:</span></span>

- <span data-ttu-id="eb728-182">制定一个计划，以便在开发人员有权收集其自己的数据或扩充现有遥测数据时处理个人信息。</span><span class="sxs-lookup"><span data-stu-id="eb728-182">Develop a plan to handle personal information if developers are allowed to collect their own data or enrich existing telemetry.</span></span>
- <span data-ttu-id="eb728-183">考虑数据保留期。</span><span class="sxs-lookup"><span data-stu-id="eb728-183">Consider data retention.</span></span> <span data-ttu-id="eb728-184">例如，Application Insights 会将遥测数据保留 90 天。</span><span class="sxs-lookup"><span data-stu-id="eb728-184">For example, Application Insights retains telemetry data for 90 days.</span></span> <span data-ttu-id="eb728-185">使用 Microsoft Power BI、连续导出或 REST API 来存档需要长期访问的数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-185">Archive data you want access to for longer periods using Microsoft Power BI, Continuous Export, or the REST API.</span></span> <span data-ttu-id="eb728-186">可能会产生存储费。</span><span class="sxs-lookup"><span data-stu-id="eb728-186">Storage rates apply.</span></span>
- <span data-ttu-id="eb728-187">限制对 Azure 资源的访问，以控制数据访问以及谁可以从特定的应用程序查看遥测数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-187">Limit access to Azure resources to control access to data and who can view telemetry from a specific application.</span></span> <span data-ttu-id="eb728-188">若要帮助锁定对监视遥测数据的访问，请参阅 [Application Insights 中的资源、角色和访问控制][Resources, roles, and access control in Application Insights]。</span><span class="sxs-lookup"><span data-stu-id="eb728-188">To help lock down access to monitoring telemetry, see [Resources, roles, and access control in Application Insights][Resources, roles, and access control in Application Insights].</span></span>
- <span data-ttu-id="eb728-189">考虑是否要在应用程序代码中控制读/写访问，以防止用户添加会限制从应用程序引入数据的版本或标签标记。</span><span class="sxs-lookup"><span data-stu-id="eb728-189">Consider whether to control read/write access in application code to prevent users from adding version or tag markers that limit data ingestion from the application.</span></span> <span data-ttu-id="eb728-190">使用 Application Insights 时，将各个数据项发送到资源后，便无法对这些项进行控制，因此，如果用户有权访问任何数据，则他们就有权访问单个资源中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="eb728-190">With Application Insights, there is no control over individual data items once they are sent to a resource, so if a user has access to any data, they have access to all data in an individual resource.</span></span>
- <span data-ttu-id="eb728-191">根据需要添加[监管](/azure/security/governance-in-azure)机制，以便对 Azure 资源强制实施策略或成本控制。</span><span class="sxs-lookup"><span data-stu-id="eb728-191">Add [governance](/azure/security/governance-in-azure) mechanisms to enforce policy or cost controls over Azure resources if needed.</span></span> <span data-ttu-id="eb728-192">例如，使用 Log Analytics 进行策略和基于角色的访问控制等方面的安全相关监视，或使用 [Azure Policy](/azure/azure-policy/azure-policy-introduction) 来创建、分配和管理策略定义。</span><span class="sxs-lookup"><span data-stu-id="eb728-192">For example, use Log Analytics for security-related monitoring such as policies and role-based access control, or use [Azure Policy](/azure/azure-policy/azure-policy-introduction) to create, assign and, manage policy definitions.</span></span>
- <span data-ttu-id="eb728-193">若要监视潜在安全问题并获取 Azure 资源安全状态的中心视图，请考虑使用 [Azure 安全中心](/azure/security-center/security-center-intro)。</span><span class="sxs-lookup"><span data-stu-id="eb728-193">To monitor potential security issues and get a central view of the security state of your Azure resources, consider using [Azure Security Center](/azure/security-center/security-center-intro).</span></span>

## <a name="pricing"></a><span data-ttu-id="eb728-194">定价</span><span class="sxs-lookup"><span data-stu-id="eb728-194">Pricing</span></span>

<span data-ttu-id="eb728-195">监视费用可能会迅速增加，因此，请考虑提前定价，了解监视的内容，并查看每个服务的相关费用。</span><span class="sxs-lookup"><span data-stu-id="eb728-195">Monitoring charges can add up quickly, so consider pricing up front, understand what you are monitoring, and check the associated fees for each service.</span></span> <span data-ttu-id="eb728-196">Azure Monitor 免费提供[基本指标][basic metrics]，[Application Insights][application-insights-pricing] 和 [Log Analytics][log-analytics] 的监视费用基于引入的数据量和运行的测试数。</span><span class="sxs-lookup"><span data-stu-id="eb728-196">Azure Monitor provides [basic metrics][basic metrics] at no cost, while monitoring costs for [Application Insights][application-insights-pricing] and [Log Analytics][log-analytics] are based on the amount of data ingested and the number of tests you run.</span></span>

<span data-ttu-id="eb728-197">可以使用[定价计算器][pricing]估算成本，以帮助计算上手费用。</span><span class="sxs-lookup"><span data-stu-id="eb728-197">To help you get started, use the [pricing calculator][pricing] to estimate costs.</span></span> <span data-ttu-id="eb728-198">若要了解特定用例的定价变化，请按预期部署更改不同的选项。</span><span class="sxs-lookup"><span data-stu-id="eb728-198">To see how the pricing would change for your particular use case, change the various options to match your expected deployment.</span></span>

<span data-ttu-id="eb728-199">在调试期间以及发布应用后，Application Insights 的遥测数据将发送到 Azure 门户。</span><span class="sxs-lookup"><span data-stu-id="eb728-199">Telemetry from Application Insights is sent to the Azure portal during debugging and after you have published your app.</span></span> <span data-ttu-id="eb728-200">若要进行测试并避免产生费用，可以检测有限的遥测数据量。</span><span class="sxs-lookup"><span data-stu-id="eb728-200">For testing purposes and to avoid charges, a limited volume of telemetry is instrumented.</span></span> <span data-ttu-id="eb728-201">若要添加更多指标，可以引发遥测限制。</span><span class="sxs-lookup"><span data-stu-id="eb728-201">To add more indicators, you can raise the telemetry limit.</span></span> <span data-ttu-id="eb728-202">若要提高控制粒度，请参阅 [Application Insights 中的采样][Sampling in Application Insights]。</span><span class="sxs-lookup"><span data-stu-id="eb728-202">For more granular control, see [Sampling in Application Insights][Sampling in Application Insights].</span></span>

<span data-ttu-id="eb728-203">部署后，可以观察性能指标的[实时指标流][Live Metrics Stream]。</span><span class="sxs-lookup"><span data-stu-id="eb728-203">After deployment, you can watch a [Live Metrics Stream][Live Metrics Stream] of performance indicators.</span></span> <span data-ttu-id="eb728-204">不会存储此数据 &mdash; 实时指标仅供查看 &mdash; 但可以收集遥测数据，并在以后进行分析。</span><span class="sxs-lookup"><span data-stu-id="eb728-204">This data is not stored &mdash; you are viewing real-time metrics &mdash; but the telemetry can be collected and analyzed later.</span></span> <span data-ttu-id="eb728-205">实时流数据不会产生费用。</span><span class="sxs-lookup"><span data-stu-id="eb728-205">There is no charge for Live Stream data.</span></span>

<span data-ttu-id="eb728-206">Log Analytics 根据引入到服务中的数据的 GB 单位数量计费。</span><span class="sxs-lookup"><span data-stu-id="eb728-206">Log Analytics is billed per gigabyte (GB) of data ingested into the service.</span></span> <span data-ttu-id="eb728-207">每个月引入到 Azure Log Analytics 服务中的前 5 GB 数据是免费的，最初的 31 天，这些数据将在 Log Analytics 工作区中免费保留。</span><span class="sxs-lookup"><span data-stu-id="eb728-207">The first 5 GB of data ingested to the Azure Log Analytics service every month is offered free, and the data is retained at no charge for first 31 days in your Log Analytics workspace.</span></span>

## <a name="next-steps"></a><span data-ttu-id="eb728-208">后续步骤</span><span class="sxs-lookup"><span data-stu-id="eb728-208">Next steps</span></span>

<span data-ttu-id="eb728-209">请查看以下可以帮助你开始使用自己的监视解决方案的资源：</span><span class="sxs-lookup"><span data-stu-id="eb728-209">Check out these resources designed to help you get started with your own monitoring solution:</span></span>

<span data-ttu-id="eb728-210">[基本 Web 应用程序参考体系结构][Basic web application reference architecture]</span><span class="sxs-lookup"><span data-stu-id="eb728-210">[Basic web application reference architecture][Basic web application reference architecture]</span></span>

<span data-ttu-id="eb728-211">[开始监视 ASP.NET Web 应用程序][Start monitoring your ASP.NET Web Application]</span><span class="sxs-lookup"><span data-stu-id="eb728-211">[Start monitoring your ASP.NET Web Application][Start monitoring your ASP.NET Web Application]</span></span>

<span data-ttu-id="eb728-212">[收集有关 Azure 虚拟机的数据][Collect data about Azure Virtual Machines]</span><span class="sxs-lookup"><span data-stu-id="eb728-212">[Collect data about Azure Virtual Machines][Collect data about Azure Virtual Machines]</span></span>

## <a name="related-resources"></a><span data-ttu-id="eb728-213">相关资源</span><span class="sxs-lookup"><span data-stu-id="eb728-213">Related resources</span></span>

<span data-ttu-id="eb728-214">[监视 Azure 应用程序和资源][Monitoring Azure applications and resources]</span><span class="sxs-lookup"><span data-stu-id="eb728-214">[Monitoring Azure applications and resources][Monitoring Azure applications and resources]</span></span>

<span data-ttu-id="eb728-215">[使用 Azure Application Insights 查找并诊断运行时异常][Find and diagnose run-time exceptions with Azure Application Insights]</span><span class="sxs-lookup"><span data-stu-id="eb728-215">[Find and diagnose run-time exceptions with Azure Application Insights][Find and diagnose run-time exceptions with Azure Application Insights]</span></span>

<!-- links -->
[architecture]: ./images/architecture-diagram-app-monitoring.svg
[availability-tests]: /azure/application-insights/app-insights-monitor-web-app-availability
[application-insights]: /azure/application-insights/app-insights-overview
[azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview-azure-monitor
[metrics]: /azure/monitoring-and-diagnostics/monitoring-supported-metrics
[Log Analytics 和其他服务]: /azure/log-analytics/log-analytics-azure-storage
[Log Analytics and other services]: /azure/log-analytics/log-analytics-azure-storage
[log-analytics]: /azure/log-analytics/log-analytics-overview
[Azure Log Analytics agent]: https://blogs.msdn.microsoft.com/sqlsecurity/2017/12/28/azure-log-analytics-oms-agent-now-collects-sql-server-audit-logs/
[application-insights-pricing]: https://azure.microsoft.com/pricing/details/application-insights/
[Application Insights SDKs]: /azure/application-insights/app-insights-asp-net
[Application Insights Status Monitor]: https://azure.microsoft.com/updates/application-insights-status-monitor-and-sdk-updated/
[analyzing data across sources]: /azure/log-analytics/log-analytics-dashboards
[sending proactive alerts]: /azure/log-analytics/log-analytics-alerts
[the Azure portal]: /azure/log-analytics/log-analytics-tutorial-dashboards
[Azure Log Analytics Query Language]: https://docs.loganalytics.io/docs/Learn
[cross-resource queries]: https://azure.microsoft.com/blog/query-across-resources/
[alerts]: /azure/monitoring-and-diagnostics/monitoring-overview-alerts
[Alerts (Preview)]: /azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts
[Azure Monitor Data Source For Grafana]: https://grafana.com/plugins/grafana-azure-monitor-datasource
[Azure Automation]: /azure/automation/automation-intro
[ITSM solutions]: https://azure.microsoft.com/blog/itsm-connector-for-azure-is-now-generally-available/
[management solution]: /azure/monitoring/monitoring-solutions
[SLA]: https://azure.microsoft.com/support/legal/sla/app-service/v1_4/
[monitor its availability]: /azure/application-insights/app-insights-monitor-web-app-availability
[Resources, roles, and access control in Application Insights]: /azure/application-insights/app-insights-resources-roles-access-control
[basic metrics]: /azure/monitoring-and-diagnostics/monitoring-supported-metrics
[pricing]: https://azure.microsoft.com/pricing/calculator/#log-analyticsc126d8c1-ec9c-4e5b-9b51-4db95d06a9b1
[Sampling in Application Insights]: /azure/application-insights/app-insights-sampling
[Live Metrics Stream]: /azure/application-insights/app-insights-live-stream
[Basic web application reference architecture]: /azure/architecture/reference-architectures/app-service-web-app/basic-web-app#scalability-considerations
[Start monitoring your ASP.NET Web Application]: /azure/application-insights/quick-monitor-portal
[Collect data about Azure Virtual Machines]: /azure/log-analytics/log-analytics-quick-collect-azurevm
[Monitoring Azure applications and resources]: /azure/monitoring-and-diagnostics/monitoring-overview
[Find and diagnose run-time exceptions with Azure Application Insights]: /azure/application-insights/app-insights-tutorial-runtime-exceptions
[data-dog]: https://www.datadoghq.com/blog/azure-monitoring-enhancements/
[app-insights-limits]: /azure/azure-subscription-service-limits#application-insights-limits
[message-filtering]: /azure/application-insights/app-insights-api-filtering-sampling
[message-sampling]: /azure/application-insights/app-insights-sampling
