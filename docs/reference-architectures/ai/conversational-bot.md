---
title: 生成企业级聊天机器人
description: 如何使用 Azure Bot Framework 生成企业级聊天机器人 (chatbot)。
author: roalexan
ms.date: 01/24/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: f622041824d65978346bf39abb3de30732bad193
ms.sourcegitcommit: 3b15d65e7c35a19506e562c444343f8467b6a073
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/25/2019
ms.locfileid: "54908625"
---
# <a name="enterprise-grade-conversational-bot"></a><span data-ttu-id="9d5d8-103">企业级聊天机器人</span><span class="sxs-lookup"><span data-stu-id="9d5d8-103">Enterprise-grade conversational bot</span></span>

<span data-ttu-id="9d5d8-104">本参考体系结构介绍如何使用 [Azure Bot Framework][bot-framework] 生成企业级聊天机器人 (chatbot)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-104">This reference architecture describes how to build an enterprise-grade conversational bot (chatbot) using the [Azure Bot Framework][bot-framework].</span></span> <span data-ttu-id="9d5d8-105">机器人各不相同，但需要注意一些常见的模式、工作流和技术。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-105">Each bot is different, but there are some common patterns, workflows, and technologies to be aware of.</span></span> <span data-ttu-id="9d5d8-106">尤其是为企业工作负荷提供服务的机器人，除了核心功能以外，还需要考虑到许多的设计因素。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-106">Especially for a bot to serve enterprise workloads, there are many design considerations beyond just the core functionality.</span></span> <span data-ttu-id="9d5d8-107">本文将介绍最基本的设计方面，以及生成可靠、安全且可主动学习的机器人所需的工具。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-107">This article covers the most essential design aspects, and introduces the tools needed to build a robust, secure, and actively learning bot.</span></span>

<span data-ttu-id="9d5d8-108">[![体系结构示意图][0]][0]</span><span class="sxs-lookup"><span data-stu-id="9d5d8-108">[![Diagram of the architecture][0]][0]</span></span>

## <a name="architecture"></a><span data-ttu-id="9d5d8-109">体系结构</span><span class="sxs-lookup"><span data-stu-id="9d5d8-109">Architecture</span></span>

<span data-ttu-id="9d5d8-110">此处所示的体系结构使用以下 Azure 服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-110">The architecture shown here uses the following Azure services.</span></span> <span data-ttu-id="9d5d8-111">你自己的机器人不一定要使用所有这些服务，有时可以整合其他服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-111">Your own bot may not use all of these services, or may incorporate additional services.</span></span>

### <a name="bot-logic-and-user-experience"></a><span data-ttu-id="9d5d8-112">机器人逻辑和用户体验</span><span class="sxs-lookup"><span data-stu-id="9d5d8-112">Bot logic and user experience</span></span>

- <span data-ttu-id="9d5d8-113">**[Bot Framework Service][bot-framework-service]** (BFS)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-113">**[Bot Framework Service][bot-framework-service]** (BFS).</span></span> <span data-ttu-id="9d5d8-114">此服务将机器人连接到 Cortana、Facebook Messenger 或 Slack 等通信应用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-114">This service connects your bot to a communication app such as Cortana, Facebook Messenger, or Slack.</span></span> <span data-ttu-id="9d5d8-115">它可以简化机器人与用户之间的通信。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-115">It facilitates communication between your bot and the user.</span></span>
- <span data-ttu-id="9d5d8-116">**[Azure 应用服务][app-service]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-116">**[Azure App Service][app-service]**.</span></span> <span data-ttu-id="9d5d8-117">机器人应用程序逻辑托管在 Azure 应用服务中。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-117">The bot application logic is hosted in Azure App Service.</span></span>

### <a name="bot-cognition-and-intelligence"></a><span data-ttu-id="9d5d8-118">机器人认知和智能</span><span class="sxs-lookup"><span data-stu-id="9d5d8-118">Bot cognition and intelligence</span></span>

- <span data-ttu-id="9d5d8-119">**[语言理解][luis]** (LUIS)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-119">**[Language Understanding][luis]** (LUIS).</span></span> <span data-ttu-id="9d5d8-120">LUIS 属于 [Azure 认知服务][cognitive-services]，可让机器人通过识别用户意向和实体来理解自然语言。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-120">Part of [Azure Cognitive Services][cognitive-services], LUIS enables your bot to understand natural language by identifying user intents and entities.</span></span>
- <span data-ttu-id="9d5d8-121">**[Azure 搜索][search]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-121">**[Azure Search][search]**.</span></span> <span data-ttu-id="9d5d8-122">搜索是提供可快速搜索的文档索引的托管服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-122">Search is a managed service that provides a quick searchable document index.</span></span>
- <span data-ttu-id="9d5d8-123">**[QnA Maker][qna-maker]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-123">**[QnA Maker][qna-maker]**.</span></span> <span data-ttu-id="9d5d8-124">QnA Maker 是一种基于云的 API 服务，它创建基于数据的聊天式问答层。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-124">QnA Maker is a cloud-based API service that creates a conversational, question-and-answer layer over your data.</span></span> <span data-ttu-id="9d5d8-125">通常，QnA Maker 连同 FAQ 等半结构化内容一起加载。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-125">Typically, it's loaded with semi-structured content such as FAQs.</span></span> <span data-ttu-id="9d5d8-126">使用 QnA Maker 可以创建知识库来解答自然语言问题。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-126">Use it to create a knowledge base for answering natural-language questions.</span></span>
- <span data-ttu-id="9d5d8-127">**[Web 应用][webapp]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-127">**[Web app][webapp]**.</span></span> <span data-ttu-id="9d5d8-128">如果现有的服务不能提供机器人所需的 AI 解决方案，你可以实现自己的自定义 AI 并将其托管为 Web 应用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-128">If your bot needs AI solutions not provided by an existing service, you can implement your own custom AI and host it as a web app.</span></span> <span data-ttu-id="9d5d8-129">这样，就可以提供一个 Web 终结点供机器人调用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-129">This provides a web endpoint for your bot to call.</span></span>

### <a name="data-ingestion"></a><span data-ttu-id="9d5d8-130">数据引入</span><span class="sxs-lookup"><span data-stu-id="9d5d8-130">Data ingestion</span></span>

<span data-ttu-id="9d5d8-131">机器人依赖于必须引入并准备好的原始数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-131">The bot will rely on raw data that must be ingested and prepared.</span></span> <span data-ttu-id="9d5d8-132">请考虑使用以下任一选项来协调此过程：</span><span class="sxs-lookup"><span data-stu-id="9d5d8-132">Consider any of the following options to orchestrate this process:</span></span>

- <span data-ttu-id="9d5d8-133">**[Azure 数据工厂][data-factory]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-133">**[Azure Data Factory][data-factory]**.</span></span> <span data-ttu-id="9d5d8-134">数据工厂可以协调和自动化数据的移动与转换。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-134">Data Factory orchestrates and automates data movement and data transformation.</span></span>
- <span data-ttu-id="9d5d8-135">**[逻辑应用][logic-apps]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-135">**[Logic Apps][logic-apps]**.</span></span> <span data-ttu-id="9d5d8-136">逻辑应用是一个无服务器平台，用于生成可以集成应用程序、数据和服务的工作流。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-136">Logic Apps is a serverless platform for building workflows that integrate applications, data, and services.</span></span> <span data-ttu-id="9d5d8-137">逻辑应用为许多应用程序（包括 Office 365）提供数据连接器。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-137">Logic Apps provides data connectors for many applications, including Office 365.</span></span>
- <span data-ttu-id="9d5d8-138">**[Azure Functions][functions]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-138">**[Azure Functions][functions]**.</span></span> <span data-ttu-id="9d5d8-139">使用 Azure Functions 可以编写自定义的无服务器代码供[触发器][functions-triggers]调用 &mdash; 例如，每次将文档添加到 Blob 存储或 Cosmos DB 时。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-139">You can use Azure Functions to write custom serverless code that is invoked by a [trigger][functions-triggers] &mdash; for example, whenever a document is added to blob storage or Cosmos DB.</span></span>

### <a name="logging-and-monitoring"></a><span data-ttu-id="9d5d8-140">日志记录和监视</span><span class="sxs-lookup"><span data-stu-id="9d5d8-140">Logging and monitoring</span></span>

- <span data-ttu-id="9d5d8-141">**[Application Insights][app-insights]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-141">**[Application Insights][app-insights]**.</span></span> <span data-ttu-id="9d5d8-142">使用 Application Insights 可以记录机器人的应用程序指标用于监视、诊断和分析目的。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-142">Use Application Insights to log the bot's application metrics for monitoring, diagnostic, and analytical purposes.</span></span>
- <span data-ttu-id="9d5d8-143">**[Azure Blob 存储][blob]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-143">**[Azure Blob Storage][blob]**.</span></span> <span data-ttu-id="9d5d8-144">Blob 存储最适合存储巨量的非结构化数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-144">Blob storage is optimized for storing massive amounts of unstructured data.</span></span>
- <span data-ttu-id="9d5d8-145">**[Cosmos DB][cosmosdb]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-145">**[Cosmos DB][cosmosdb]**.</span></span> <span data-ttu-id="9d5d8-146">Cosmos DB 非常适合用于存储聊天等半结构化日志数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-146">Cosmos DB is well-suited for storing semi-structured log data such as conversations.</span></span>
- <span data-ttu-id="9d5d8-147">**[Power BI][power-bi]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-147">**[Power BI][power-bi]**.</span></span> <span data-ttu-id="9d5d8-148">使用 Power BI 可为机器人创建监视仪表板。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-148">Use Power BI to create monitoring dashboards for your bot.</span></span>

### <a name="security-and-governance"></a><span data-ttu-id="9d5d8-149">安全和调控</span><span class="sxs-lookup"><span data-stu-id="9d5d8-149">Security and governance</span></span>

- <span data-ttu-id="9d5d8-150">**[Azure Active Directory][aad]** (Azure AD)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-150">**[Azure Active Directory][aad]** (Azure AD).</span></span> <span data-ttu-id="9d5d8-151">用户通过 Azure AD 等标识提供者进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-151">Users will authenticate through an identity provider such as Azure AD.</span></span> <span data-ttu-id="9d5d8-152">机器人服务处理身份验证流和 OAuth 令牌管理。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-152">The Bot Service handles the authentication flow and OAuth token management.</span></span> <span data-ttu-id="9d5d8-153">请参阅[通过 Azure 机器人服务向机器人添加身份验证][bot-authentication]。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-153">See [Add authentication to your bot via Azure Bot Service][bot-authentication].</span></span>
- <span data-ttu-id="9d5d8-154">**[Azure Key Vault][key-vault]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-154">**[Azure Key Vault][key-vault]**.</span></span> <span data-ttu-id="9d5d8-155">使用 Key Vault 存储凭据和其他机密。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-155">Store credentials and other secrets using Key Vault.</span></span>

### <a name="quality-assurance-and-enhancements"></a><span data-ttu-id="9d5d8-156">质量保证和增强功能</span><span class="sxs-lookup"><span data-stu-id="9d5d8-156">Quality assurance and enhancements</span></span>

- <span data-ttu-id="9d5d8-157">**[Azure DevOps][devops]**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-157">**[Azure DevOps][devops]**.</span></span> <span data-ttu-id="9d5d8-158">为应用管理提供许多服务，包括源代码管理、生成、测试、部署和项目跟踪。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-158">Provides many services for app management, including source control, building, testing, deployment, and project tracking.</span></span>
- <span data-ttu-id="9d5d8-159">**[VS Code][vscode]** 用于开发应用的轻型代码编辑器。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-159">**[VS Code][vscode]** A lightweight code editor for app development.</span></span> <span data-ttu-id="9d5d8-160">也可以使用其他任何具有类似功能的 IDE。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-160">You can use any other IDE with similar features.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="9d5d8-161">设计注意事项</span><span class="sxs-lookup"><span data-stu-id="9d5d8-161">Design considerations</span></span>

<span data-ttu-id="9d5d8-162">从较高层面讲，可将聊天机器人划分为机器人功能（“大脑”）和一组周边要求（“主体”）。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-162">At a high level, a conversational bot can be divided into the bot functionality (the "brain") and a set of surrounding requirements (the "body").</span></span> <span data-ttu-id="9d5d8-163">大脑包括领域识别组件，其中包括机器人逻辑和机器学习功能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-163">The brain includes the domain-aware components, including the bot logic and ML capabilities.</span></span> <span data-ttu-id="9d5d8-164">其他组件不具备领域知识，用于解决 CI/CD、质量保证和安全等非功能性要求。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-164">Other components are domain agnostic and address non-functional requirements such as CI/CD, quality assurance, and security.</span></span>

![机器人功能的逻辑示意图](./_images/conversational-bot-logical.png)

<span data-ttu-id="9d5d8-166">在深入到本体系结构的细节之前，让我们先通过每个设计子组件了解数据流。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-166">Before getting into the specifics of this architecture, let's start with the data flow through each subcomponent of the design.</span></span> <span data-ttu-id="9d5d8-167">数据流包括用户发起的和系统发起的数据流。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-167">The data flow includes user-initiated and system-initiated data flows.</span></span>

### <a name="user-message-flow"></a><span data-ttu-id="9d5d8-168">用户消息流</span><span class="sxs-lookup"><span data-stu-id="9d5d8-168">User message flow</span></span>

<span data-ttu-id="9d5d8-169">“身份验证”。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-169">**Authentication**.</span></span> <span data-ttu-id="9d5d8-170">用户首先使用机器人信道所提供的任何机制验证自己的身份。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-170">Users start by authenticating themselves using whatever mechanism is provided by their channel of communication with the bot.</span></span> <span data-ttu-id="9d5d8-171">机器人框架支持许多信道，包括 Cortana、Microsoft Teams、Facebook Messenger、Kik 和 Slack。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-171">The bot framework supports many communication channels, including Cortana, Microsoft Teams, Facebook Messenger, Kik, and Slack.</span></span> <span data-ttu-id="9d5d8-172">有关通道列表，请参阅[将机器人连接到通道](/azure/bot-service/bot-service-manage-channels)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-172">For a list of channels, see [Connect a bot to channels](/azure/bot-service/bot-service-manage-channels).</span></span> <span data-ttu-id="9d5d8-173">使用 Azure 机器人服务创建机器人时，会自动配置[网上聊天][webchat]通道。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-173">When you create a bot with Azure Bot Service, the [Web Chat][webchat] channel is automatically configured.</span></span> <span data-ttu-id="9d5d8-174">用户可以在网页中使用此通道直接与机器人交互。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-174">This channel allows users to interact with your bot directly in a web page.</span></span> <span data-ttu-id="9d5d8-175">也可以使用 [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) 通道将机器人连接到自定义应用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-175">You can also connect the bot to a custom app by using the [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) channel.</span></span> <span data-ttu-id="9d5d8-176">用户的标识用于提供基于角色的访问控制，以及提供个性化内容。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-176">The user's identity is used to provide role-based access control, as well as to serve personalized content.</span></span>

<span data-ttu-id="9d5d8-177">**用户消息**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-177">**User message**.</span></span> <span data-ttu-id="9d5d8-178">完成身份验证后，用户向机器人发送消息。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-178">Once authenticated, the user sends a message to the bot.</span></span> <span data-ttu-id="9d5d8-179">机器人读取该消息，并将其路由到 [LUIS](/azure/cognitive-services/luis/) 等自然语言理解服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-179">The bot reads the message and routes it to a natural language understanding service such as [LUIS](/azure/cognitive-services/luis/).</span></span> <span data-ttu-id="9d5d8-180">此步骤将获取**意向**（用户想要做什么）和**实体**（用户对哪些内容感兴趣）。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-180">This step gets the **intents** (what the user wants to do) and **entities** (what things the user is interested in).</span></span> <span data-ttu-id="9d5d8-181">然后，机器人生成一个查询，该查询将传递给可提供信息的服务，例如，用于检索文档的 [Azure 搜索][search]、用于获取常见问题解答的 [QnA Maker](https://www.qnamaker.ai/)，或自定义的知识库。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-181">The bot then builds a query that it passes to a service that serves information, such as [Azure Search][search] for document retrieval, [QnA Maker](https://www.qnamaker.ai/) for FAQs, or a custom knowledge base.</span></span> <span data-ttu-id="9d5d8-182">机器人使用这些结果来构造响应。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-182">The bot uses these results to construct a response.</span></span> <span data-ttu-id="9d5d8-183">若要为给定的查询提供最佳结果，机器人可能需要多次往返调用这些远程服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-183">To give the best result for a  given query, the bot might make several back-and-forth calls to these remote services.</span></span>

<span data-ttu-id="9d5d8-184">**响应**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-184">**Response**.</span></span> <span data-ttu-id="9d5d8-185">此时，机器人已确定最佳响应，可将其发送给用户。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-185">At this point, the bot has determined the best response and sends it to the user.</span></span> <span data-ttu-id="9d5d8-186">如果最佳匹配解答的置信度评分较低，则响应可能是一个消除了歧义的问题，或者是机器人无法充分回复的确认。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-186">If the confidence score of the best-matched answer is low, the response might be a disambiguation question or an acknowledgement that the bot could not reply adequately.</span></span>

<span data-ttu-id="9d5d8-187">**日志记录**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-187">**Logging**.</span></span> <span data-ttu-id="9d5d8-188">收到用户请求或者发送响应后，应该连同外部服务返回的性能指标和常规错误，将所有聊天操作记录到日志记录存储。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-188">When a user request is received or a response is sent, all conversation actions should be logged to a logging store, along with performance metrics and general errors from external services.</span></span> <span data-ttu-id="9d5d8-189">以后在诊断问题和改善系统时，这些日志将很有用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-189">These logs will be useful later when diagnosing issues and improving the system.</span></span>

<span data-ttu-id="9d5d8-190">**反馈**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-190">**Feedback**.</span></span> <span data-ttu-id="9d5d8-191">另一项良好的做法是收集用户反馈和满意度评分。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-191">Another good practice is to collect user feedback and satisfaction scores.</span></span> <span data-ttu-id="9d5d8-192">作为跟进机器人最终响应的一种手段，机器人应该要求用户对回复给出满意度评分。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-192">As a follow up to the bot's final response, the bot should ask the user to rate their satisfaction with the reply.</span></span> <span data-ttu-id="9d5d8-193">反馈有助于解决自然语言理解的冷启动问题，并可以持续改善响应的准确度。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-193">Feedback can help you to solve the cold start problem of natural language understanding, and continually improve the accuracy of responses.</span></span>

### <a name="system-data-flow"></a><span data-ttu-id="9d5d8-194">系统数据流</span><span class="sxs-lookup"><span data-stu-id="9d5d8-194">System Data Flow</span></span>

<span data-ttu-id="9d5d8-195">**ETL**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-195">**ETL**.</span></span> <span data-ttu-id="9d5d8-196">机器人依赖于后端 ETL 过程从原始数据中提取的信息和知识。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-196">The bot relies on information and knowledge extracted from the raw data by an ETL process in the backend.</span></span> <span data-ttu-id="9d5d8-197">此数据可能是结构化的（SQL 数据库）、半结构化的（CRM 系统、FAQ）或非结构化的（Word 文档、PDF、Web 日志）。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-197">This data might be structured (SQL database), semi-structured (CRM system, FAQs), or unstructured (Word documents, PDFs, web logs).</span></span> <span data-ttu-id="9d5d8-198">ETL 子系统按固定的计划提取数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-198">An ETL subsystem extracts the data on a fixed schedule.</span></span> <span data-ttu-id="9d5d8-199">内容将会经过转换和扩充，然后载入 Cosmos DB 或 Azure Blob 存储等中间数据存储。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-199">The content is transformed and enriched, then loaded into an intermediary data store, such as Cosmos DB or Azure Blob Storage.</span></span>

<span data-ttu-id="9d5d8-200">然后，中间存储中的数据将在 Azure 搜索中编制索引以方便检索文档，载入 QnA Maker 以创建问答对，或载入自定义 Web 应用进行非结构化文本处理。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-200">Data in the intermediary store is then indexed into Azure Search for document retrieval, loaded into QnA Maker to create question and answer pairs, or loaded into a custom web app for unstructured text processing.</span></span> <span data-ttu-id="9d5d8-201">这些数据还用于训练 LUIS 模型，以提取意向和实体。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-201">The data is also used to train a LUIS model for intent and entity extraction.</span></span>

<span data-ttu-id="9d5d8-202">**质量保证**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-202">**Quality assurance**.</span></span> <span data-ttu-id="9d5d8-203">聊天日志用于诊断和修复 bug、提供机器人用法见解，以及跟踪整体性能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-203">The conversation logs are used to diagnose and fix bugs, provide insight into how the bot is being used, and track overall performance.</span></span> <span data-ttu-id="9d5d8-204">反馈数据可用于重新训练 AI 模型，以提高机器人的性能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-204">Feedback data is useful for retraining the AI models to improve bot performance.</span></span>

## <a name="building-a-bot"></a><span data-ttu-id="9d5d8-205">生成机器人</span><span class="sxs-lookup"><span data-stu-id="9d5d8-205">Building a bot</span></span>

<span data-ttu-id="9d5d8-206">即使只是编写一行代码，在此之前，也必须编写功能规范，使开发团队清楚地知道机器人的预期用途是什么。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-206">Before you even write a single line of code, it's important to write a functional specification so the development team has a clear idea of what the bot is expected to do.</span></span> <span data-ttu-id="9d5d8-207">该规范应该包括一个相当全面的用户输入列表，以及预期机器人在多个知识领域方面提供的响应。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-207">The specification should include a reasonably comprehensive list of user inputs and expected bot responses in various knowledge domains.</span></span> <span data-ttu-id="9d5d8-208">此活动文档可为机器人的开发和测试提供宝贵的指导。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-208">This living document will be an invaluable guide for developing and testing your bot.</span></span>

### <a name="ingest-data"></a><span data-ttu-id="9d5d8-209">引入数据</span><span class="sxs-lookup"><span data-stu-id="9d5d8-209">Ingest data</span></span>

<span data-ttu-id="9d5d8-210">接下来确定数据源，使机器人能够以智能方式与用户交互。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-210">Next, identify the data sources that will enable the bot to interact intelligently with users.</span></span> <span data-ttu-id="9d5d8-211">如前所述，这些数据源可能包含结构化、半结构化或非结构化的数据集。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-211">As mentioned earlier, these data sources could contain structured, semi-structured, or unstructured data sets.</span></span> <span data-ttu-id="9d5d8-212">在开始时，良好的做法将数据一次性复制到 Cosmos DB 或 Azure 存储等中心存储。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-212">When you're getting started, a good approach is to make a one-off copy of the data to a central store, such as Cosmos DB or Azure Storage.</span></span> <span data-ttu-id="9d5d8-213">在开发过程中，应该创建一个自动化数据引入管道来保持此数据的最新状态。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-213">As you progress, you should create an automated data ingestion pipeline to keep this data current.</span></span> <span data-ttu-id="9d5d8-214">自动化引入管道的选项包括数据工厂、Functions 和逻辑应用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-214">Options for an automated ingestion pipeline include Data Factory, Functions, and Logic Apps.</span></span> <span data-ttu-id="9d5d8-215">根据所用的数据存储和架构，可以使用这些方法的组合。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-215">Depending on the data stores and the schemas, you might use a combination of these approaches.</span></span>

<span data-ttu-id="9d5d8-216">在开始时，合理的做法是使用 Azure 门户手动创建 Azure 资源。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-216">As you get started, it's reasonable to use the Azure portal to manually create Azure resources.</span></span> <span data-ttu-id="9d5d8-217">以后，应更多地考虑将这些资源的部署自动化。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-217">Later on, you should put more thought into automating the deployment of these resources.</span></span>

### <a name="core-bot-logic-and-ux"></a><span data-ttu-id="9d5d8-218">核心机器人逻辑和用户体验</span><span class="sxs-lookup"><span data-stu-id="9d5d8-218">Core bot logic and UX</span></span>

<span data-ttu-id="9d5d8-219">创建规范并引入一些数据后，可以开始将机器人付诸实现。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-219">Once you have a specification and some data, it's time to start making your bot into reality.</span></span> <span data-ttu-id="9d5d8-220">让我们专注于核心机器人逻辑。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-220">Let's focus on the core bot logic.</span></span> <span data-ttu-id="9d5d8-221">这是用于处理用户聊天的代码，包括路由逻辑、消除歧义逻辑和日志记录。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-221">This is the code that handles the conversation with the user, including the routing logic, disambiguation logic, and logging.</span></span> <span data-ttu-id="9d5d8-222">首先熟悉 [Bot Framework][bot-framework]，包括：</span><span class="sxs-lookup"><span data-stu-id="9d5d8-222">Start by familiarizing yourself with the [Bot Framework][bot-framework], including:</span></span>

- <span data-ttu-id="9d5d8-223">该框架中使用的基本概念和术语，尤其是[聊天]、[轮次]和[活动]。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-223">Basic concepts and terminology used in the framework, especially [conversations], [turns], and [activities].</span></span>
- <span data-ttu-id="9d5d8-224">[机器人连接器服务](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart)：用于处理机器人与通道之间的网络。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-224">The [Bot Connector service](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart), which handles the networking between the bot and your channels.</span></span>
- <span data-ttu-id="9d5d8-225">如何保留聊天[状态](/azure/bot-service/bot-builder-concept-state)：可以保存在内存中，不过，最好是保存在 Azure Blob 存储或 Azure Cosmos DB 等存储中。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-225">How conversation [state](/azure/bot-service/bot-builder-concept-state) is maintained, either in memory or better yet in a store such as Azure Blob Storage or Azure Cosmos DB.</span></span>
- <span data-ttu-id="9d5d8-226">[中间件](/azure/bot-service/bot-builder-basics#middleware)，以及如何使用中间件将机器人挂接到认知服务等外部服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-226">[Middleware](/azure/bot-service/bot-builder-basics#middleware), and how it can be used to hook up your bot with external services, such as Cognitive Services.</span></span>

<span data-ttu-id="9d5d8-227">可以使用多个选项来丰富[用户体验](/azure/bot-service/bot-service-design-user-experience)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-227">For a rich [user experience](/azure/bot-service/bot-service-design-user-experience), there are many options.</span></span>

- <span data-ttu-id="9d5d8-228">可以使用[卡片](/azure/bot-service/bot-service-design-user-experience#cards)来包含按钮、图像、轮播和菜单。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-228">You can use [cards](/azure/bot-service/bot-service-design-user-experience#cards) to include buttons, images, carousels, and menus.</span></span>
- <span data-ttu-id="9d5d8-229">机器人可以支持语音。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-229">A bot can support speech.</span></span>
- <span data-ttu-id="9d5d8-230">甚至可以在应用或网站中嵌入机器人，然后使用机器人所在的应用的功能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-230">You can even embed your bot in an app or website and use the capabilities of the app hosting it.</span></span>

<span data-ttu-id="9d5d8-231">若要开始，可以选择可用的 C# 和 Node.js 模板，使用 [Azure 机器人服务](/azure/bot-service/bot-service-quickstart)在线生成机器人。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-231">To get started, you can build your bot online using the [Azure Bot Service](/azure/bot-service/bot-service-quickstart), selecting from the available C# and Node.js templates.</span></span> <span data-ttu-id="9d5d8-232">但是，在机器人变得更复杂后，需要在本地创建机器人，然后将其部署到 Web。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-232">As your bot gets more sophisticated, however, you will need to create your bot locally then deploy it to the web.</span></span> <span data-ttu-id="9d5d8-233">选择 IDE（例如 Visual Studio 或 Visual Studio Code）和编程语言。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-233">Choose an IDE, such as Visual Studio or Visual Studio Code, and a programming language.</span></span> <span data-ttu-id="9d5d8-234">SDK 适用于以下语言：</span><span class="sxs-lookup"><span data-stu-id="9d5d8-234">SDKs are available for the following languages:</span></span>

- [<span data-ttu-id="9d5d8-235">C#</span><span class="sxs-lookup"><span data-stu-id="9d5d8-235">C#</span></span>](https://github.com/microsoft/botbuilder-dotnet)
- [<span data-ttu-id="9d5d8-236">JavaScript</span><span class="sxs-lookup"><span data-stu-id="9d5d8-236">JavaScript</span></span>](https://github.com/microsoft/botbuilder-js)
- <span data-ttu-id="9d5d8-237">[Java](https://github.com/microsoft/botbuilder-java)（预览版）</span><span class="sxs-lookup"><span data-stu-id="9d5d8-237">[Java](https://github.com/microsoft/botbuilder-java) (preview)</span></span>
- <span data-ttu-id="9d5d8-238">[Python](https://github.com/microsoft/botbuilder-python)（预览版）</span><span class="sxs-lookup"><span data-stu-id="9d5d8-238">[Python](https://github.com/microsoft/botbuilder-python) (preview)</span></span>

<span data-ttu-id="9d5d8-239">首先，可以下载使用 Azure 机器人服务创建的机器人的源代码。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-239">As a starting point, you can download the source code for the bot you created using the Azure Bot Service.</span></span> <span data-ttu-id="9d5d8-240">还可以查找简单聊天机器人或者与各种 AI 服务集成的复杂机器人的[示例代码](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-240">You can also find [sample code](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md), from simple echo bots to more sophisticated bots that integrate with various AI services.</span></span>

### <a name="add-smarts-to-your-bot"></a><span data-ttu-id="9d5d8-241">将智能添加到机器人</span><span class="sxs-lookup"><span data-stu-id="9d5d8-241">Add smarts to your bot</span></span>

<span data-ttu-id="9d5d8-242">对于使用妥善定义的命令列表的简单机器人，可以使用基于规则的方法通过正则表达式分析用户输入。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-242">For a simple bot with a well-defined list of commands, you might be able to use a rules-based approach to parse the user input via regex.</span></span> <span data-ttu-id="9d5d8-243">确定性和可理解性是这种方法的优势。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-243">This has the advantage of being deterministic and understandable.</span></span> <span data-ttu-id="9d5d8-244">但是，如果机器人需要理解其他自然语言消息的意向和实体，可以借助 AI 服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-244">However, when your bot needs to understand the intents and entities of a more natural-language message, there are AI services that can help.</span></span>

- <span data-ttu-id="9d5d8-245">LUIS 专用于理解用户意向和实体。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-245">LUIS is specifically designed to understand user intents and entities.</span></span> <span data-ttu-id="9d5d8-246">可以使用适度大小的相关[用户输入](/azure/cognitive-services/luis/luis-concept-utterance)集合与所需响应来训练机器人，然后它会返回用户给定消息的意向和实体。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-246">You train it with a moderately sized collection of relevant [user input](/azure/cognitive-services/luis/luis-concept-utterance) and desired responses, and it returns the intents and entities for a user's given message.</span></span>

- <span data-ttu-id="9d5d8-247">Azure 搜索可与 LUIS 一起工作。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-247">Azure Search can work alongside LUIS.</span></span> <span data-ttu-id="9d5d8-248">使用搜索可以基于所有相关数据创建可搜索的索引。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-248">Using Search, you create searchable indexes over all relevant data.</span></span> <span data-ttu-id="9d5d8-249">机器人将在这些索引中查询 LUIS 提取的实体。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-249">The bot queries these indexes for the entities extracted by LUIS.</span></span> <span data-ttu-id="9d5d8-250">Azure 搜索还支持[同义词][synonyms]，这可以扩大正确单词映射的网络。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-250">Azure Search also supports [synonyms][synonyms], which can widen the net of correct word mappings.</span></span>

- <span data-ttu-id="9d5d8-251">QnA Maker 是可以返回给定问题的答案的另一个服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-251">QnA Maker is another service that is designed to return answers for given questions.</span></span> <span data-ttu-id="9d5d8-252">它通常是基于 FAQ 等半结构化数据训练的。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-252">It's typically trained over semi-structured data such as FAQs.</span></span>

<span data-ttu-id="9d5d8-253">机器人可以使用其他 AI 服务来进一步丰富用户体验。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-253">Your bot can use other AI services to further enrich the user experience.</span></span> <span data-ttu-id="9d5d8-254">[预生成 AI 的认知服务套件](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a)服务（包括 LUIS 和 QnA Maker）为视觉、语音、语言、搜索和定位提供服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-254">The [Cognitive Services suite of pre-built AI](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) services (which includes LUIS and QnA Maker) has services for vision, speech, language, search, and location.</span></span> <span data-ttu-id="9d5d8-255">可以快速添加语言翻译、拼写检查、情绪分析、OCR、位置感知和内容审核等功能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-255">You can quickly add functionality such as language translation, spell checking, sentiment analysis, OCR, location awareness, and content moderation.</span></span> <span data-ttu-id="9d5d8-256">可以在机器人中将这些服务连接为中间件模块，以便以更自然、更智能的方式与用户交互。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-256">These services can be wired up as middleware modules in your bot to interact more naturally and intelligently with the user.</span></span>

<span data-ttu-id="9d5d8-257">另一种做法是集成自己的自定义 AI 服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-257">Another option is to integrate your own custom AI service.</span></span> <span data-ttu-id="9d5d8-258">这种方法更加复杂，但在机器学习算法、训练和模型方面能够全面提高灵活性。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-258">This approach is more complex, but gives you complete flexibility in terms of the machine learning algorithm, training, and model.</span></span> <span data-ttu-id="9d5d8-259">例如，可以实现自己的主题建模，然后使用 [LDA][lda] 等算法来查找类似或相关的文档。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-259">For example, you could implement your own topic modeling and use algorithm such as [LDA][lda] to find similar or relevant documents.</span></span> <span data-ttu-id="9d5d8-260">一种不错的方法是将自定义 AI 解决方案公开为 Web 服务终结点，然后从核心机器人逻辑调用该终结点。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-260">A good approach is to expose your custom AI solution as a web service endpoint, and call the endpoint from the core bot logic.</span></span> <span data-ttu-id="9d5d8-261">Web 服务可以托管在应用服务或 VM 群集中。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-261">The web service could be hosted in App Service or in a cluster of VMs.</span></span> <span data-ttu-id="9d5d8-262">[Azure 机器学习][aml]提供许多服务和库来帮助你[训练](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training)与[部署](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment)模型。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-262">[Azure Machine Learning][aml] provides a number of services and libraries to assist you in [training](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training) and [deploying](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment) your models.</span></span>

## <a name="quality-assurance-and-enhancement"></a><span data-ttu-id="9d5d8-263">质量保证和增强功能</span><span class="sxs-lookup"><span data-stu-id="9d5d8-263">Quality assurance and enhancement</span></span>

<span data-ttu-id="9d5d8-264">**日志记录**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-264">**Logging**.</span></span> <span data-ttu-id="9d5d8-265">记录用户与机器人之间的聊天，包括基础性能指标和任何错误。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-265">Log user conversations with the bot, including the underlying performance metrics and any errors.</span></span> <span data-ttu-id="9d5d8-266">这些日志确实能够为调试问题、了解用户交互和改善系统提供宝贵的信息。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-266">These logs will prove invaluable for debugging issues, understanding user interactions, and improving the system.</span></span> <span data-ttu-id="9d5d8-267">可以使用不同的数据存储来保存不同类型的日志。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-267">Different data stores might be appropriate for different types of logs.</span></span> <span data-ttu-id="9d5d8-268">例如，可以考虑使用 Application Insights 来保存 Web 日志、使用 Cosmos DB 保存聊天，使用 Azure 存储来保存大型有效负载。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-268">For example, consider Application Insights for web logs, Cosmos DB for conversations, and Azure Storage for large payloads.</span></span> <span data-ttu-id="9d5d8-269">请参阅[直接写入到存储][transcript-storage]。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-269">See [Write directly to storage][transcript-storage].</span></span>

<span data-ttu-id="9d5d8-270">**反馈**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-270">**Feedback**.</span></span> <span data-ttu-id="9d5d8-271">此外，必须了解用户对机器人交互的满意度。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-271">It's also important to understand how satisfied users are with their bot interactions.</span></span> <span data-ttu-id="9d5d8-272">如果记录了用户反馈，则可以使用此数据来专注于改善某些交互，并重新训练 AI 模型以提高性能。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-272">If you have a record of user feedback, you can use this data to focus your efforts on improving certain interactions and retraining the AI models for improved performance.</span></span> <span data-ttu-id="9d5d8-273">使用反馈重新训练系统中的模型，例如 LUIS。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-273">Use the feedback to retrain the models, such as LUIS, in your system.</span></span>

<span data-ttu-id="9d5d8-274">**测试**。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-274">**Testing**.</span></span> <span data-ttu-id="9d5d8-275">测试机器人涉及到单元测试、集成测试、回归测试和功能测试。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-275">Testing a bot involves unit tests, integration tests, regression tests, and functional tests.</span></span> <span data-ttu-id="9d5d8-276">若要进行测试，我们建议 Azure 搜索或 QnA Maker 等外部服务提供的实际 HTTP 响应，以便在单元测试期间可以播放这些响应，而无需对外部服务发出实际的网络调用。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-276">For testing, we recommend recording real HTTP responses from external services, such as Azure Search or QnA Maker, so they can be played back during unit testing without needing to make real network calls to external services.</span></span>

<span data-ttu-id="9d5d8-277">若要在这些领域快速开始进行开发，请查看[适用于 JavaScript 的 Botbuilder 实用工具](https://github.com/Microsoft/botbuilder-utils-js)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-277">To jump-start your development in these areas, look at the [Botbuilder Utils for JavaScript](https://github.com/Microsoft/botbuilder-utils-js).</span></span> <span data-ttu-id="9d5d8-278">此存储库包含使用 [Microsoft Bot Framework v4][bot-framework] 生成的、运行 Node.js 的机器人的示例实用工具代码。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-278">This repo contains sample utility code for bots built with [Microsoft Bot Framework v4][bot-framework] and running Node.js.</span></span> <span data-ttu-id="9d5d8-279">其中包括以下包：</span><span class="sxs-lookup"><span data-stu-id="9d5d8-279">It includes the following packages:</span></span>

- <span data-ttu-id="9d5d8-280">[HTTP 测试记录器](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-280">[Http Test Recorder](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder).</span></span> <span data-ttu-id="9d5d8-281">记录来自外部服务的 HTTP 流量。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-281">Records HTTP traffic from external services.</span></span> <span data-ttu-id="9d5d8-282">此包原生支持 LUIS、Azure 搜索和 QnAMaker，但同时提供了相应的扩展用于支持任何服务。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-282">It comes pre-built with support for LUIS, Azure Search, and QnAMaker, but extensions are available to support any service.</span></span>

- <span data-ttu-id="9d5d8-283">[Cosmos DB 脚本存储](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-283">[Cosmos DB Transcript Store](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb).</span></span> <span data-ttu-id="9d5d8-284">演示如何在 Cosmos DB 中存储和查询机器人脚本。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-284">Shows how to store and query bot transcripts in Cosmos DB.</span></span>

- <span data-ttu-id="9d5d8-285">[Application Insights 脚本存储](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-285">[Application Insights Transcript Store](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights).</span></span> <span data-ttu-id="9d5d8-286">演示如何在 Application Insights 中存储和查询机器人脚本。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-286">Shows how to store and query bot transcripts in Application Insights.</span></span>

- <span data-ttu-id="9d5d8-287">[反馈集合中间件](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback)。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-287">[Feedback Collection Middleware](https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback).</span></span> <span data-ttu-id="9d5d8-288">可用于生成反馈-请求机制的示例中间件。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-288">Sample middleware that can be used to build a feedback-request mechanism.</span></span>

> [!NOTE]
> <span data-ttu-id="9d5d8-289">这些包以实用工具示例代码的形式提供，不保证提供支持或更新。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-289">These packages are provided as utility sample code, and come with no guarantee of support or updates.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="9d5d8-290">可用性注意事项</span><span class="sxs-lookup"><span data-stu-id="9d5d8-290">Availability considerations</span></span>

<span data-ttu-id="9d5d8-291">将新的功能或 bug 修复措施部署到机器人时，最好是使用多个部署环境，例如过渡和生产。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-291">As you roll out new features or bug fixes to your bot, it's best to use multiple deployment environments, such as staging and production.</span></span> <span data-ttu-id="9d5d8-292">使用 [Azure DevOps][devops] 提供的部署[槽位][slots]可以在不停机的情况下实现此目的。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-292">Using deployment [slots][slots] from [Azure DevOps][devops] allows you to do this with zero downtime.</span></span> <span data-ttu-id="9d5d8-293">在将最新的升级交换到生产环境之前，可以在过渡环境中对其进行测试。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-293">You can test your latest upgrades in the staging environment before swapping them to the production environment.</span></span> <span data-ttu-id="9d5d8-294">在处理负载方面，应用服务可让用户手动或自动进行纵向或横向扩展。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-294">In terms of handling load, App Service is designed to scale up or out manually or automatically.</span></span> <span data-ttu-id="9d5d8-295">由于机器人托管在 Microsoft 的全球数据中心基础结构中，应用服务 SLA 可以承诺高可用性。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-295">Because your bot is hosted in Microsoft's global datacenter infrastructure, the App Service SLA promises high availability.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="9d5d8-296">安全注意事项</span><span class="sxs-lookup"><span data-stu-id="9d5d8-296">Security considerations</span></span>

<span data-ttu-id="9d5d8-297">与其他任何应用程序一样，机器人可以处理敏感数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-297">As with any other application, the bot can be designed to handle sensitive data.</span></span> <span data-ttu-id="9d5d8-298">因此，应限制谁可以登录和使用机器人。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-298">Therefore, restrict who can sign in and use the bot.</span></span> <span data-ttu-id="9d5d8-299">此外，应该根据用户的标识或角色来限制可以访问的数据。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-299">Also limit which data can be accessed, based on the user's identity or role.</span></span> <span data-ttu-id="9d5d8-300">使用 Azure AD 进行标识和访问控制，并使用 Key Vault 来管理密钥和机密。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-300">Use Azure AD for identity and access control and Key Vault to manage keys and secrets.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="9d5d8-301">可管理性注意事项</span><span class="sxs-lookup"><span data-stu-id="9d5d8-301">Manageability considerations</span></span>

### <a name="monitoring-and-reporting"></a><span data-ttu-id="9d5d8-302">监视和报告</span><span class="sxs-lookup"><span data-stu-id="9d5d8-302">Monitoring and reporting</span></span>

<span data-ttu-id="9d5d8-303">在生产环境中运行机器人后，需要设立一个 DevOps 团队来保持这种状态。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-303">Once your bot is running in production, you will need a DevOps team to keep it that way.</span></span> <span data-ttu-id="9d5d8-304">持续监视系统，以确保机器人以峰值性能保持运行。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-304">Continually monitor the system to ensure the bot operates at peak performance.</span></span> <span data-ttu-id="9d5d8-305">通过 Application Insights 本身、Power BI 或自定义 Web 应用仪表板，使用发送到 Application Insights 或 Cosmos DB 的日志创建监视仪表板。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-305">Use the logs sent to Application Insights or Cosmos DB to create monitoring dashboards, either using Application Insights itself, Power BI, or a custom web app dashboard.</span></span> <span data-ttu-id="9d5d8-306">如果发生严重错误或性能低于可接受的阈值，请将警报发送到 DevOps 团队。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-306">Send alerts to the DevOps team if critical errors occur or performance falls below an acceptable threshold.</span></span>

### <a name="automated-resource-deployment"></a><span data-ttu-id="9d5d8-307">自动化资源部署</span><span class="sxs-lookup"><span data-stu-id="9d5d8-307">Automated resource deployment</span></span>

<span data-ttu-id="9d5d8-308">机器人仅仅是某个较大系统的一部分，该系统为机器人提供最新的数据，并确保其正常运行。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-308">The bot itself is only part of a larger system that provides it with the latest data and ensures its proper operation.</span></span> <span data-ttu-id="9d5d8-309">必须部署其他所有 Azure 资源 &mdash; 业务流程服务（例如数据工厂）、存储服务（例如 Cosmos DB），等等。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-309">All of these other Azure resources &mdash; data orchestration services such as Data Factory, storage services such as Cosmos DB, and so forth &mdash; must be deployed.</span></span> <span data-ttu-id="9d5d8-310">Azure 资源管理器提供一致的管理层，可以通过 Azure 门户、PowerShell 或 Azure CLI 访问该层。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-310">Azure Resource Manager provides a consistent management layer that you can access through the Azure portal, PowerShell, or the Azure CLI.</span></span> <span data-ttu-id="9d5d8-311">为获得速度和一致性优势，最好是使用以下方法之一将部署自动化。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-311">For speed and consistency, it's best to automate your deployment using one of these approaches.</span></span>

### <a name="continuous-bot-deployment"></a><span data-ttu-id="9d5d8-312">持续机器人部署</span><span class="sxs-lookup"><span data-stu-id="9d5d8-312">Continuous bot deployment</span></span>

<span data-ttu-id="9d5d8-313">可以直接从 IDE 或命令行（例如 Azure CLI）部署机器人逻辑。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-313">You can deploy the bot logic directly from your IDE or from a command line, such as the Azure CLI.</span></span> <span data-ttu-id="9d5d8-314">但是，随着机器人的日趋成熟，最好是根据[设置持续部署](/azure/bot-service/bot-service-build-continuous-deployment)一文中所述，使用整合了 CI/CD 解决方案（例如 Azure DevOps）的持续部署过程。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-314">As your bot matures, however, it's best to use a continual deployment process using a CI/CD solution such as Azure DevOps, as described in the article [Set up continuous deployment](/azure/bot-service/bot-service-build-continuous-deployment).</span></span> <span data-ttu-id="9d5d8-315">这样，就可以很好地缓解在准生产环境中测试机器人新功能和修复措施时存在的冲突。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-315">This is a good way to ease the friction in testing new features and fixes in your bot in a near-production environment.</span></span> <span data-ttu-id="9d5d8-316">另外，一种不错的想法是创建多个部署环境，通常至少应该创建过渡和生产环境。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-316">It's also a good idea to have multiple deployment environments, typically at least staging and production.</span></span> <span data-ttu-id="9d5d8-317">Azure DevOps 支持这种方法。</span><span class="sxs-lookup"><span data-stu-id="9d5d8-317">Azure DevOps supports this approach.</span></span>

<!-- links -->

[0]: ./_images/conversational-bot.png
[aad]: /azure/active-directory/
[活动]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[activities]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[aml]: /azure/machine-learning/service/
[app-insights]: /azure/azure-monitor/app/app-insights-overview
[app-service]: /azure/app-service/
[blob]: /azure/storage/blobs/storage-blobs-introduction
[bot-authentication]: /azure/bot-service/bot-builder-authentication
[bot-framework]: https://dev.botframework.com/
[bot-framework-service]: /azure/bot-service/bot-builder-basics
[cognitive-services]: /azure/cognitive-services/welcome
[聊天]: /azure/bot-service/bot-service-design-conversation-flow
[conversations]: /azure/bot-service/bot-service-design-conversation-flow
[cosmosdb]: /azure/cosmos-db/
[data-factory]: /azure/data-factory/
[data-factory-ref-arch]: ../data/enterprise-bi-adf.md
[devops]: https://azure.microsoft.com/solutions/devops/
[functions]: /azure/azure-functions/
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
[key-vault]: /azure/key-vault/
[lda]: https://wikipedia.org/wiki/Latent_Dirichlet_allocation/
[logic-apps]: /azure/logic-apps/logic-apps-overview
[luis]: /azure/cognitive-services/luis/
[power-bi]: /power-bi/
[qna-maker]: /azure/cognitive-services/QnAMaker/
[search]: /azure/search/
[slots]: /azure/app-service/deploy-staging-slots/
[synonyms]: /azure/search/search-synonyms
[transcript-storage]: /azure/bot-service/bot-builder-howto-v4-storage
[轮次]: /azure/bot-service/bot-builder-basics#defining-a-turn
[turns]: /azure/bot-service/bot-builder-basics#defining-a-turn
[vscode]: https://azure.microsoft.com/products/visual-studio-code/
[webapp]: /azure/app-service/overview
[webchat]: /azure/bot-service/bot-service-channel-connect-webchat?view=azure-bot-service-4.0/
