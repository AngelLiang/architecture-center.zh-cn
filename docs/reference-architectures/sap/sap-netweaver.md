---
title: 在 Azure VM 上部署适用于 AnyDB 的 SAP NetWeaver (Windows)
titleSuffix: Azure Reference Architectures
description: 有关在 Azure 上的高可用性 Linux 环境中运行 SAP S/4HANA 的成熟做法。
author: lbrader
ms.date: 08/03/2018
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: seodec18, SAP, Windows
ms.openlocfilehash: 1167a65786c3df946ebaed3e52e4ed4033f50fd5
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54486397"
---
# <a name="deploy-sap-netweaver-windows-for-anydb-on-azure-virtual-machines"></a><span data-ttu-id="af67c-103">在 Azure 虚拟机上部署适用于 AnyDB 的 SAP NetWeaver (Windows)</span><span class="sxs-lookup"><span data-stu-id="af67c-103">Deploy SAP NetWeaver (Windows) for AnyDB on Azure virtual machines</span></span>

<span data-ttu-id="af67c-104">此参考体系结构演示有关在 Azure 上的高可用性 Windows 环境中运行 SAP NetWeaver 的一套成熟做法。</span><span class="sxs-lookup"><span data-stu-id="af67c-104">This reference architecture shows a set of proven practices for running SAP NetWeaver in a Windows environment on Azure with high availability.</span></span> <span data-ttu-id="af67c-105">数据库为 AnyDB（除了 SAP HANA 之外，该 SAP 术语还指任何受支持的 DBMS）。</span><span class="sxs-lookup"><span data-stu-id="af67c-105">The database is AnyDB, the SAP term for any supported DBMS besides SAP HANA.</span></span> <span data-ttu-id="af67c-106">将使用可根据组织需求更改的特定虚拟机 (VM) 大小部署此体系结构。</span><span class="sxs-lookup"><span data-stu-id="af67c-106">This architecture is deployed with specific virtual machine (VM) sizes that can be changed to accommodate your organization's needs.</span></span>

![Azure VM 上适用于 AnyDB 的 SAP NetWeaver (Windows) 的参考体系结构](./images/sap-netweaver.png)

<span data-ttu-id="af67c-108">下载此体系结构的 [Visio 文件][visio-download]。</span><span class="sxs-lookup"><span data-stu-id="af67c-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

> [!NOTE]
> <span data-ttu-id="af67c-109">部署此参考体系结构需要获取 SAP 产品和其他非 Microsoft 技术的相应许可。</span><span class="sxs-lookup"><span data-stu-id="af67c-109">Deploying this reference architecture requires appropriate licensing of SAP products and other non-Microsoft technologies.</span></span>

## <a name="architecture"></a><span data-ttu-id="af67c-110">体系结构</span><span class="sxs-lookup"><span data-stu-id="af67c-110">Architecture</span></span>

<span data-ttu-id="af67c-111">该体系结构包括以下基础结构和关键软件组件。</span><span class="sxs-lookup"><span data-stu-id="af67c-111">The architecture consists of the following infrastructure and key software components.</span></span>

<span data-ttu-id="af67c-112">虚拟网络。</span><span class="sxs-lookup"><span data-stu-id="af67c-112">**Virtual network**.</span></span> <span data-ttu-id="af67c-113">Azure 虚拟网络服务在 Azure 资源之间建立安全连接。</span><span class="sxs-lookup"><span data-stu-id="af67c-113">The Azure Virtual Network service securely connects Azure resources to each other.</span></span> <span data-ttu-id="af67c-114">在此体系结构中，虚拟网络将通过[中心-分支型](../hybrid-networking/hub-spoke.md)拓扑的中心内部署的 VPN 网关连接到本地环境。</span><span class="sxs-lookup"><span data-stu-id="af67c-114">In this architecture, the virtual network connects to an on-premises environment through a VPN gateway deployed in the hub of a [hub-spoke](../hybrid-networking/hub-spoke.md).</span></span> <span data-ttu-id="af67c-115">分支是用于 SAP 应用程序和数据库层的虚拟网络。</span><span class="sxs-lookup"><span data-stu-id="af67c-115">The spoke is the virtual network used for the SAP applications and database tier.</span></span>

<span data-ttu-id="af67c-116">**子网**。</span><span class="sxs-lookup"><span data-stu-id="af67c-116">**Subnets**.</span></span> <span data-ttu-id="af67c-117">针对以下每个层将虚拟网络细分为单独的子网：应用 (SAP NetWeaver)、数据库、共享服务 (jumpbox) 和 Active Directory。</span><span class="sxs-lookup"><span data-stu-id="af67c-117">The virtual network is subdivided into separate subnets for each tier: application (SAP NetWeaver), database, shared services (the jumpbox), and Active Directory.</span></span>

<span data-ttu-id="af67c-118">**虚拟机**。</span><span class="sxs-lookup"><span data-stu-id="af67c-118">**Virtual machines**.</span></span> <span data-ttu-id="af67c-119">此体系结构对应用层和数据库层使用虚拟机。这些层划分为：</span><span class="sxs-lookup"><span data-stu-id="af67c-119">This architecture uses virtual machines for the application tier and database tier, grouped as follows:</span></span>

- <span data-ttu-id="af67c-120">**SAP NetWeaver**。</span><span class="sxs-lookup"><span data-stu-id="af67c-120">**SAP NetWeaver**.</span></span> <span data-ttu-id="af67c-121">应用层使用 Windows 虚拟机，并运行 SAP Central Services 和 SAP 应用程序服务器。</span><span class="sxs-lookup"><span data-stu-id="af67c-121">The application tier uses Windows virtual machines and runs SAP Central Services and SAP application servers.</span></span> <span data-ttu-id="af67c-122">运行 Central Services 的 VM 配置为 SIOS DataKeeper Cluster Edition 支持的 Windows Server 故障转移群集，以实现高可用性。</span><span class="sxs-lookup"><span data-stu-id="af67c-122">The VMs that run Central Services are configured as a Windows Server Failover Cluster for high availability, supported by SIOS DataKeeper Cluster Edition.</span></span>
- <span data-ttu-id="af67c-123">**AnyDB**。</span><span class="sxs-lookup"><span data-stu-id="af67c-123">**AnyDB**.</span></span> <span data-ttu-id="af67c-124">数据库层运行用作源数据库的 AnyDB，例如 Microsoft SQL Server、Oracle 或 IBM DB2。</span><span class="sxs-lookup"><span data-stu-id="af67c-124">The database tier runs AnyDB as the source database, such as Microsoft SQL Server, Oracle, or IBM DB2.</span></span>
- <span data-ttu-id="af67c-125">**Jumpbox**。</span><span class="sxs-lookup"><span data-stu-id="af67c-125">**Jumpbox**.</span></span> <span data-ttu-id="af67c-126">也称为守护主机。</span><span class="sxs-lookup"><span data-stu-id="af67c-126">Also called a bastion host.</span></span> <span data-ttu-id="af67c-127">这是网络中的一个安全虚拟机，管理员使用它来连接其他虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-127">This is a secure virtual machine on the network that administrators use to connect to the other virtual machines.</span></span>
- <span data-ttu-id="af67c-128">**Windows Server Active Directory 域控制器。**</span><span class="sxs-lookup"><span data-stu-id="af67c-128">**Windows Server Active Directory domain controllers**.</span></span> <span data-ttu-id="af67c-129">对域中的所有 VM 和用户使用域控制器。</span><span class="sxs-lookup"><span data-stu-id="af67c-129">The domain controllers are used on all VMs and users in the domain.</span></span>

<span data-ttu-id="af67c-130">**负载均衡器**。</span><span class="sxs-lookup"><span data-stu-id="af67c-130">**Load balancers**.</span></span> <span data-ttu-id="af67c-131">[Azure 负载均衡器](/azure/load-balancer/load-balancer-overview)实例用于将流量分配到应用层子网中的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-131">[Azure Load Balancer](/azure/load-balancer/load-balancer-overview) instances are used to distribute traffic to virtual machines in the application tier subnet.</span></span> <span data-ttu-id="af67c-132">在数据层，可以通过内置 SAP 负载均衡器、Azure 负载均衡器或其他机制来实现高可用性，具体取决于 DBMS。</span><span class="sxs-lookup"><span data-stu-id="af67c-132">At the data tier, high availability may be achieved using built-in SAP load balancers, Azure Load Balancer, or other mechanisms, depending on the DBMS.</span></span> <span data-ttu-id="af67c-133">有关详细信息，请参阅[适用于 SAP NetWeaver 的 Azure 虚拟机 DBMS 部署](/azure/virtual-machines/workloads/sap/dbms-guide)。</span><span class="sxs-lookup"><span data-stu-id="af67c-133">For more information, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

<span data-ttu-id="af67c-134">**可用性集**。</span><span class="sxs-lookup"><span data-stu-id="af67c-134">**Availability sets**.</span></span> <span data-ttu-id="af67c-135">用于 SAP Web 调度程序、SAP 应用程序服务器和 (A)SCS 角色的虚拟机已分组到单独的[可用性集](/azure/virtual-machines/windows/tutorial-availability-sets)，为每个角色至少预配两个虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-135">Virtual machines for the SAP Web Dispatcher, SAP application server, and (A)SCS, roles are grouped into separate [availability sets](/azure/virtual-machines/windows/tutorial-availability-sets), and at least two virtual machines are provisioned per role.</span></span> <span data-ttu-id="af67c-136">这样，虚拟机便可以满足更高的[服务级别协议 (SLA)](https://azure.microsoft.com/support/legal/sla/virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="af67c-136">This makes the virtual machines eligible for a higher [service level agreement](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLA).</span></span>

<span data-ttu-id="af67c-137">**NIC**。</span><span class="sxs-lookup"><span data-stu-id="af67c-137">**NICs**.</span></span> <span data-ttu-id="af67c-138">[网络接口卡](/azure/virtual-network/virtual-network-network-interface) (NIC) 使虚拟网络中的虚拟机能够实现各种通信。</span><span class="sxs-lookup"><span data-stu-id="af67c-138">[Network interface cards](/azure/virtual-network/virtual-network-network-interface) (NICs) enable all communication of virtual machines on a virtual network.</span></span>

<span data-ttu-id="af67c-139">**网络安全组**。</span><span class="sxs-lookup"><span data-stu-id="af67c-139">**Network security groups**.</span></span> <span data-ttu-id="af67c-140">若要限制虚拟网络中的传入、传出和子网内部流量，可以创建[网络安全组](/azure/virtual-network/virtual-networks-nsg) (NSG)。</span><span class="sxs-lookup"><span data-stu-id="af67c-140">To restrict incoming, outgoing, and intra-subnet traffic in the virtual network, you can create [network security groups](/azure/virtual-network/virtual-networks-nsg) (NSGs).</span></span>

<span data-ttu-id="af67c-141">**网关**。</span><span class="sxs-lookup"><span data-stu-id="af67c-141">**Gateway**.</span></span> <span data-ttu-id="af67c-142">网关将本地网络扩展到 Azure 虚拟网络。</span><span class="sxs-lookup"><span data-stu-id="af67c-142">A gateway extends your on-premises network to the Azure virtual network.</span></span> <span data-ttu-id="af67c-143">建议使用 [ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) Azure 服务来创建不必经由公共 Internet 的专用连接，但也可以使用[站点到站点](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)连接。</span><span class="sxs-lookup"><span data-stu-id="af67c-143">[ExpressRoute](/azure/architecture/reference-architectures/hybrid-networking/expressroute) is the recommended Azure service for creating private connections that do not go over the public Internet, but a [Site-to-Site](/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal) connection can also be used.</span></span>

<span data-ttu-id="af67c-144">**Azure 存储**。</span><span class="sxs-lookup"><span data-stu-id="af67c-144">**Azure Storage**.</span></span> <span data-ttu-id="af67c-145">若要提供虚拟机的虚拟硬盘 (VHD) 持久存储，必须使用 [Azure 存储](/azure/storage/storage-standard-storage)。</span><span class="sxs-lookup"><span data-stu-id="af67c-145">To provide persistent storage of a virtual machine's virtual hard disk (VHD), [Azure Storage](/azure/storage/storage-standard-storage) is required.</span></span> <span data-ttu-id="af67c-146">[云见证](/windows-server/failover-clustering/deploy-cloud-witness)也会使用 Azure 存储来实施故障转移群集操作。</span><span class="sxs-lookup"><span data-stu-id="af67c-146">It is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to implement a failover cluster operation.</span></span>

## <a name="recommendations"></a><span data-ttu-id="af67c-147">建议</span><span class="sxs-lookup"><span data-stu-id="af67c-147">Recommendations</span></span>

<span data-ttu-id="af67c-148">你的要求可能不同于此处描述的体系结构。</span><span class="sxs-lookup"><span data-stu-id="af67c-148">Your requirements might differ from the architecture described here.</span></span> <span data-ttu-id="af67c-149">请使用以下建议作为入手点。</span><span class="sxs-lookup"><span data-stu-id="af67c-149">Use these recommendations as a starting point.</span></span>

### <a name="sap-web-dispatcher-pool"></a><span data-ttu-id="af67c-150">SAP Web 调度程序池</span><span class="sxs-lookup"><span data-stu-id="af67c-150">SAP Web Dispatcher pool</span></span>

<span data-ttu-id="af67c-151">Web 调度程序组件用作 SAP 应用程序服务器之间的 SAP 流量的负载均衡器。</span><span class="sxs-lookup"><span data-stu-id="af67c-151">The Web Dispatcher component is used as a load balancer for SAP traffic among the SAP application servers.</span></span> <span data-ttu-id="af67c-152">若要实现 Web 调度程序组件的高可用性，需使用 Azure 负载均衡器来实施并行的 Web 调度程序设置。</span><span class="sxs-lookup"><span data-stu-id="af67c-152">To achieve high availability for the Web Dispatcher component, Azure Load Balancer is used to implement the parallel Web Dispatcher setup.</span></span> <span data-ttu-id="af67c-153">Web 调度程序使用轮循机制配置，在均衡器池中的可用 Web 调度程序之间分配 HTTP(S) 流量。</span><span class="sxs-lookup"><span data-stu-id="af67c-153">Web Dispatcher uses in a round-robin configuration for HTTP(S) traffic distribution among the available Web Dispatchers in the balancers pool.</span></span>

<span data-ttu-id="af67c-154">有关在 Azure VM 中运行 SAP NetWeaver 的详细信息，请参阅[适用于 SAP NetWeaver 的 Azure 虚拟机规划和实施](/azure/virtual-machines/workloads/sap/planning-guide)。</span><span class="sxs-lookup"><span data-stu-id="af67c-154">For details about running SAP NetWeaver in Azure VMs, see [Azure Virtual Machines planning and implementation for SAP NetWeaver](/azure/virtual-machines/workloads/sap/planning-guide).</span></span>

### <a name="application-servers-pool"></a><span data-ttu-id="af67c-155">应用程序服务器池</span><span class="sxs-lookup"><span data-stu-id="af67c-155">Application servers pool</span></span>

<span data-ttu-id="af67c-156">若要管理 ABAP 应用程序服务器的登录组，需使用 SMLG 事务。</span><span class="sxs-lookup"><span data-stu-id="af67c-156">To manage logon groups for ABAP application servers, the SMLG transaction is used.</span></span> <span data-ttu-id="af67c-157">该事务使用 Central Services 的消息服务器中的负载均衡功能，在 SAPGUI 的 SAP 应用程序服务器池之间分配工作负荷，以及分配 RFC 流量。</span><span class="sxs-lookup"><span data-stu-id="af67c-157">It uses the load balancing function within the message server of the Central Services to distribute workload among SAP application servers pool for SAPGUIs and RFC traffic.</span></span> <span data-ttu-id="af67c-158">与高可用性 Central Services 的应用程序服务器连接通过群集虚拟网络名称来建立。</span><span class="sxs-lookup"><span data-stu-id="af67c-158">The application server connection to the highly available Central Services is through the cluster virtual network name.</span></span>

### <a name="sap-central-services-cluster"></a><span data-ttu-id="af67c-159">SAP Central Services 群集</span><span class="sxs-lookup"><span data-stu-id="af67c-159">SAP Central Services cluster</span></span>

<span data-ttu-id="af67c-160">此参考体系结构在应用层中的 VM 上运行 Central Services。</span><span class="sxs-lookup"><span data-stu-id="af67c-160">This reference architecture runs Central Services on VMs in the application tier.</span></span> <span data-ttu-id="af67c-161">如果将 Central Services 部署到单个 VM（高可用性不是一项要求时，通常采用这种部署方式），则它可能会成为潜在的单一故障点 (SPOF)。</span><span class="sxs-lookup"><span data-stu-id="af67c-161">The Central Services is a potential single point of failure (SPOF) when deployed to a single VM—typical deployment when high availability is not a requirement.</span></span> <span data-ttu-id="af67c-162">若要实施高可用性解决方案，可以使用共享的磁盘群集或文件共享群集。</span><span class="sxs-lookup"><span data-stu-id="af67c-162">To implement a high availability solution, either a shared disk cluster or a file share cluster can be used.</span></span>

<span data-ttu-id="af67c-163">若要为共享磁盘群集配置 VM，请使用 [Windows Server 故障转移群集](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-163">To configure VMs for a shared disk cluster, use [Windows Server Failover Cluster](https://blogs.sap.com/2018/01/25/how-to-create-sap-resources-in-windows-failover-cluster/).</span></span> <span data-ttu-id="af67c-164">建议将[云见证](/windows-server/failover-clustering/deploy-cloud-witness)用作仲裁见证。</span><span class="sxs-lookup"><span data-stu-id="af67c-164">[Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) is recommended as a quorum witness.</span></span> <span data-ttu-id="af67c-165">为了支持故障转移群集环境，[SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) 会通过复制群集节点拥有的独立磁盘来执行群集共享卷功能。</span><span class="sxs-lookup"><span data-stu-id="af67c-165">To support the failover cluster environment, [SIOS DataKeeper Cluster Edition](https://azuremarketplace.microsoft.com/marketplace/apps/sios_datakeeper.sios-datakeeper-8) performs the cluster shared volume function by replicating independent disks owned by the cluster nodes.</span></span> <span data-ttu-id="af67c-166">Azure 原生并不支持共享磁盘，因此需要 SIOS 提供的解决方案。</span><span class="sxs-lookup"><span data-stu-id="af67c-166">Azure does not natively support shared disks and therefore requires solutions provided by SIOS.</span></span>

<span data-ttu-id="af67c-167">有关详细信息，请参阅</span><span class="sxs-lookup"><span data-stu-id="af67c-167">For details, see "3.</span></span> <span data-ttu-id="af67c-168">[在 Microsoft 平台上运行 SAP 应用程序](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)中的“3. 针对在 Azure 上的 SIOS 中运行 ASCS 的 SAP 客户的重要更新”。</span><span class="sxs-lookup"><span data-stu-id="af67c-168">Important Update for SAP Customers Running ASCS on SIOS on Azure” at [Running SAP applications on the Microsoft platform](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/).</span></span>

<span data-ttu-id="af67c-169">处理群集的另一种方法是使用 Windows Server 故障转移群集实施文件共享群集。</span><span class="sxs-lookup"><span data-stu-id="af67c-169">Another way to handle clustering is to implement a file share cluster using Windows Server Failover Cluster.</span></span> <span data-ttu-id="af67c-170">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) 最近修改了 Central Services 部署模式，以允许通过 UNC 路径访问 /sapmnt 全局目录。</span><span class="sxs-lookup"><span data-stu-id="af67c-170">[SAP](https://blogs.sap.com/2018/03/19/migration-from-a-shared-disk-cluster-to-a-file-share-cluster/) recently modified the Central Services deployment pattern to access the /sapmnt global directories via a UNC path.</span></span> <span data-ttu-id="af67c-171">此项更改[消除了](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/)需要在 Central Services VM 上使用 SIOS 或其他共享磁盘解决方案的要求。</span><span class="sxs-lookup"><span data-stu-id="af67c-171">This change [removes the requirement](https://blogs.msdn.microsoft.com/saponsqlserver/2017/08/10/high-available-ascs-for-windows-on-file-share-shared-disk-no-longer-required/) for SIOS or other shared disk solutions on the Central Services VMs.</span></span> <span data-ttu-id="af67c-172">我们仍然建议确保 /sapmnt UNC 共享具有[高可用性](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-172">It is still recommended to ensure that the /sapmnt UNC share is [highly available](https://blogs.sap.com/2017/07/21/how-to-create-a-high-available-sapmnt-share/).</span></span> <span data-ttu-id="af67c-173">可在 Central Services 实例上实现此目的：配合 Windows Server 2016 中的[横向扩展文件服务器](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) 和[存储空间直通](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) 功能使用 Windows Server 故障转移群集。</span><span class="sxs-lookup"><span data-stu-id="af67c-173">This can be done on the Central Services instance by using Windows Server Failover Cluster with [Scale Out File Server](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) and the [Storage Spaces Direct](https://blogs.sap.com/2018/03/07/your-sap-on-azure-part-5-ascs-high-availability-with-storage-spaces-direct/) (S2D) feature in Windows Server 2016.</span></span>

### <a name="availability-sets"></a><span data-ttu-id="af67c-174">可用性集</span><span class="sxs-lookup"><span data-stu-id="af67c-174">Availability sets</span></span>

<span data-ttu-id="af67c-175">可用性集将服务器分配到不同的物理基础结构，并更新组以提高服务可用性。</span><span class="sxs-lookup"><span data-stu-id="af67c-175">Availability sets distribute servers to different physical infrastructure and update groups to improve service availability.</span></span> <span data-ttu-id="af67c-176">将执行相同角色的虚拟机放入某个可用性集有助于避免 Azure 基础结构维护工作造成的停机，并有助于满足 [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="af67c-176">Put virtual machines that perform the same role into an availability sets to help guard against downtime caused by Azure infrastructure maintenance and to meet [SLAs](https://azure.microsoft.com/support/legal/sla/virtual-machines) (SLAs).</span></span> <span data-ttu-id="af67c-177">建议为每个可用性集配置两个或更多个虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-177">Two or more virtual machines per availability set is recommended.</span></span>

<span data-ttu-id="af67c-178">一个集内的所有虚拟机必须执行相同的角色。</span><span class="sxs-lookup"><span data-stu-id="af67c-178">All virtual machines in a set must perform the same role.</span></span> <span data-ttu-id="af67c-179">不要在同一个可用性集中混合不同角色的服务器。</span><span class="sxs-lookup"><span data-stu-id="af67c-179">Do not mix servers of different roles in the same availability set.</span></span> <span data-ttu-id="af67c-180">例如，不要将 Central Services 节点放到应用程序服务器所在的同一个可用性集中。</span><span class="sxs-lookup"><span data-stu-id="af67c-180">For example, don't place a Central Services node in the same availability set with the application server.</span></span>

### <a name="nics"></a><span data-ttu-id="af67c-181">NIC</span><span class="sxs-lookup"><span data-stu-id="af67c-181">NICs</span></span>

<span data-ttu-id="af67c-182">传统的本地 SAP 部署为每个计算机实施多个网络接口卡 (NIC)，以便将管理流量与业务流量相分离。</span><span class="sxs-lookup"><span data-stu-id="af67c-182">Traditional on-premises SAP deployments implement multiple network interface cards (NICs) per machine to segregate administrative traffic from business traffic.</span></span> <span data-ttu-id="af67c-183">在 Azure 上，虚拟网络是软件定义的网络，它通过同一网络结构发送所有流量。</span><span class="sxs-lookup"><span data-stu-id="af67c-183">On Azure, the virtual network is a software-defined network that sends all traffic through the same network fabric.</span></span> <span data-ttu-id="af67c-184">因此，没有必要使用多个 NIC。</span><span class="sxs-lookup"><span data-stu-id="af67c-184">Therefore, the use of multiple NICs is unnecessary.</span></span> <span data-ttu-id="af67c-185">但是，如果组织需要分离流量，则可为每个 VM 部署多个 NIC，将每个 NIC 连接到不同的子网，然后使用 NSG 强制实施不同的访问控制策略。</span><span class="sxs-lookup"><span data-stu-id="af67c-185">However, if your organization needs to segregate traffic, you can deploy multiple NICs per VM, connect each NIC to a different subnet, and then use NSGs to enforce different access control policies.</span></span>

### <a name="subnets-and-nsgs"></a><span data-ttu-id="af67c-186">子网和 NSG</span><span class="sxs-lookup"><span data-stu-id="af67c-186">Subnets and NSGs</span></span>

<span data-ttu-id="af67c-187">此体系结构将虚拟网络地址空间划分为子网。</span><span class="sxs-lookup"><span data-stu-id="af67c-187">This architecture subdivides the virtual network address space into subnets.</span></span> <span data-ttu-id="af67c-188">此参考体系结构主要侧重于应用层子网。</span><span class="sxs-lookup"><span data-stu-id="af67c-188">This reference architecture focuses primarily on the application tier subnet.</span></span> <span data-ttu-id="af67c-189">每个子网可与定义子网访问策略的 NSG 相关联。</span><span class="sxs-lookup"><span data-stu-id="af67c-189">Each subnet can be associated with a NSG that defines the access policies for the subnet.</span></span> <span data-ttu-id="af67c-190">请将应用程序服务器放在单独的子网中，以便可以通过管理子网安全策略而不是单个服务器，更轻松地为服务器提供保护。</span><span class="sxs-lookup"><span data-stu-id="af67c-190">Place application servers on a separate subnet so you can secure them more easily by managing the subnet security policies, not the individual servers.</span></span>

<span data-ttu-id="af67c-191">NSG 在与某个子网关联后，将应用到该子网中的所有服务器。</span><span class="sxs-lookup"><span data-stu-id="af67c-191">When a NSG is associated with a subnet, it applies to all the servers within the subnet.</span></span> <span data-ttu-id="af67c-192">有关使用 NSG 对子网中的服务器进行精细控制的详细信息，请参阅[使用网络安全组筛选网络流量](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-192">For more information about using NSGs for fine-grained control over the servers in a subnet, see [Filter network traffic with network security groups](https://azure.microsoft.com/en-us/blog/multiple-vm-nics-and-network-virtual-appliances-in-azure/).</span></span>

### <a name="load-balancers"></a><span data-ttu-id="af67c-193">负载均衡器</span><span class="sxs-lookup"><span data-stu-id="af67c-193">Load balancers</span></span>

<span data-ttu-id="af67c-194">[SAP Web 调度程序](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm)处理对发往 SAP 应用程序服务器池的 HTTP(S) 流量的负载均衡。</span><span class="sxs-lookup"><span data-stu-id="af67c-194">[SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw73ehp1/7.31.19/en-US/48/8fe37933114e6fe10000000a421937/frameset.htm) handles load balancing of HTTP(S) traffic to a pool of SAP application servers.</span></span>

<span data-ttu-id="af67c-195">对于通过 DIAG 协议或远程函数调用 (RFC) 连接 SAP 服务器的 SAP GUI 客户端发出的流量，Central Services 消息服务器会通过 SAP 应用程序服务器[登录组](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing)进行负载均衡，因此，无需额外的负载均衡器。</span><span class="sxs-lookup"><span data-stu-id="af67c-195">For traffic from SAP GUI clients connecting a SAP server via DIAG protocol or Remote Function Calls (RFC), the Central Services message server balances the load through SAP application server [logon groups](https://wiki.scn.sap.com/wiki/display/SI/ABAP+Logon+Group+based+Load+Balancing), so no additional load balancer is needed.</span></span>

### <a name="azure-storage"></a><span data-ttu-id="af67c-196">Azure 存储</span><span class="sxs-lookup"><span data-stu-id="af67c-196">Azure Storage</span></span>

<span data-ttu-id="af67c-197">对于所有数据库服务器虚拟机，我们建议使用 Azure 高级存储，以保持一致的读/写延迟。</span><span class="sxs-lookup"><span data-stu-id="af67c-197">For all database server virtual machines, we recommend using Azure Premium Storage for consistent read/write latency.</span></span> <span data-ttu-id="af67c-198">对于将高级存储用于所有操作系统磁盘和数据磁盘的任何单一实例虚拟机，请参阅[虚拟机的 SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="af67c-198">For any single instance virtual machine using Premium Storage for all operating system disks and data disks, see [SLA for Virtual Machines](https://azure.microsoft.com/support/legal/sla/virtual-machines).</span></span> <span data-ttu-id="af67c-199">此外，对于 SAP 生产系统，我们建议在所有场合下都使用高级 [Azure 托管磁盘](/azure/storage/storage-managed-disks-overview)。</span><span class="sxs-lookup"><span data-stu-id="af67c-199">Also, for production SAP systems, we recommend using Premium [Azure Managed Disks](/azure/storage/storage-managed-disks-overview) in all cases.</span></span> <span data-ttu-id="af67c-200">为提高可靠性，可使用托管磁盘来管理磁盘的 VHD 文件。</span><span class="sxs-lookup"><span data-stu-id="af67c-200">For reliability, Managed Disks are used to manage the VHD files for the disks.</span></span> <span data-ttu-id="af67c-201">托管磁盘可确保隔离可用性集中虚拟机的磁盘，以避免单一故障点。</span><span class="sxs-lookup"><span data-stu-id="af67c-201">Managed disks ensure that the disks for virtual machines within an availability set are isolated to avoid single points of failure.</span></span>

<span data-ttu-id="af67c-202">对于 SAP 应用程序服务器，包括 Central Services 虚拟机，可以使用标准 Azure 存储来降低成本，因为应用程序执行在内存中发生，只将磁盘用于日志记录。</span><span class="sxs-lookup"><span data-stu-id="af67c-202">For SAP application servers, including the Central Services virtual machines, you can use Azure Standard Storage to reduce cost, because application execution takes place in memory and disks are used for logging only.</span></span> <span data-ttu-id="af67c-203">但是，目前只有标准存储才通过了非托管存储的认证。</span><span class="sxs-lookup"><span data-stu-id="af67c-203">However, at this time, Standard Storage is only certified for unmanaged storage.</span></span> <span data-ttu-id="af67c-204">由于应用程序服务器不会托管任何数据，因此你可以借助较小的 P4 和 P6 高级存储磁盘来尽量降低成本。</span><span class="sxs-lookup"><span data-stu-id="af67c-204">Since application servers do not host any data, you can also use the smaller P4 and P6 Premium Storage disks to help minimize cost.</span></span>

<span data-ttu-id="af67c-205">[云见证](/windows-server/failover-clustering/deploy-cloud-witness)也使用 Azure 存储来维护远程 Azure 区域（远离群集所在的主要区域）中设备的仲裁。</span><span class="sxs-lookup"><span data-stu-id="af67c-205">Azure Storage is also used by [Cloud Witness](/windows-server/failover-clustering/deploy-cloud-witness) to maintain quorum with a device in a remote Azure region away from the primary region where the cluster resides.</span></span>

<span data-ttu-id="af67c-206">对于备份数据存储，我们建议使用 Azure [冷访问层](/azure/storage/storage-blob-storage-tiers)和[存档访问层存储](/azure/storage/storage-blob-storage-tiers)。</span><span class="sxs-lookup"><span data-stu-id="af67c-206">For the backup data store, we recommend using Azure [coolaccess tier](/azure/storage/storage-blob-storage-tiers) and [archive access tier storage](/azure/storage/storage-blob-storage-tiers).</span></span> <span data-ttu-id="af67c-207">这些存储层的性价比较高，适合用于存储不经常访问的长久留存数据。</span><span class="sxs-lookup"><span data-stu-id="af67c-207">These storage tiers are cost-effective ways to store long-lived data that is infrequently accessed.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="af67c-208">性能注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-208">Performance considerations</span></span>

<span data-ttu-id="af67c-209">SAP 应用程序服务器与数据库服务器不断通信。</span><span class="sxs-lookup"><span data-stu-id="af67c-209">SAP application servers carry on constant communications with the database servers.</span></span> <span data-ttu-id="af67c-210">对于任何数据库平台上运行的性能关键型应用程序，包括 SAP HANA，请考虑启用[写入加速器](/azure/virtual-machines/linux/how-to-enable-write-accelerator)来改善日志写入延迟。</span><span class="sxs-lookup"><span data-stu-id="af67c-210">For performance-critical applications running on any database platforms, including SAP HANA, consider enabling [Write Accelerator](/azure/virtual-machines/linux/how-to-enable-write-accelerator) to improve log write latency.</span></span> <span data-ttu-id="af67c-211">若要优化服务器间的通信，请使用[加速网络](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-211">To optimize inter-server communications, use the [Accelerated Network](https://azure.microsoft.com/blog/linux-and-windows-networking-performance-enhancements-accelerated-networking/).</span></span> <span data-ttu-id="af67c-212">请注意，这些加速器仅适用于某些 VM 系列。</span><span class="sxs-lookup"><span data-stu-id="af67c-212">Note that these accelerators are available only for certain VM series.</span></span>

<span data-ttu-id="af67c-213">若要实现较高的 IOPS 和磁盘带宽吞吐量，可向 Azure 存储布局应用[优化存储卷性能](/azure/virtual-machines/windows/premium-storage-performance)时采用的常见做法。</span><span class="sxs-lookup"><span data-stu-id="af67c-213">To achieve high IOPS and disk bandwidth throughput, the common practices in storage volume [performance optimization](/azure/virtual-machines/windows/premium-storage-performance) apply to Azure storage layout.</span></span> <span data-ttu-id="af67c-214">例如，将多个磁盘合并在一起以创建条带化磁盘卷可以提高 IO 性能。</span><span class="sxs-lookup"><span data-stu-id="af67c-214">For example, combining multiple disks together to create a striped disk volume improves IO performance.</span></span> <span data-ttu-id="af67c-215">针对不经常更改的存储内容启用读取缓存可增强数据检索的速度。</span><span class="sxs-lookup"><span data-stu-id="af67c-215">Enabling the read cache on storage content that changes infrequently enhances the speed of data retrieval.</span></span>

<span data-ttu-id="af67c-216">对于 SQL 上的 SAP，[Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/)（有关在 Azure 上部署 SAP 应用程序的最关键 10 条注意事项）博客文章提供了有关在 SQL Server 上为 SAP 工作负荷优化 Azure 存储的极佳建议。</span><span class="sxs-lookup"><span data-stu-id="af67c-216">For SAP on SQL, the [Top 10 Key Considerations for Deploying SAP Applications on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/25/top-10-key-considerations-for-deploying-sap-applications-on-azure/) blog offers excellent advice on optimizing Azure storage for SAP workloads on SQL Server.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="af67c-217">可伸缩性注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-217">Scalability considerations</span></span>

<span data-ttu-id="af67c-218">在 SAP 应用程序层，Azure 提供多种虚拟机大小供纵向和横向扩展。有关详尽列表，请参阅 [SAP 说明 1928533](https://launchpad.support.sap.com/#/notes/1928533) - Azure 上的 SAP 应用程序：支持的产品和 Azure VM 类型。</span><span class="sxs-lookup"><span data-stu-id="af67c-218">At the SAP application layer, Azure offers a wide range of virtual machine sizes for scaling up and scaling out. For an inclusive list, see [SAP note 1928533](https://launchpad.support.sap.com/#/notes/1928533) - SAP Applications on Azure: Supported Products and Azure VM Types.</span></span> <span data-ttu-id="af67c-219">（需要创建 SAP Service Marketplace 帐户进行访问。）</span><span class="sxs-lookup"><span data-stu-id="af67c-219">(SAP Service Marketplace account required for access).</span></span> <span data-ttu-id="af67c-220">可以纵向扩展/缩减 SAP 应用程序服务器和 Central Services 群集，或者通过添加更多的实例对其进行横向扩展。</span><span class="sxs-lookup"><span data-stu-id="af67c-220">SAP application servers and the Central Services clusters can scale up/down or scale out by adding more instances.</span></span> <span data-ttu-id="af67c-221">AnyDB 数据库可以纵向扩展/缩减，但不能横向扩展。AnyDB 的 SAP 数据库容器不支持分片。</span><span class="sxs-lookup"><span data-stu-id="af67c-221">The AnyDB database can scale up/down but does not scale out. The SAP database container for AnyDB does not support sharding.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="af67c-222">可用性注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-222">Availability considerations</span></span>

<span data-ttu-id="af67c-223">资源冗余是高可用性基础结构解决方案中的常见话题。</span><span class="sxs-lookup"><span data-stu-id="af67c-223">Resource redundancy is the general theme in highly available infrastructure solutions.</span></span> <span data-ttu-id="af67c-224">对于 SLA 不太苛刻的组织而言，单一实例 Azure VM 可以保障运行时间 SLA。</span><span class="sxs-lookup"><span data-stu-id="af67c-224">For enterprises that have a less stringent SLA, single-instance Azure VMs offer an uptime SLA.</span></span> <span data-ttu-id="af67c-225">有关详细信息，请参阅 [Azure 服务级别协议](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-225">For more information, see [Azure Service Level Agreement](https://azure.microsoft.com/support/legal/sla/).</span></span>

<span data-ttu-id="af67c-226">在这种 SAP 应用程序分布式安装中，将会复制基本安装以实现高可用性。</span><span class="sxs-lookup"><span data-stu-id="af67c-226">In this distributed installation of the SAP application, the base installation is replicated to achieve high availability.</span></span> <span data-ttu-id="af67c-227">对于体系结构的每个层，高可用性设计各不相同。</span><span class="sxs-lookup"><span data-stu-id="af67c-227">For each layer of the architecture, the high availability design varies.</span></span>

### <a name="application-tier"></a><span data-ttu-id="af67c-228">应用层</span><span class="sxs-lookup"><span data-stu-id="af67c-228">Application tier</span></span>

<span data-ttu-id="af67c-229">SAP Web 调度程序的高可用性是通过冗余实例实现的。</span><span class="sxs-lookup"><span data-stu-id="af67c-229">High availability for SAP Web Dispatcher is achieved with redundant instances.</span></span> <span data-ttu-id="af67c-230">请参阅 SAP 文档中的 [SAP Web 调度程序](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm)。</span><span class="sxs-lookup"><span data-stu-id="af67c-230">See [SAP Web Dispatcher](https://help.sap.com/doc/saphelp_nw70ehp2/7.02.16/en-us/48/8fe37933114e6fe10000000a421937/frameset.htm) in the SAP Documentation.</span></span>

<span data-ttu-id="af67c-231">Central Services 的高可用性是通过 Windows Server 故障转移群集实现的。</span><span class="sxs-lookup"><span data-stu-id="af67c-231">High availability of the Central Services is implemented with Windows Server Failover Cluster.</span></span> <span data-ttu-id="af67c-232">在 Azure 上部署群集后，可以使用两种方法来配置故障转移群集的群集存储：群集共享卷或文件共享。</span><span class="sxs-lookup"><span data-stu-id="af67c-232">When deployed on Azure, the cluster storage for the failover cluster can be configured using two approaches: either a clustered shared volume or a file share.</span></span>

<span data-ttu-id="af67c-233">由于 Azure 不支持共享磁盘，因此需使用 SIOS Datakeeper 来复制附加到群集节点的独立磁盘的内容，并将驱动器抽象化为群集管理器的群集共享卷。</span><span class="sxs-lookup"><span data-stu-id="af67c-233">Since shared disks are not possible on Azure, SIOS Datakeeper is used to replicate the content of independent disks attached to the cluster nodes and to abstract the drives as a cluster shared volume for the cluster manager.</span></span> <span data-ttu-id="af67c-234">有关实施方式的详细信息，请参阅[在 Azure 上组建 SAP ASCS 群集](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/)。</span><span class="sxs-lookup"><span data-stu-id="af67c-234">For implementation details, see [Clustering SAP ASCS on Azure](https://blogs.msdn.microsoft.com/saponsqlserver/2015/05/20/clustering-sap-ascs-instance-using-windows-server-failover-cluster-on-microsoft-azure-with-sios-datakeeper-and-azure-internal-load-balancer/).</span></span>

<span data-ttu-id="af67c-235">另一种做法是使用[横向扩展文件服务器](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS) 提供的文件共享。</span><span class="sxs-lookup"><span data-stu-id="af67c-235">Another option is to use a file share served up by the [Scale Out Fileserver](https://blogs.msdn.microsoft.com/saponsqlserver/2017/11/14/file-server-with-sofs-and-s2d-as-an-alternative-to-cluster-shared-disk-for-clustering-of-an-sap-ascs-instance-in-azure-is-generally-available/) (SOFS).</span></span> <span data-ttu-id="af67c-236">SOFS 提供弹性文件共享，可将其用作 Windows 群集的群集共享卷。</span><span class="sxs-lookup"><span data-stu-id="af67c-236">SOFS offers resilient file shares you can use as a cluster shared volume for the Windows cluster.</span></span> <span data-ttu-id="af67c-237">可在多个 Central Services 节点之间共享 SOFS 群集。</span><span class="sxs-lookup"><span data-stu-id="af67c-237">A SOFS cluster can be shared among multiple Central Services nodes.</span></span> <span data-ttu-id="af67c-238">截至本文编写之时，SOFS 仅适用于高可用性设计，因为 SOFS 群集不会跨区域扩展来提供灾难恢复支持。</span><span class="sxs-lookup"><span data-stu-id="af67c-238">As of this writing, SOFS is used only for high availability design, because the SOFS cluster does not extend across regions to provide disaster recovery support.</span></span>

<span data-ttu-id="af67c-239">SAP 应用程序服务器的高可用性是通过对应用程序服务器池中的流量进行负载均衡来实现的。</span><span class="sxs-lookup"><span data-stu-id="af67c-239">High availability for the SAP application servers is achieved by load balancing traffic within a pool of application servers.</span></span>
<span data-ttu-id="af67c-240">请参阅[在 Microsoft Azure 上运行的 SAP 认证和配置](/azure/virtual-machines/workloads/sap/sap-certifications)。</span><span class="sxs-lookup"><span data-stu-id="af67c-240">See [SAP certifications and configurations running on Microsoft Azure](/azure/virtual-machines/workloads/sap/sap-certifications).</span></span>

### <a name="database-tier"></a><span data-ttu-id="af67c-241">数据库层</span><span class="sxs-lookup"><span data-stu-id="af67c-241">Database tier</span></span>

<span data-ttu-id="af67c-242">此参考体系结构假设源数据库在 AnyDB（即，SQL Server、SAP ASE、IBM DB2 或 Oracle 等 DBMS）上运行。</span><span class="sxs-lookup"><span data-stu-id="af67c-242">This reference architecture assumes the source database is running on AnyDB—that is, a DBMS such as SQL Server, SAP ASE, IBM DB2, or Oracle.</span></span> <span data-ttu-id="af67c-243">数据库层的本机复制功能在复制的节点之间提供手动或自动故障转移。</span><span class="sxs-lookup"><span data-stu-id="af67c-243">The database tier's native replication feature provides either manual or automatic failover between replicated nodes.</span></span>

<span data-ttu-id="af67c-244">有关特定数据库系统的实施方法详细信息，请参阅[适用于 SAP NetWeaver 的 Azure 虚拟机 DBMS 部署](/azure/virtual-machines/workloads/sap/dbms-guide)。</span><span class="sxs-lookup"><span data-stu-id="af67c-244">For implementation details about specific database systems, see [Azure Virtual Machines DBMS deployment for SAP NetWeaver](/azure/virtual-machines/workloads/sap/dbms-guide).</span></span>

## <a name="disaster-recovery-considerations"></a><span data-ttu-id="af67c-245">灾难恢复注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-245">Disaster recovery considerations</span></span>

<span data-ttu-id="af67c-246">对于灾难恢复 (DR)，必须能够故障转移到次要区域。</span><span class="sxs-lookup"><span data-stu-id="af67c-246">For disaster recovery (DR), you must be able to fail over to a secondary region.</span></span> <span data-ttu-id="af67c-247">每个层使用不同的策略提供灾难恢复 (DR) 保护。</span><span class="sxs-lookup"><span data-stu-id="af67c-247">Each tier uses a different strategy to provide disaster recovery (DR) protection.</span></span>

- <span data-ttu-id="af67c-248">**应用程序服务器层**。</span><span class="sxs-lookup"><span data-stu-id="af67c-248">**Application servers tier**.</span></span> <span data-ttu-id="af67c-249">SAP 应用程序服务器不包含业务数据。</span><span class="sxs-lookup"><span data-stu-id="af67c-249">SAP application servers do not contain business data.</span></span> <span data-ttu-id="af67c-250">在 Azure 上，简单的 DR 策略是在次要区域中创建 SAP 应用程序服务器，然后关闭这些服务器。</span><span class="sxs-lookup"><span data-stu-id="af67c-250">On Azure, a simple DR strategy is to create SAP application servers in the secondary region, then shut them down.</span></span> <span data-ttu-id="af67c-251">在主要应用程序服务器上进行任何配置更改或内核更新后，必须将相同的更改复制到次要区域中的虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-251">Upon any configuration changes or kernel updates on the primary application server, the same changes must be copied to the virtual machines in the secondary region.</span></span> <span data-ttu-id="af67c-252">例如，将内核可执行文件复制到 DR 虚拟机。</span><span class="sxs-lookup"><span data-stu-id="af67c-252">For example, the kernel executables copied to the DR virtual machines.</span></span> <span data-ttu-id="af67c-253">要将应用程序服务器自动复制到次要区域，建议使用 [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) 解决方案。</span><span class="sxs-lookup"><span data-stu-id="af67c-253">For automatic replication of application servers to a secondary region, [Azure Site Recovery](/azure/site-recovery/site-recovery-overview) is the recommended solution.</span></span>

- <span data-ttu-id="af67c-254">**Central Services**。</span><span class="sxs-lookup"><span data-stu-id="af67c-254">**Central Services**.</span></span> <span data-ttu-id="af67c-255">SAP 应用程序堆栈的此组件也不会保存业务数据。</span><span class="sxs-lookup"><span data-stu-id="af67c-255">This component of the SAP application stack also does not persist business data.</span></span> <span data-ttu-id="af67c-256">可以在灾难恢复区域中构建一个 VM 来运行 Central Services 角色。</span><span class="sxs-lookup"><span data-stu-id="af67c-256">You can build a VM in the disaster recovery region to run the Central Services role.</span></span> <span data-ttu-id="af67c-257">在主要 Central Services 节点中，要同步的唯一内容是 /sapmnt 共享内容。</span><span class="sxs-lookup"><span data-stu-id="af67c-257">The only content from the primary Central Services node to synchronize is the /sapmnt share content.</span></span> <span data-ttu-id="af67c-258">此外，如果主要 Central Services 服务器上发生配置更改或内核更新，必须在灾难恢复区域中运行 Central Services 的 VM 上重复这些操作。</span><span class="sxs-lookup"><span data-stu-id="af67c-258">Also, if configuration changes or kernel updates take place on the primary Central Services servers, they must be repeated on the VM in the disaster recovery region running Central Services.</span></span> <span data-ttu-id="af67c-259">若要同步两个服务器，可以使用 Azure Site Recovery 复制群集节点，或只需使用定期计划的复制作业将 /sapmnt 复制到灾难恢复区域。</span><span class="sxs-lookup"><span data-stu-id="af67c-259">To synchronize the two servers, you can use either Azure Site Recovery to replicate the cluster nodes or simply use a regularly scheduled copy job to copy /sapmnt to the disaster recovery region.</span></span> <span data-ttu-id="af67c-260">有关此简单复制方法的生成、复制和测试故障转移过程的详细信息，请下载 [SAP NetWeaver：生成基于 Hyper-V 和 Microsoft Azure 的灾难恢复解决方案](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx)，并参阅“4.3.</span><span class="sxs-lookup"><span data-stu-id="af67c-260">For details about this simple replication method's build, copy, and test failover process, download [SAP NetWeaver: Building a Hyper-V and Microsoft Azure–based Disaster Recovery Solution](https://download.microsoft.com/download/9/5/6/956FEDC3-702D-4EFB-A7D3-2DB7505566B6/SAP%20NetWeaver%20-%20Building%20an%20Azure%20based%20Disaster%20Recovery%20Solution%20V1_5%20.docx), and refer to "4.3.</span></span> <span data-ttu-id="af67c-261">SAP SPOF 层 (ASCS)”。</span><span class="sxs-lookup"><span data-stu-id="af67c-261">SAP SPOF layer (ASCS)."</span></span>

- <span data-ttu-id="af67c-262">**数据库层**。</span><span class="sxs-lookup"><span data-stu-id="af67c-262">**Database tier**.</span></span> <span data-ttu-id="af67c-263">最好是使用数据库本身的集成复制技术来实现 DR。</span><span class="sxs-lookup"><span data-stu-id="af67c-263">DR is best implemented with the database's own integrated replication technology.</span></span> <span data-ttu-id="af67c-264">例如，对于 SQL Server，我们建议使用 AlwaysOn 可用性组在远程区域中建立副本，并通过手动故障转移以异步方式复制事务。</span><span class="sxs-lookup"><span data-stu-id="af67c-264">In the case of SQL Server, for example, we recommend using AlwaysOn Availability Group to establish a replica in a remote region, replicating transactions asynchronously with manual failover.</span></span> <span data-ttu-id="af67c-265">异步复制可避免影响到主站点中交互式工作负荷的性能。</span><span class="sxs-lookup"><span data-stu-id="af67c-265">Asynchronous replication avoids an impact to the performance of interactive workloads at the primary site.</span></span> <span data-ttu-id="af67c-266">用户可以借助手动故障转移来评估 DR 影响，并确定是否适合从 DR 站点操作。</span><span class="sxs-lookup"><span data-stu-id="af67c-266">Manual failover offers the opportunity for a person to evaluate the DR impact and decide if operating from the DR site is justified.</span></span>

<span data-ttu-id="af67c-267">若要使用 Azure Site Recovery 自动构建出原始站点的完整复制生产站点，必须运行自定义的[部署脚本](/azure/site-recovery/site-recovery-runbook-automation)。</span><span class="sxs-lookup"><span data-stu-id="af67c-267">To use Azure Site Recovery to automatically build out a fully replicated production site of your original, you must run customized [deployment scripts](/azure/site-recovery/site-recovery-runbook-automation).</span></span> <span data-ttu-id="af67c-268">Site Recovery 首先在可用性集中部署 VM，然后运行脚本来添加负载均衡器等资源。</span><span class="sxs-lookup"><span data-stu-id="af67c-268">Site Recovery first deploys the VMs in availability sets, then runs scripts to add resources such as load balancers.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="af67c-269">可管理性注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-269">Manageability considerations</span></span>

<span data-ttu-id="af67c-270">Azure 提供多种功能用于[监视和诊断](/azure/architecture/best-practices/monitoring)整个基础结构。</span><span class="sxs-lookup"><span data-stu-id="af67c-270">Azure provides several functions for [monitoring and diagnostics](/azure/architecture/best-practices/monitoring) of the overall infrastructure.</span></span> <span data-ttu-id="af67c-271">此外，Azure Operations Management Suite (OMS) 可处理 Azure 虚拟机的增强型监视。</span><span class="sxs-lookup"><span data-stu-id="af67c-271">Also, enhanced monitoring of Azure virtual machines is handled by Azure Operations Management Suite (OMS).</span></span>

<span data-ttu-id="af67c-272">若要针对 SAP 基础结构的资源和服务性能提供基于 SAP 的监视，可使用 [Azure SAP 增强型监视](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment)扩展。</span><span class="sxs-lookup"><span data-stu-id="af67c-272">To provide SAP-based monitoring of resources and service performance of the SAP infrastructure, the [Azure SAP Enhanced Monitoring](/azure/virtual-machines/workloads/sap/deployment-guide#detailed-tasks-for-sap-software-deployment) extension is used.</span></span> <span data-ttu-id="af67c-273">此扩展会将 Azure 监视统计信息馈送到 SAP 应用程序，以执行操作系统监视和 DBA Cockpit 功能。</span><span class="sxs-lookup"><span data-stu-id="af67c-273">This extension feeds Azure monitoring statistics into the SAP application for operating system monitoring and DBA Cockpit functions.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="af67c-274">安全注意事项</span><span class="sxs-lookup"><span data-stu-id="af67c-274">Security considerations</span></span>

<span data-ttu-id="af67c-275">SAP 具有自身的用户管理引擎 (UME)，可在 SAP 应用程序中控制基于角色的访问和授权。</span><span class="sxs-lookup"><span data-stu-id="af67c-275">SAP has its own Users Management Engine (UME) to control role-based access and authorization within the SAP application.</span></span> <span data-ttu-id="af67c-276">有关详细信息，请参阅[适用于 ABAP 的 SAP NetWeaver 应用程序服务器安全指南](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19)和 [SAP NetWeaver 应用程序服务器 Java 安全指南](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm)。</span><span class="sxs-lookup"><span data-stu-id="af67c-276">For details, see [SAP NetWeaver Application Server for ABAP Security Guide](https://help.sap.com/viewer/864321b9b3dd487d94c70f6a007b0397/7.4.19) and [SAP NetWeaver Application Server Java Security Guide](https://help.sap.com/doc/saphelp_snc_uiaddon_10/1.0/en-US/57/d8bfcf38f66f48b95ce1f52b3f5184/frameset.htm).</span></span>

<span data-ttu-id="af67c-277">在其他网络安全性方面，请考虑实施[外围网络](../dmz/secure-vnet-hybrid.md)。外围网络使用网络虚拟设备在 Web 调度程序子网的前面创建防火墙。</span><span class="sxs-lookup"><span data-stu-id="af67c-277">For additional network security, consider implementing a [network DMZ](../dmz/secure-vnet-hybrid.md), which uses a network virtual appliance to create a firewall in front of the subnet for Web Dispatcher.</span></span>

<span data-ttu-id="af67c-278">在基础结构安全性方面，传输中数据和静态数据会加密。</span><span class="sxs-lookup"><span data-stu-id="af67c-278">For infrastructure security, data is encrypted in transit and at rest.</span></span> <span data-ttu-id="af67c-279">可参考 [Azure 虚拟机 (VM) 上的 SAP NetWeaver - 规划和实施指南](/azure/virtual-machines/workloads/sap/planning-guide)的“安全注意事项”部分解决网络安全问题。</span><span class="sxs-lookup"><span data-stu-id="af67c-279">The "Security considerations” section of the [SAP NetWeaver on Azure Virtual Machines (VMs) – Planning and Implementation Guide](/azure/virtual-machines/workloads/sap/planning-guide) begins to address network security.</span></span> <span data-ttu-id="af67c-280">该指南还指定了为使应用程序能够通信，而必须在防火墙中打开的网络端口。</span><span class="sxs-lookup"><span data-stu-id="af67c-280">The guide also specifies the network ports you must open on the firewalls to allow application communication.</span></span>

<span data-ttu-id="af67c-281">若要加密 Windows 虚拟机磁盘，可以使用 [Azure 磁盘加密](/azure/security/azure-security-disk-encryption)。</span><span class="sxs-lookup"><span data-stu-id="af67c-281">To encrypt Windows virtual machine disks, you can use [Azure Disk Encryption](/azure/security/azure-security-disk-encryption).</span></span> <span data-ttu-id="af67c-282">磁盘加密使用 Windows 的 BitLocker 功能，为操作系统和数据磁盘提供卷加密。</span><span class="sxs-lookup"><span data-stu-id="af67c-282">It uses the BitLocker feature of Windows to provide volume encryption for the operating system and the data disks.</span></span> <span data-ttu-id="af67c-283">该解决方案还可与 Azure Key Vault 配合工作，帮助管理 Key Vault 订阅中的磁盘加密密钥和机密。</span><span class="sxs-lookup"><span data-stu-id="af67c-283">The solution also works with Azure Key Vault to help you control and manage the disk-encryption keys and secrets in your key vault subscription.</span></span> <span data-ttu-id="af67c-284">虚拟机磁盘上的数据将在 Azure 存储中静态加密。</span><span class="sxs-lookup"><span data-stu-id="af67c-284">Data on the virtual machine disks are encrypted at rest in your Azure storage.</span></span>

## <a name="communities"></a><span data-ttu-id="af67c-285">社区</span><span class="sxs-lookup"><span data-stu-id="af67c-285">Communities</span></span>

<span data-ttu-id="af67c-286">社区可以解答问题，并帮助设置成功的部署。</span><span class="sxs-lookup"><span data-stu-id="af67c-286">Communities can answer questions and help you set up a successful deployment.</span></span> <span data-ttu-id="af67c-287">请注意以下几点：</span><span class="sxs-lookup"><span data-stu-id="af67c-287">Consider the following:</span></span>

- [<span data-ttu-id="af67c-288">在 Microsoft 平台上运行 SAP 应用程序（博客）</span><span class="sxs-lookup"><span data-stu-id="af67c-288">Running SAP Applications on the Microsoft Platform Blog</span></span>](https://blogs.msdn.microsoft.com/saponsqlserver/2017/05/04/sap-on-azure-general-update-for-customers-partners-april-2017/)
- [<span data-ttu-id="af67c-289">Azure 社区支持</span><span class="sxs-lookup"><span data-stu-id="af67c-289">Azure Community Support</span></span>](https://azure.microsoft.com/support/community/)
- [<span data-ttu-id="af67c-290">SAP 社区</span><span class="sxs-lookup"><span data-stu-id="af67c-290">SAP Community</span></span>](https://www.sap.com/community.html)
- [<span data-ttu-id="af67c-291">Stack Overflow</span><span class="sxs-lookup"><span data-stu-id="af67c-291">Stack Overflow</span></span>](https://stackoverflow.com/tags/sap/)

## <a name="related-resources"></a><span data-ttu-id="af67c-292">相关资源</span><span class="sxs-lookup"><span data-stu-id="af67c-292">Related resources</span></span>

<span data-ttu-id="af67c-293">可以查看以下 [Azure 示例方案](/azure/architecture/example-scenario)，了解使用部分相同技术的具体解决方案：</span><span class="sxs-lookup"><span data-stu-id="af67c-293">You may wish to review the following [Azure example scenarios](/azure/architecture/example-scenario) that demonstrate specific solutions using some of the same technologies:</span></span>

- [<span data-ttu-id="af67c-294">在 Azure 上使用 Oracle 数据库运行 SAP 生产工作负荷</span><span class="sxs-lookup"><span data-stu-id="af67c-294">Running SAP production workloads using an Oracle Database on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-production)
- [<span data-ttu-id="af67c-295">Azure 上的 SAP 工作负荷的开发/测试环境</span><span class="sxs-lookup"><span data-stu-id="af67c-295">Dev/test environments for SAP workloads on Azure</span></span>](/azure/architecture/example-scenario/apps/sap-dev-test)

<!-- links -->

[visio-download]: https://archcenter.blob.core.windows.net/cdn/sap-reference-architectures.vsdx
