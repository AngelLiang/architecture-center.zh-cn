---
title: 复原能力查检表
titleSuffix: Azure Design Review Framework
description: 为设计过程中的复原能力考虑因素提供指导的查检表。
author: petertaylor9999
ms.date: 11/26/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: 1201e2045c6a5f7be9c8286cd192559a8d66d169
ms.sourcegitcommit: 4ba3304eebaa8c493c3e5307bdd9d723cd90b655
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/12/2018
ms.locfileid: "53307446"
---
# <a name="resiliency-checklist"></a><span data-ttu-id="ab6c1-103">复原能力查检表</span><span class="sxs-lookup"><span data-stu-id="ab6c1-103">Resiliency checklist</span></span>

<span data-ttu-id="ab6c1-104">复原能力是指系统能够在发生故障后进行恢复，然后继续正常运行，它是[软件质量的构成要素](../guide/pillars.md)之一。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="ab6c1-105">根据复原能力设计应用程序需要规划和缓解可能发生的各种故障模式。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-105">Designing your application for resiliency requires planning for and mitigating a variety of failure modes that could occur.</span></span> <span data-ttu-id="ab6c1-106">核对此清单可以从复原能力的角度审查应用程序的架构。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-106">Use this checklist to review your application architecture from a resiliency standpoint.</span></span> <span data-ttu-id="ab6c1-107">另请查看[特定 Azure 服务的复原能力检查表](./resiliency-per-service.md)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-107">Also review the [Resiliency checklist for specific Azure services](./resiliency-per-service.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="ab6c1-108">要求</span><span class="sxs-lookup"><span data-stu-id="ab6c1-108">Requirements</span></span>

<span data-ttu-id="ab6c1-109">**定义客户的可用性要求。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-109">**Define your customer's availability requirements.**</span></span> <span data-ttu-id="ab6c1-110">客户对应用程序的组件有可用性要求，这会影响应用程序设计。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-110">Your customer will have availability requirements for the components in your application and this will affect your application's design.</span></span> <span data-ttu-id="ab6c1-111">让客户认可应用程序每个组成部分的可用性目标，否则设计可能不符合客户期望。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-111">Get agreement from your customer for the availability targets of each piece of your application, otherwise your design may not meet the customer's expectations.</span></span> <span data-ttu-id="ab6c1-112">有关详细信息，请参阅[设计适用于 Azure 的可复原应用程序](../resiliency/index.md)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-112">For more information, see [Designing resilient applications for Azure](../resiliency/index.md).</span></span>

## <a name="application-design"></a><span data-ttu-id="ab6c1-113">应用程序设计</span><span class="sxs-lookup"><span data-stu-id="ab6c1-113">Application Design</span></span>

<span data-ttu-id="ab6c1-114">**对应用程序执行故障模式分析 (FMA)。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-114">**Perform a failure mode analysis (FMA) for your application.**</span></span> <span data-ttu-id="ab6c1-115">FMA 是在设计阶段提前将复原能力整合到应用程序的过程。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-115">FMA is a process for building resiliency into an application early in the design stage.</span></span> <span data-ttu-id="ab6c1-116">有关详细信息，请参阅[故障模式分析][fma]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-116">For more information, see [Failure mode analysis][fma].</span></span> <span data-ttu-id="ab6c1-117">FMA 的目标包括：</span><span class="sxs-lookup"><span data-stu-id="ab6c1-117">The goals of an FMA include:</span></span>  

- <span data-ttu-id="ab6c1-118">识别应用程序可能遇到的故障类型。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-118">Identify what types of failures an application might experience.</span></span>
- <span data-ttu-id="ab6c1-119">捕获每种故障对应用程序造成的潜在影响。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-119">Capture the potential effects and impact of each type of failure on the application.</span></span>
- <span data-ttu-id="ab6c1-120">确定恢复策略。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-120">Identify recovery strategies.</span></span>
  
<span data-ttu-id="ab6c1-121">**部署服务的多个实例。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-121">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="ab6c1-122">如果应用程序依赖于服务的单个实例，则会造成单一故障点。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-122">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="ab6c1-123">预配多个实例能够提高复原能力和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-123">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="ab6c1-124">对于 [Azure 应用服务](/azure/app-service/app-service-value-prop-what-is/)，请选择提供多个实例的[应用服务计划](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-124">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="ab6c1-125">对于 Azure 云服务，请将每个角色配置为使用[多个实例](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-125">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="ab6c1-126">对于 [Azure 虚拟机 (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)，请确保 VM 体系结构包含多个 VM，并且每个 VM 包含在[可用性集][availability-sets]中。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-126">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>

<span data-ttu-id="ab6c1-127">**使用自动缩放来响应负载增加。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-127">**Use autoscaling to respond to increases in load.**</span></span> <span data-ttu-id="ab6c1-128">如果应用程序未配置为随着负载的增加而自动横向扩展，如果用户的请求饱和，那么应用程序的服务可能会失败。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-128">If your application is not configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="ab6c1-129">有关详细信息，请参阅以下文章：</span><span class="sxs-lookup"><span data-stu-id="ab6c1-129">For more details, see the following:</span></span>

- <span data-ttu-id="ab6c1-130">常规：[伸缩性清单](./scalability.md)</span><span class="sxs-lookup"><span data-stu-id="ab6c1-130">General: [Scalability checklist](./scalability.md)</span></span>
- <span data-ttu-id="ab6c1-131">Azure 应用服务：[手动或自动缩放实例计数][app-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ab6c1-131">Azure App Service: [Scale instance count manually or automatically][app-service-autoscale]</span></span>
- <span data-ttu-id="ab6c1-132">云服务：[如何自动缩放云服务][cloud-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ab6c1-132">Cloud Services: [How to auto scale a cloud service][cloud-service-autoscale]</span></span>
- <span data-ttu-id="ab6c1-133">虚拟机：[自动缩放和虚拟机规模集][vmss-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ab6c1-133">Virtual Machines: [Automatic scaling and virtual machine scale sets][vmss-autoscale]</span></span>

<span data-ttu-id="ab6c1-134">**使用负载均衡来分发请求。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-134">**Use load balancing to distribute requests.**</span></span> <span data-ttu-id="ab6c1-135">负载均衡通过从循环列表中删除不正常的实例，将应用程序请求分发到正常的服务实例。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-135">Load balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="ab6c1-136">如果服务使用 Azure 应用服务或 Azure 云服务，则已负载均衡。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-136">If your service uses Azure App Service or Azure Cloud Services, it is already load balanced for you.</span></span> <span data-ttu-id="ab6c1-137">但是，如果应用程序使用 Azure VM，则你需要预配负载均衡器。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-137">However, if your application uses Azure VMs, you will need to provision a load balancer.</span></span> <span data-ttu-id="ab6c1-138">有关更多详细信息，请参阅 [Azure 负载均衡器](/azure/load-balancer/load-balancer-overview/)概述。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-138">See the [Azure Load Balancer](/azure/load-balancer/load-balancer-overview/) overview for more details.</span></span>

<span data-ttu-id="ab6c1-139">**将 Azure 应用程序网关配置为使用多个实例。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-139">**Configure Azure Application Gateways to use multiple instances.**</span></span> <span data-ttu-id="ab6c1-140">根据应用程序的要求，[Azure 应用程序网关](/azure/application-gateway/application-gateway-introduction/)可能更适合用于将请求分发到应用程序的服务。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-140">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="ab6c1-141">但是，应用程序网关服务的单个实例不享有 SLA 保障，因此，洱应用程序网关实例发生故障时，应用程序也可能发生故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-141">However, single instances of the Application Gateway service are not guaranteed by an SLA so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="ab6c1-142">预配多个中型或大型应用程序网关实例，保证根据 [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/) 的条款提供服务可用性。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-142">Provision more than one medium or larger Application Gateway instance to guarantee availability of the service under the terms of the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/).</span></span>

<span data-ttu-id="ab6c1-143">**为每个应用层使用 Azure 可用性集。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-143">**Use Availability Sets for each application tier.**</span></span> <span data-ttu-id="ab6c1-144">将实例放入[可用性集][availability-sets]可提供更高的 [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-144">Placing your instances in an [availability set][availability-sets] provides a higher [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span>

<span data-ttu-id="ab6c1-145">**使用 Azure Site Recovery 复制 VM。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-145">**Replicate VMs using Azure Site Recovery.**</span></span> <span data-ttu-id="ab6c1-146">使用 [Site Recovery][site-recovery] 复制 Azure VM 时，所有 VM 磁盘将以异步方式持续复制到目标区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-146">When you replicate Azure VMs using [Site Recovery][site-recovery], all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="ab6c1-147">每隔几分钟就会创建恢复点。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-147">The recovery points are created every few minutes.</span></span> <span data-ttu-id="ab6c1-148">这可以实现分钟量级的恢复点目标 (RPO)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-148">This gives you a Recovery Point Objective (RPO) in the order of minutes.</span></span>

<span data-ttu-id="ab6c1-149">**考虑跨多个区域部署应用程序。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-149">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="ab6c1-150">如果将应用程序部署到单个区域，在发生整个区域不可用的情况时（这种情况很罕见），应用程序也不可用。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-150">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="ab6c1-151">根据应用程序的 SLA 条款，这种情况可能不可接受。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-151">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="ab6c1-152">为此，请考虑跨多个区域部署应用程序及其服务。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-152">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="ab6c1-153">多区域部署可以使用主动-主动模式（将请求分发到多个活动实例）或主动-被动模式（预留一个“热”实例，以防主实例发生故障）。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-153">A multi-region deployment can use an active-active pattern (distributing requests across multiple active instances) or an active-passive pattern (keeping a "warm" instance in reserve, in case the primary instance fails).</span></span> <span data-ttu-id="ab6c1-154">我们建议跨区域对部署应用程序服务的多个实例。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-154">We recommend that you deploy multiple instances of your application's services across regional pairs.</span></span> <span data-ttu-id="ab6c1-155">有关详细信息，请参阅[业务连续性和灾难恢复 (BCDR)：Azure 配对区域](/azure/best-practices-availability-paired-regions)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-155">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

<span data-ttu-id="ab6c1-156">**使用 Azure 流量管理器将应用程序的流量路由到不同的区域。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-156">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span>  <span data-ttu-id="ab6c1-157">[Azure 流量管理器][traffic-manager]在 DNS 级别执行负载均衡，根据指定的[流量路由][traffic-manager-routing]方法和应用程序终结点的运行状况将流量路由到不同区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-157">[Azure Traffic Manager][traffic-manager] performs load balancing at the DNS level and will route traffic to different regions based on the [traffic routing][traffic-manager-routing] method you specify and the health of your application's endpoints.</span></span> <span data-ttu-id="ab6c1-158">如果不使用流量管理器，则受限于部署的单个区域，从而会限制规模，增大用户的延迟，并导致应用程序在发生区域范围的服务中断时停机。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-158">Without Traffic Manager, you are limited to a single region for your deployment, which limits scale, increases latency for some users, and causes application downtime in the case of a region-wide service disruption.</span></span>

<span data-ttu-id="ab6c1-159">**为负载均衡器和流量管理器配置并测试运行状况探测。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-159">**Configure and test health probes for your load balancers and traffic managers.**</span></span> <span data-ttu-id="ab6c1-160">确保运行状况逻辑检查系统关键部件，并相应地对运行状况探测做出响应。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-160">Ensure that your health logic checks the critical parts of the system and responds appropriately to health probes.</span></span>

- <span data-ttu-id="ab6c1-161">[Azure 流量管理器][traffic-manager]和 [Azure 负载均衡器][load-balancer]的运行状况探测充当特定的功能。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-161">The health probes for [Azure Traffic Manager][traffic-manager] and [Azure Load Balancer][load-balancer] serve a specific function.</span></span> <span data-ttu-id="ab6c1-162">对于流量管理器，运行状况探测确定是否故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-162">For Traffic Manager, the health probe determines whether to fail over to another region.</span></span> <span data-ttu-id="ab6c1-163">对于负载均衡器，它确定是否从轮转项目中删除某个 VM。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-163">For a load balancer, it determines whether to remove a VM from rotation.</span></span>

- <span data-ttu-id="ab6c1-164">对于流量管理器探测，运行状况终结点应检查所有关键依赖项，它们部署在同一区域，其故障应触发故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-164">For a Traffic Manager probe, your health endpoint should check any critical dependencies that are deployed within the same region, and whose failure should trigger a failover to another region.</span></span>

- <span data-ttu-id="ab6c1-165">对于负载均衡器，运行状况终结点应报告 VM 的运行状况。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-165">For a load balancer, the health endpoint should report the health of the VM.</span></span> <span data-ttu-id="ab6c1-166">不要包含其他层或外部服务。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-166">Don't include other tiers or external services.</span></span> <span data-ttu-id="ab6c1-167">否则，在 VM 外部发生的故障会导致负载均衡器从轮转项目中删除该 VM。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-167">Otherwise, a failure that occurs outside the VM will cause the load balancer to remove the VM from rotation.</span></span>

- <span data-ttu-id="ab6c1-168">有关在应用程序中实施运行状况监视的指导，请参阅[运行状况终结点监视模式](../patterns/health-endpoint-monitoring.md)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-168">For guidance on implementing health monitoring in your application, see [Health Endpoint Monitoring pattern](../patterns/health-endpoint-monitoring.md).</span></span>

<span data-ttu-id="ab6c1-169">**监视第三方服务。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-169">**Monitor third-party services.**</span></span> <span data-ttu-id="ab6c1-170">如果应用程序依赖于第三方服务，请确定这些第三方服务可能会在哪个位置出现何种故障，以及这些故障对应用程序造成的影响。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-170">If your application has dependencies on third-party services, identify where and how these third-party services can fail and what effect those failures will have on your application.</span></span> <span data-ttu-id="ab6c1-171">第三方服务可能不包括监视和诊断，因此，必须记录其调用，并使用唯一标识符将其与应用程序的运行状况和诊断日志记录相关联。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-171">A third-party service may not include monitoring and diagnostics, so it's important to log your invocations of them and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span> <span data-ttu-id="ab6c1-172">有关监视和诊断的成熟做法的详细信息，请参阅[监视和诊断指南][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-172">For more information on proven practices for monitoring and diagnostics, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ab6c1-173">**确保使用的任何第三方服务提供 SLA。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-173">**Ensure that any third-party service you consume provides an SLA.**</span></span> <span data-ttu-id="ab6c1-174">如果应用程序依赖于某个第三方服务，但该服务不以 SLA 的形式保证可用性，则也无法保证应用程序的可用性。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-174">If your application depends on a third-party service, but the third party provides no guarantee of availability in the form of an SLA, your application's availability also cannot be guaranteed.</span></span> <span data-ttu-id="ab6c1-175">SLA 只与应用程序的最低可用性组件一样高。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-175">Your SLA is only as good as the least available component of your application.</span></span>

<span data-ttu-id="ab6c1-176">**在适用的情况下，请实施复原模式以进行远程操作。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-176">**Implement resiliency patterns for remote operations where appropriate.**</span></span> <span data-ttu-id="ab6c1-177">如果应用程序依赖于远程服务之间的通信，请遵循处理暂时性故障的[设计模式](../patterns/category/resiliency.md)，例如[重试模式](../patterns/retry.md)和[断路器模式](../patterns/circuit-breaker.md)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-177">If your application depends on communication between remote services, follow [design patterns](../patterns/category/resiliency.md) for dealing with transient failures, such as the [Retry pattern](../patterns/retry.md) and the [Circuit Breaker pattern](../patterns/circuit-breaker.md).</span></span>

<span data-ttu-id="ab6c1-178">**尽量执行异步操作。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-178">**Implement asynchronous operations whenever possible.**</span></span> <span data-ttu-id="ab6c1-179">同步操作可能会独占资源，并在调用方等待进程完成时阻塞其他操作。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-179">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="ab6c1-180">设计应用程序的每个组成部分，以尽量执行异步操作。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-180">Design each part of your application to allow for asynchronous operations whenever possible.</span></span> <span data-ttu-id="ab6c1-181">有关如何在 C# 中实现异步编程的详细信息，请参阅[使用 async 和 await 进行异步编程][asynchronous-c-sharp]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-181">For more information on how to implement asynchronous programming in C#, see [Asynchronous Programming with async and await][asynchronous-c-sharp].</span></span>

## <a name="data-management"></a><span data-ttu-id="ab6c1-182">数据管理</span><span class="sxs-lookup"><span data-stu-id="ab6c1-182">Data management</span></span>

<span data-ttu-id="ab6c1-183">**了解应用程序数据源的复制方法。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-183">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="ab6c1-184">应用程序数据将存储在不同的数据源中，因此具有不同的可用性要求。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-184">Your application data will be stored in different data sources and have different availability requirements.</span></span> <span data-ttu-id="ab6c1-185">评估 Azure 中每种数据存储的复制方法，包括 [Azure 存储复制](/azure/storage/storage-redundancy/)和 [SQL 数据库活动异地复制](/azure/sql-database/sql-database-geo-replication-overview/)，确保满足应用程序的数据要求。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-185">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage Replication](/azure/storage/storage-redundancy/) and [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span> <span data-ttu-id="ab6c1-186">如果使用 [Site Recovery][site-recovery] 复制 Azure VM，则所有 VM 磁盘将以异步方式持续复制到目标区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-186">If you replicate Azure VMs using [Site Recovery][site-recovery], all the VM disks are continuously replicated to the target region asynchronously.</span></span> <span data-ttu-id="ab6c1-187">每隔几分钟就会创建恢复点。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-187">The recovery points are created every few minutes.</span></span>

<span data-ttu-id="ab6c1-188">**确保没有任何用户帐户同时有权访问生产和备份数据。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-188">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="ab6c1-189">如果单个用户帐户同时有权写入生产和备份源，则将会透露数据备份。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-189">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="ab6c1-190">恶意用户可能有意删除所有数据，而普通用户可能意外删除数据。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-190">A malicious user could purposely delete all your data, while a regular user could accidentally delete it.</span></span> <span data-ttu-id="ab6c1-191">将应用程序设计为限制每个用户帐户的权限，以便只有需要写访问权限的用户拥有写访问权限，并且只能写入生产或备份数据，但不能同时写入两者。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-191">Design your application to limit the permissions of each user account so that only the users that require write access have write access and it's only to either production or backup, but not both.</span></span>

<span data-ttu-id="ab6c1-192">**阐述并测试数据源故障转移和故障恢复过程。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-192">**Document your data source fail over and fail back process and test it.**</span></span> <span data-ttu-id="ab6c1-193">当数据源发生灾难性的故障时，人工操作员必须遵循一套阐述的说明故障转移到新数据源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-193">In the case where your data source fails catastrophically, a human operator will have to follow a set of documented instructions to fail over to a new data source.</span></span> <span data-ttu-id="ab6c1-194">如果阐述的步骤存在错误，操作员将无法成功遵循它们和故障转移资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-194">If the documented steps have errors, an operator will not be able to successfully follow them and fail over the resource.</span></span> <span data-ttu-id="ab6c1-195">定期测试说明步骤，以验证操作员是否能够遵循它们成功故障转移和故障恢复数据源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-195">Regularly test the instruction steps to verify that an operator following them is able to successfully fail over and fail back the data source.</span></span>

<span data-ttu-id="ab6c1-196">**验证数据备份。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-196">**Validate your data backups.**</span></span> <span data-ttu-id="ab6c1-197">定期通过运行脚本验证数据完整性、架构和查询，验证备份数据是否符合预期。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-197">Regularly verify that your backup data is what you expect by running a script to validate data integrity, schema, and queries.</span></span> <span data-ttu-id="ab6c1-198">如果某个备份对还原数据源没有任何帮助，则就没有必要保留该备份。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-198">There's no point having a backup if it's not useful to restore your data sources.</span></span> <span data-ttu-id="ab6c1-199">记录并报告任何不一致情况，以便能够修复备份服务。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-199">Log and report any inconsistencies so the backup service can be repaired.</span></span>

<span data-ttu-id="ab6c1-200">**考虑使用异地冗余的存储帐户类型。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-200">**Consider using a storage account type that is geo-redundant.**</span></span> <span data-ttu-id="ab6c1-201">Azure 存储帐户中存储的数据始终在本地复制。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-201">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="ab6c1-202">但是，在预配存储帐户时，有多个复制策略可供选择。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-202">However, there are multiple replication strategies to choose from when a Storage Account is provisioned.</span></span> <span data-ttu-id="ab6c1-203">选择 [Azure 读取访问异地冗余存储 (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) 可以在整个区域不可用时（这种情况很罕见）保护应用程序数据。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-203">Select [Azure Read-Access Geo Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) to protect your application data against the rare case when an entire region becomes unavailable.</span></span>

> [!NOTE]
> <span data-ttu-id="ab6c1-204">对于 VM，请不要依赖于 RA-GRS 复制来还原 VM 磁盘（VHD 文件），</span><span class="sxs-lookup"><span data-stu-id="ab6c1-204">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="ab6c1-205">而应该使用 [Azure 备份][azure-backup]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-205">Instead, use [Azure Backup][azure-backup].</span></span>

## <a name="security"></a><span data-ttu-id="ab6c1-206">“安全”</span><span class="sxs-lookup"><span data-stu-id="ab6c1-206">Security</span></span>

<span data-ttu-id="ab6c1-207">**针对分布式拒绝服务 (DDoS) 攻击实施应用程序级保护。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-207">**Implement application-level protection against distributed denial of service (DDoS) attacks.**</span></span> <span data-ttu-id="ab6c1-208">Azure 服务可在网络层防范 DDos 攻击。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-208">Azure services are protected against DDos attacks at the network layer.</span></span> <span data-ttu-id="ab6c1-209">但是，Azure 无法防范应用程序层攻击，因为很难将真实用户请求与恶意用户请求区分开来。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-209">However, Azure cannot protect against application-layer attacks, because it is difficult to distinguish between true user requests from malicious user requests.</span></span> <span data-ttu-id="ab6c1-210">有关如何防范应用程序层 DDoS 攻击的详细信息，请参阅 [Microsoft Azure 网络安全性](https://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf)中的“防范 DDoS”部分（PDF 下载）。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-210">For more information on how to protect against application-layer DDoS attacks, see the "Protecting against DDoS" section of [Microsoft Azure Network Security](https://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (PDF download).</span></span>

<span data-ttu-id="ab6c1-211">**对应用程序资源的访问权限实施最低特权原则。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-211">**Implement the principle of least privilege for access to the application's resources.**</span></span> <span data-ttu-id="ab6c1-212">尽量限制对应用程序资源的默认访问权限。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-212">The default for access to the application's resources should be as restrictive as possible.</span></span> <span data-ttu-id="ab6c1-213">只在经过批准后才授予更高级别的权限。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-213">Grant higher level permissions on an approval basis.</span></span> <span data-ttu-id="ab6c1-214">默认授予对应用程序资源的过高访问权限可能导致某人有意或无意删除资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-214">Granting overly permissive access to your application's resources by default can result in someone purposely or accidentally deleting resources.</span></span> <span data-ttu-id="ab6c1-215">Azure 提供[基于角色的访问控制](/azure/active-directory/role-based-access-built-in-roles/)用于管理用户特权，但必须验证具有自身权限系统（例如 SQL Server）的其他资源的最低特权。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-215">Azure provides [role-based access control](/azure/active-directory/role-based-access-built-in-roles/) to manage user privileges, but it's important to verify least privilege permissions for other resources that have their own permissions systems such as SQL Server.</span></span>

## <a name="testing"></a><span data-ttu-id="ab6c1-216">测试</span><span class="sxs-lookup"><span data-stu-id="ab6c1-216">Testing</span></span>

<span data-ttu-id="ab6c1-217">**对应用程序执行故障转移和故障恢复测试。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-217">**Perform failover and failback testing for your application.**</span></span> <span data-ttu-id="ab6c1-218">如果不全面测试故障转移和故障恢复，则无法确定在灾难恢复过程中，应用程序中的依赖服务以同步方式恢复正常运行。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-218">If you haven't fully tested failover and failback, you can't be certain that the dependent services in your application come back up in a synchronized manner during disaster recovery.</span></span> <span data-ttu-id="ab6c1-219">确保应用程序的依赖服务按正确的顺序故障转移和故障恢复。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-219">Ensure that your application's dependent services failover and fail back in the correct order.</span></span> <span data-ttu-id="ab6c1-220">如果使用 [Azure Site Recovery][site-recovery] 复制 VM，请定期通过执行测试故障转移来运行灾难恢复演练。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-220">If you are using [Azure Site Recovery][site-recovery] to replicate VMs, run disaster recovery drills periodically by doing a test failover.</span></span> <span data-ttu-id="ab6c1-221">有关详细信息，请参阅[运行灾难恢复到 Azure 的演练][site-recovery-test]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-221">For more information, see [Run a disaster recovery drill to Azure][site-recovery-test].</span></span>

<span data-ttu-id="ab6c1-222">**对应用程序执行故障注入测试。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-222">**Perform fault-injection testing for your application.**</span></span> <span data-ttu-id="ab6c1-223">应用程序可能出于多种不同的原因而发生故障，例如，证书过期、VM 中系统资源耗尽或存储故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-223">Your application can fail for many different reasons, such as certificate expiration, exhaustion of system resources in a VM, or storage failures.</span></span> <span data-ttu-id="ab6c1-224">在尽可能接近生产环境的环境中，通过模拟或触发实际故障来测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-224">Test your application in an environment as close as possible to production, by simulating or triggering real failures.</span></span> <span data-ttu-id="ab6c1-225">例如，删除证书、人为地消耗系统资源，或删除存储源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-225">For example, delete certificates, artificially consume system resources, or delete a storage source.</span></span> <span data-ttu-id="ab6c1-226">验证应用程序是否能够从所有类型的故障（单独或组合的故障）中恢复。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-226">Verify your application's ability to recover from all types of faults, alone and in combination.</span></span> <span data-ttu-id="ab6c1-227">检查故障是否不会通过系统传播或引发连锁故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-227">Check that failures are not propagating or cascading through your system.</span></span>

<span data-ttu-id="ab6c1-228">**使用合成数据和真实用户数据在生产环境中运行测试。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-228">**Run tests in production using both synthetic and real user data.**</span></span> <span data-ttu-id="ab6c1-229">测试环境和生产环境很少完全相同，因此，必须使用蓝/绿部署或金丝雀部署方法在生产环境中测试应用程序。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-229">Test and production are rarely identical, so it's important to use blue/green or a canary deployment and test your application in production.</span></span> <span data-ttu-id="ab6c1-230">这样，便可以在真实负载下在生产环境中测试应用程序，并确保它在完全部署后可按预期运行。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-230">This allows you to test your application in production under real load and ensure it will function as expected when fully deployed.</span></span>

## <a name="deployment"></a><span data-ttu-id="ab6c1-231">部署</span><span class="sxs-lookup"><span data-stu-id="ab6c1-231">Deployment</span></span>

<span data-ttu-id="ab6c1-232">**阐述应用程序的发布过程。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-232">**Document the release process for your application.**</span></span> <span data-ttu-id="ab6c1-233">如果不提供详细的发布过程文档，操作员可能部署错误的更新，或不当地配置应用程序的设置。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-233">Without detailed release process documentation, an operator might deploy a bad update or improperly configure settings for your application.</span></span> <span data-ttu-id="ab6c1-234">明确定义和阐述发布过程，并确保将其提供给整个运营团队。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-234">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span>

<span data-ttu-id="ab6c1-235">**自动执行应用程序部署过程。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-235">**Automate your application's deployment process.**</span></span> <span data-ttu-id="ab6c1-236">如果需要操作人员手动部署应用程序，则人为错误可能导致部署失败。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-236">If your operations staff is required to manually deploy your application, human error can cause the deployment to fail.</span></span>

<span data-ttu-id="ab6c1-237">**设计发布过程，以便尽量提高应用程序可用性。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-237">**Design your release process to maximize application availability.**</span></span> <span data-ttu-id="ab6c1-238">如果发布过程要求服务在部署期间脱机，应用程序只能在重新联机后才可用。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-238">If your release process requires services to go offline during deployment, your application will be unavailable until they come back online.</span></span> <span data-ttu-id="ab6c1-239">使用[蓝/绿](https://martinfowler.com/bliki/BlueGreenDeployment.html)或[金丝雀发布](https://martinfowler.com/bliki/CanaryRelease.html)部署方法将应用程序部署到生产环境。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-239">Use the [blue/green](https://martinfowler.com/bliki/BlueGreenDeployment.html) or [canary release](https://martinfowler.com/bliki/CanaryRelease.html) deployment technique to deploy your application to production.</span></span> <span data-ttu-id="ab6c1-240">这两种方法涉及到连同生产代码一起部署发布代码，因此，在发生故障时，发布代码的用户可重定向到生产代码。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-240">Both of these techniques involve deploying your release code alongside production code so users of release code can be redirected to production code in the event of a failure.</span></span>

<span data-ttu-id="ab6c1-241">**记录并审核应用程序的部署。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-241">**Log and audit your application's deployments.**</span></span> <span data-ttu-id="ab6c1-242">如果使用分阶段部署方法（例如蓝/绿或金丝雀发布方法），则生产环境中会运行的应用程序的多个版本。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-242">If you use staged deployment techniques such as blue/green or canary releases there will be more than one version of your application running in production.</span></span> <span data-ttu-id="ab6c1-243">如果出现问题，确定应用程序的哪个版本导致该问题至关重要。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-243">If a problem should occur, it's critical to determine which version of your application is causing a problem.</span></span> <span data-ttu-id="ab6c1-244">实施可靠的日志记录策略来尽量多地捕获版本特定的信息。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-244">Implement a robust logging strategy to capture as much version-specific information as possible.</span></span>

<span data-ttu-id="ab6c1-245">**为部署创建回滚计划。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-245">**Have a rollback plan for deployment.**</span></span> <span data-ttu-id="ab6c1-246">应用程序部署可能失败，并导致应用程序不可用。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-246">It's possible that your application deployment could fail and cause your application to become unavailable.</span></span> <span data-ttu-id="ab6c1-247">请设计回滚过程，以恢复到上次已知正确的版本并最小化停机时间。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-247">Design a rollback process to go back to a last known good version and minimize downtime.</span></span>

## <a name="operations"></a><span data-ttu-id="ab6c1-248">操作</span><span class="sxs-lookup"><span data-stu-id="ab6c1-248">Operations</span></span>

<span data-ttu-id="ab6c1-249">**实施有关在应用程序中进行监视和警报的最佳做法。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-249">**Implement best practices for monitoring and alerting in your application.**</span></span> <span data-ttu-id="ab6c1-250">不采用适当的监视、诊断和警报措施，就无法检测应用程序中的故障并提醒操作员解决故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-250">Without proper monitoring, diagnostics, and alerting, there is no way to detect failures in your application and alert an operator to fix them.</span></span> <span data-ttu-id="ab6c1-251">有关详细信息，请参阅[监视和诊断指南][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-251">For more information, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ab6c1-252">**度量远程调用统计信息，并将信息提供给应用程序团队。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-252">**Measure remote call statistics and make the information available to the application team.**</span></span>  <span data-ttu-id="ab6c1-253">如果不实时跟踪和报告远程调用统计信息并提供查看此信息的简单办法，则运营团队不能即时深入了解应用程序的运行状况。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-253">If you don't track and report remote call statistics in real time and provide an easy way to review this information, the operations team will not have an instantaneous view into the health of your application.</span></span> <span data-ttu-id="ab6c1-254">如果仅度量平均远程调用时间，则没有足够的信息揭露服务中的问题。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-254">And if you only measure average remote call time, you will not have enough information to reveal issues in the services.</span></span> <span data-ttu-id="ab6c1-255">汇总远程调用指标，例如延迟、吞吐量和 99 和 95 百分位中的错误。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-255">Summarize remote call metrics such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span> <span data-ttu-id="ab6c1-256">针对指标执行统计分析，以发现每个百分位中发生的错误。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-256">Perform statistical analysis on the metrics to uncover errors that occur within each percentile.</span></span>

<span data-ttu-id="ab6c1-257">**跟踪适当时间范围内的暂时性异常和重试数目。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-257">**Track the number of transient exceptions and retries over an appropriate timeframe.**</span></span> <span data-ttu-id="ab6c1-258">如果不跟踪和监视各时间段的暂时性异常和重试，应用程序的重试逻辑中可能会隐藏问题或故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-258">If you don't track and monitor transient exceptions and retry attempts over time, it's possible that an issue or failure could be hidden by your application's retry logic.</span></span> <span data-ttu-id="ab6c1-259">也就是说，如果监视和日志记录仅显示操作的成功或失败结果，则由于异常而必须多次重试的操作将会隐藏。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-259">That is, if your monitoring and logging only shows success or failure of an operation, the fact that the operation had to be retried multiple times due to exceptions will be hidden.</span></span> <span data-ttu-id="ab6c1-260">在一段时间内异常的增加趋势指示此服务有问题，并可能发生故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-260">A trend of increasing exceptions over time indicates that the service is having an issue and may fail.</span></span> <span data-ttu-id="ab6c1-261">有关详细信息，请参阅[重试服务指南][retry-service-guidance]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-261">For more information, see [Retry service specific guidance][retry-service-guidance].</span></span>

<span data-ttu-id="ab6c1-262">**实施提醒操作员的提前警告系统。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-262">**Implement an early warning system that alerts an operator.**</span></span> <span data-ttu-id="ab6c1-263">识别应用程序运行状况的关键性能指标，例如暂时性异常和远程调用延迟，并设置其中每个的适当阈值。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-263">Identify the key performance indicators of your application's health, such as transient exceptions and remote call latency, and set appropriate threshold values for each of them.</span></span> <span data-ttu-id="ab6c1-264">达到阈值时，将警报发送到操作员。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-264">Send an alert to operations when the threshold value is reached.</span></span> <span data-ttu-id="ab6c1-265">在它们变得严重并且需要恢复响应之前，设置确定问题的阈值级别。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-265">Set these thresholds at levels that identify issues before they become critical and require a recovery response.</span></span>

<span data-ttu-id="ab6c1-266">**确保团队的多个人员经过培训，能够监视应用程序并执行任何手动恢复步骤。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-266">**Ensure that more than one person on the team is trained to monitor the application and perform any manual recovery steps.**</span></span> <span data-ttu-id="ab6c1-267">如果团队中只有一个操作员可以监视应用程序和启动恢复步骤，此人将成为单一故障点。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-267">If you only have a single operator on the team who can monitor the application and kick off recovery steps, that person becomes a single point of failure.</span></span> <span data-ttu-id="ab6c1-268">培训多个检测和恢复人员，并确保始终至少有一个处于活动状态。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-268">Train multiple individuals on detection and recovery and make sure there is always at least one active at any time.</span></span>

<span data-ttu-id="ab6c1-269">**确保应用程序不会达到 [Azure 订阅限制](/azure/azure-subscription-service-limits/)。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-269">**Ensure that your application does not run up against [Azure subscription limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="ab6c1-270">Azure 订阅限制特定的资源类型，例如资源组数量、内核数量和存储帐户数量。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-270">Azure subscriptions have limits on certain resource types, such as number of resource groups, number of cores, and number of storage accounts.</span></span>  <span data-ttu-id="ab6c1-271">如果应用程序的要求超过 Azure 订阅限制，请创建另一个 Azure 订阅并预配足够的资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-271">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span>

<span data-ttu-id="ab6c1-272">**确保应用程序不会达到[每个服务的限制](/azure/azure-subscription-service-limits/)。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-272">**Ensure that your application does not run up against [per-service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="ab6c1-273">每个 Azure 服务存在消耗量限制 &mdash; 例如，存储、吞吐量、连接、每秒请求数和其他指标的限制。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-273">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="ab6c1-274">如果应用程序尝试使用的资源超过这些限制，则会发生故障。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-274">Your application will fail if it attempts to use resources beyond these limits.</span></span> <span data-ttu-id="ab6c1-275">这会导致服务限制，并可能给受影响用户造成停机。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-275">This will result in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="ab6c1-276">根据特定的服务和应用程序要求，通常可以通过纵向扩展（例如，选择另一个定价层）或横向扩展（添加新实例）避免这些限制。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-276">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (adding new instances).</span></span>

<span data-ttu-id="ab6c1-277">**将应用程序的存储要求设计为处在Azure 存储可伸缩性和性能目标的范围内。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-277">**Design your application's storage requirements to fall within Azure storage scalability and performance targets.**</span></span> <span data-ttu-id="ab6c1-278">Azure 存储需在预定义的可伸缩性和性能目标内运行，因此请将应用程序设计为使用这些目标内的存储。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-278">Azure storage is designed to function within predefined scalability and performance targets, so design your application to utilize storage within those targets.</span></span> <span data-ttu-id="ab6c1-279">如果超出这些目标，应用程序会受到存储限制。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-279">If you exceed these targets your application will experience storage throttling.</span></span> <span data-ttu-id="ab6c1-280">若要解决此问题，请预配更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-280">To fix this, provision additional Storage Accounts.</span></span> <span data-ttu-id="ab6c1-281">如果达到存储帐户限制，请预配更多的 Azure 订阅，然后预配更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-281">If you run up against the Storage Account limit, provision additional Azure Subscriptions and then provision additional Storage Accounts there.</span></span> <span data-ttu-id="ab6c1-282">有关详细信息，请参阅 [Azure 存储可伸缩性和性能目标](/azure/storage/storage-scalability-targets/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-282">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/).</span></span>

<span data-ttu-id="ab6c1-283">**为应用程序选择适当的 VM 大小。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-283">**Select the right VM size for your application.**</span></span> <span data-ttu-id="ab6c1-284">在生产环境中度量 VM 的实际 CPU、内存、磁盘和 I/O，并验证选择的 VM 大小是否足够。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-284">Measure the actual CPU, memory, disk, and I/O of your VMs in production and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="ab6c1-285">如果不足，当 VM 接近其限制时，应用程序可能遇到容量问题。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-285">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="ab6c1-286">[Azure 中虚拟机的大小](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)中详细介绍了 VM 大小。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-286">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="ab6c1-287">**确定应用程序的工作负荷在一段时间内是稳定还是波动。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-287">**Determine if your application's workload is stable or fluctuating over time.**</span></span> <span data-ttu-id="ab6c1-288">如果工作负荷在一段时间内波动，请使用 Azure VM 规模集自动缩放 VM 实例的数目。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-288">If your workload fluctuates over time, use Azure VM scale sets to automatically scale the number of VM instances.</span></span> <span data-ttu-id="ab6c1-289">否则，必须手动增加或减少 VM 的数目。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-289">Otherwise, you will have to manually increase or decrease the number of VMs.</span></span> <span data-ttu-id="ab6c1-290">有关详细信息，请参阅[虚拟机规模集概述](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-290">For more information, see the [Virtual Machine Scale Sets Overview](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="ab6c1-291">**为 Azure SQL 数据库选择适当的服务层。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-291">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="ab6c1-292">如果应用程序使用 Azure SQL 数据库，请确保选择适当的服务层。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-292">If your application uses Azure SQL Database, ensure that you have selected the appropriate service tier.</span></span> <span data-ttu-id="ab6c1-293">如果选择的层无法应对应用程序的数据库事务单位 (DTU) 要求，则数据将受到限制。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-293">If you select a tier that is not able to handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="ab6c1-294">有关如何选择正确服务计划的详细信息，请参阅 [SQL 数据库选项和性能：了解每个服务层提供的功能](/azure/sql-database/sql-database-service-tiers/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-294">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="ab6c1-295">**创建与 Azure 支持部门交互的过程。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-295">**Create a process for interacting with Azure support.**</span></span> <span data-ttu-id="ab6c1-296">如果在需要联系支持人员之前未设置联系 [Azure 支持部门](https://azure.microsoft.com/support/plans/)的过程，则停机时间将会延长，因为第一次需要导航支持过程。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-296">If the process for contacting [Azure support](https://azure.microsoft.com/support/plans/) is not set before the need to contact support arises, downtime will be prolonged as the support process is navigated for the first time.</span></span> <span data-ttu-id="ab6c1-297">在设计应用程序复原能力的过程中，从一开始就包括与支持部门联系的过程，以及升级事务的过程。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-297">Include the process for contacting support and escalating issues as part of your application's resiliency from the outset.</span></span>

<span data-ttu-id="ab6c1-298">**确保应用程序不会使用超过每个订阅的最大存储帐户数。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-298">**Ensure that your application doesn't use more than the maximum number of storage accounts per subscription.**</span></span> <span data-ttu-id="ab6c1-299">Azure 允许为每个订阅最多使用 200 个存储帐户。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-299">Azure allows a maximum of 200 storage accounts per subscription.</span></span> <span data-ttu-id="ab6c1-300">如果应用程序所需的存储帐户数超过订阅中当前提供的数目，则需要创建新的订阅，并在其中创建更多的存储帐户。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-300">If your application requires more storage accounts than are currently available in your subscription, you will have to create a new subscription and create additional storage accounts there.</span></span> <span data-ttu-id="ab6c1-301">有关详细信息，请参阅 [Azure 订阅和服务限制、配额与约束](/azure/azure-subscription-service-limits/#storage-limits)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-301">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>

<span data-ttu-id="ab6c1-302">**确保应用程序不超过虚拟机磁盘的可伸缩性目标。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-302">**Ensure that your application doesn't exceed the scalability targets for virtual machine disks.**</span></span> <span data-ttu-id="ab6c1-303">Azure IaaS VM 根据多种因素（包括 VM 大小和存储帐户类型）支持附加一些数据磁盘。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-303">An Azure IaaS VM supports attaching a number of data disks depending on several factors, including the VM size and type of storage account.</span></span> <span data-ttu-id="ab6c1-304">如果应用程序超过虚拟机磁盘的可伸缩性目标，请预配更多的存储帐户并在其中创建虚拟机磁盘。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-304">If your application exceeds the scalability targets for virtual machine disks, provision additional storage accounts and create the virtual machine disks there.</span></span> <span data-ttu-id="ab6c1-305">有关详细信息，请参阅 [Azure 存储可伸缩性和性能目标](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span><span class="sxs-lookup"><span data-stu-id="ab6c1-305">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span></span>

## <a name="telemetry"></a><span data-ttu-id="ab6c1-306">遥测</span><span class="sxs-lookup"><span data-stu-id="ab6c1-306">Telemetry</span></span>

<span data-ttu-id="ab6c1-307">**当应用程序在生产环境中运行时记录遥测数据。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-307">**Log telemetry data while the application is running in the production environment.**</span></span> <span data-ttu-id="ab6c1-308">当应用程序在生产环境中运行时捕获可靠的遥测信息，否则没有足够的信息来诊断应用程序为用户提供服务时出现的问题的原因。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-308">Capture robust telemetry information while the application is running in the production environment or you will not have sufficient information to diagnose the cause of issues while it's actively serving users.</span></span> <span data-ttu-id="ab6c1-309">有关详细信息，请参阅[监视和诊断][monitoring-and-diagnostics-guidance]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-309">For more information, see [Monitoring and Diagnostics][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ab6c1-310">**使用异步模式实施日志记录。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-310">**Implement logging using an asynchronous pattern.**</span></span> <span data-ttu-id="ab6c1-311">如果日志记录操作是同步的，则可能会阻止应用程序代码。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-311">If logging operations are synchronous, they might block your application code.</span></span> <span data-ttu-id="ab6c1-312">确保将日志记录操作实施为异步操作。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-312">Ensure that your logging operations are implemented as asynchronous operations.</span></span>

<span data-ttu-id="ab6c1-313">**跨服务边界关联日志数据。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-313">**Correlate log data across service boundaries.**</span></span> <span data-ttu-id="ab6c1-314">在典型的 N 层应用程序中，用户请求可能遍历多个服务边界。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-314">In a typical n-tier application, a user request may traverse several service boundaries.</span></span> <span data-ttu-id="ab6c1-315">例如，某个用户请求通常源自于 Web 层并传递到业务层，最后保留在数据层。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-315">For example, a user request typically originates in the web tier and is passed to the business tier and finally persisted in the data tier.</span></span> <span data-ttu-id="ab6c1-316">在更复杂的情况下，可将用户请求分发到多个不同的服务和数据存储。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-316">In more complex scenarios, a user request may be distributed to many different services and data stores.</span></span> <span data-ttu-id="ab6c1-317">确保日志记录系统跨服务边界关联调用，以便可以跟踪整个应用程序中的请求。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-317">Ensure that your logging system correlates calls across service boundaries so you can track the request throughout your application.</span></span>

## <a name="azure-resources"></a><span data-ttu-id="ab6c1-318">Azure 资源</span><span class="sxs-lookup"><span data-stu-id="ab6c1-318">Azure Resources</span></span>

<span data-ttu-id="ab6c1-319">**使用 Azure 资源管理器模板预配资源。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-319">**Use Azure Resource Manager templates to provision resources.**</span></span> <span data-ttu-id="ab6c1-320">使用资源管理器模板可以更轻松地通过 PowerShell 或 Azure CLI 自动完成部署，使部署过程更可靠。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-320">Resource Manager templates make it easier to automate deployments via PowerShell or the Azure CLI, which leads to a more reliable deployment process.</span></span> <span data-ttu-id="ab6c1-321">有关详细信息，请参阅 [Azure 资源管理器概述][resource-manager]。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-321">For more information, see [Azure Resource Manager overview][resource-manager].</span></span>

<span data-ttu-id="ab6c1-322">**为资源指定有意义的名称。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-322">**Give resources meaningful names.**</span></span> <span data-ttu-id="ab6c1-323">为资源指定有意义的名称可以更轻松地找到特定资源并了解其角色。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-323">Giving resources meaningful names makes it easier to locate a specific resource and understand its role.</span></span> <span data-ttu-id="ab6c1-324">有关详细信息，请参阅 [Azure 资源的建议命名约定](../best-practices/naming-conventions.md)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-324">For more information, see [Naming conventions for Azure resources](../best-practices/naming-conventions.md)</span></span>

<span data-ttu-id="ab6c1-325">**使用基于角色的访问控制 (RBAC)。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-325">**Use role-based access control (RBAC).**</span></span> <span data-ttu-id="ab6c1-326">使用 RBAC 控制对已部署的 Azure 资源的访问。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-326">Use RBAC to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="ab6c1-327">RBAC 允许向 DevOps 团队成员分配授权角色，防止意外删除或更改已部署的资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-327">RBAC lets you assign authorization roles to members of your DevOps team, to prevent accidental deletion or changes to deployed resources.</span></span> <span data-ttu-id="ab6c1-328">有关详细信息，请参阅 [Azure 门户中的访问管理入门](/azure/active-directory/role-based-access-control-what-is/)。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-328">For more information, see [Get started with access management in the Azure portal](/azure/active-directory/role-based-access-control-what-is/)</span></span>

<span data-ttu-id="ab6c1-329">**对 VM 等关键资源使用资源锁。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-329">**Use resource locks for critical resources, such as VMs.**</span></span> <span data-ttu-id="ab6c1-330">资源锁可防止操作员意外删除资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-330">Resource locks prevent an operator from accidentally deleting a resource.</span></span> <span data-ttu-id="ab6c1-331">有关详细信息，请参阅 [使用 Azure 资源管理器锁定资源](/azure/azure-resource-manager/resource-group-lock-resources/)</span><span class="sxs-lookup"><span data-stu-id="ab6c1-331">For more information, see [Lock resources with Azure Resource Manager](/azure/azure-resource-manager/resource-group-lock-resources/)</span></span>

<span data-ttu-id="ab6c1-332">**选择区域对。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-332">**Choose regional pairs.**</span></span> <span data-ttu-id="ab6c1-333">部署到两个区域时，请从相同的区域对中选择区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-333">When deploying to two regions, choose regions from the same regional pair.</span></span> <span data-ttu-id="ab6c1-334">如果发生大范围的服务中断，会优先恢复每个配对中的一个区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-334">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="ab6c1-335">某些服务（例如异地冗余存储）提供自动复制到配对区域的功能。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-335">Some services such as Geo-Redundant Storage provide automatic replication to the paired region.</span></span> <span data-ttu-id="ab6c1-336">有关详细信息，请参阅[业务连续性和灾难恢复 (BCDR)：Azure 配对区域](/azure/best-practices-availability-paired-regions)</span><span class="sxs-lookup"><span data-stu-id="ab6c1-336">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions)</span></span>

<span data-ttu-id="ab6c1-337">**按功能和生命周期组织资源组。**</span><span class="sxs-lookup"><span data-stu-id="ab6c1-337">**Organize resource groups by function and lifecycle.**</span></span>  <span data-ttu-id="ab6c1-338">一般情况下，资源组应包含具有相同生命周期的资源。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-338">In general, a resource group should contain resources that share the same lifecycle.</span></span> <span data-ttu-id="ab6c1-339">这样可以更方便地管理部署、删除测试部署和分配访问权限，减少意外删除或修改生产部署的可能性。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-339">This makes it easier to manage deployments, delete test deployments, and assign access rights, reducing the chance that a production deployment is accidentally deleted or modified.</span></span> <span data-ttu-id="ab6c1-340">为生产、开发和测试环境创建单独的资源组。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-340">Create separate resource groups for production, development, and test environments.</span></span> <span data-ttu-id="ab6c1-341">在多区域部署中，请将每个区域的资源放入单独的资源组。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-341">In a multi-region deployment, put resources for each region into separate resource groups.</span></span> <span data-ttu-id="ab6c1-342">这可以更方便地重新部署一个区域，而不影响其他区域。</span><span class="sxs-lookup"><span data-stu-id="ab6c1-342">This makes it easier to redeploy one region without affecting the other region(s).</span></span>

## <a name="next-steps"></a><span data-ttu-id="ab6c1-343">后续步骤</span><span class="sxs-lookup"><span data-stu-id="ab6c1-343">Next steps</span></span>

- [<span data-ttu-id="ab6c1-344">特定 Azure 服务的复原能力检查表</span><span class="sxs-lookup"><span data-stu-id="ab6c1-344">Resiliency checklist for specific Azure services</span></span>](./resiliency-per-service.md)
- [<span data-ttu-id="ab6c1-345">故障模式分析</span><span class="sxs-lookup"><span data-stu-id="ab6c1-345">Failure mode analysis</span></span>](../resiliency/failure-mode-analysis.md)

<!-- links -->
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale/
[asynchronous-c-sharp]: /dotnet/articles/csharp/async
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[azure-backup]: https://azure.microsoft.com/documentation/services/backup/
[circuit-breaker]: ../patterns/circuit-breaker.md
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale/
[fma]: ../resiliency/failure-mode-analysis.md
[load-balancer]: /azure/load-balancer/load-balancer-overview/
[monitoring-and-diagnostics-guidance]: ../best-practices/monitoring.md
[resource-manager]: /azure/azure-resource-manager/resource-group-overview/
[retry-service-guidance]: ../best-practices/retry-service-specific.md
[site-recovery]: /azure/site-recovery/
[site-recovery-test]: /azure/site-recovery/site-recovery-test-failover-to-azure
[traffic-manager]: /azure/traffic-manager/traffic-manager-overview/
[traffic-manager-routing]: /azure/traffic-manager/traffic-manager-routing-methods/
[vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/
