---
title: 企业云采用：Azure 中适用于多个团队的治理设计
description: 有关为多个团队、多个工作负荷和多个环境配置 Azure 治理措施的指南
author: petertaylor9999
ms.date: 09/10/2018
ms.topic: guide
ms.service: architecture-center
ms.subservice: enterprise-cloud-adoption
ms.openlocfilehash: de2bfeee7d098984a35f56f9e794e6a37933a3bd
ms.sourcegitcommit: 1b50810208354577b00e89e5c031b774b02736e2
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/23/2019
ms.locfileid: "54488420"
---
# <a name="enterprise-cloud-adoption-governance-design-for-multiple-teams"></a>企业云采用：适用于多个团队的治理设计

本指南旨在介绍在 Azure 中设计资源治理模型，以便为多个团队、多个工作负荷和多个环境提供支持这一过程。  其中探讨了一系列假设性的治理要求，然后详细讲解满足这些要求的几个示例实现。

要求如下：
* 企业计划将新的云角色和职责转移给一组用户，因此需要对在 Azure 中具有不同资源访问需求的多个团队进行标识管理。 此标识管理系统是存储以下用户的标识所需的：
  1. 组织中负责**订阅**所有权的个人。
  2. 组织中负责**共享基础结构资源**（用于将本地网络连接到 Azure 虚拟网络）的个人。 
  3. 组织中负责管理**工作负荷**的两个人。 
* 支持多个**环境**。 环境是对虚拟机、虚拟网络、网络流量路由服务等资源的逻辑分组。 这些资源组有相似的管理和安全要求，通常用于特定的目的，例如测试或生产。 在此示例中，该要求适用于三个环境：
  1. 一个**共享基础结构环境**，包含其他环境中工作负荷共享的资源。 例如，包含用于建立本地连接的网关子网的虚拟网络。
  2. 一个**生产环境**，包含限制性最强的安全策略。 可以包含面向内部或外部的工作负荷。
  3. 一个**开发环境**，用于概念证明和测试工作。 此环境的安全、符合性和成本策略不同于生产环境中的策略。
* 一个**最低特权的权限模型**，其中的用户默认没有任何权限。 该模型必须支持：
  * 位于订阅范围的、有权分配资源访问权限的单个受信任用户。
  * 默认情况下，拒绝每个工作负荷所有者访问资源。 资源访问权限由单个受信任用户在订阅范围显式授予。
  * 仅限共享基础结构所有者对共享基础结构资源进行管理访问。  
  * 仅限工作负荷所有者对每个工作负荷进行管理访问。
  * 企业不希望在这三个环境的每一个中对角色进行单独的管理，因此要求只使用[内置的 RBAC 角色][rbac-built-in-roles]。 如果企业要使用自定义 RBAC 角色，则需通过另一过程同步这三个环境中的自定义角色。 
* 按工作负荷所有者名称和/或环境进行成本跟踪。 

## <a name="identity-management"></a>身份管理

在为治理模型设计标识管理之前，必须了解它附带的四个要素：

* 管理：用于创建、编辑和删除用户标识的过程与工具。
* 身份验证：通过验证凭据（例如用户名和密码）来验证用户的身份。
* 授权：确定已经过身份验证的用户可以访问哪些资源，或者他们有权执行哪些操作。
* 审核：定期审查日志和其他信息，以发现用户标识相关的安全问题。 这包括审查可疑的使用模式、定期审查用户权限以验证是否准确，以及其他功能。

Azure 只信任一个标识服务，即 Azure Active Directory (Azure AD)。 我们会将用户添加到 Azure AD，并对上面列出的所有功能使用 Azure AD。 但是，在了解如何配置 Azure AD 之前，必须了解用于管理对这些服务的访问的特权帐户。

组织注册 Azure 帐户时，系统分配了至少一个 Azure **帐户所有者**。 另外还会创建一个 Azure AD **租户**，除非现有的租户已经与组织使用的其他 Microsoft 服务（例如 Office 365）相关联。 创建 Azure AD 租户时，会在该租户中关联一个具有完全权限的**全局管理员**。 

Azure 帐户所有者和 Azure AD 全局管理员的用户标识存储在 Microsoft 管理的高度安全的标识系统中。 Azure 帐户所有者有权创建、更新和删除订阅。 Azure AD 全局管理员有权在 Azure AD 中执行许多操作，但本设计指南侧重于用户标识的创建和删除。 

> [!NOTE]
> 如果帐户已关联了现有的 Office 365 或 Intune 许可证，则组织可能已有现有的 Azure AD 租户。

Azure 帐户所有者有权创建、更新和删除订阅： 

![充当 Azure 帐户管理者和 Azure AD 全局管理员的 Azure 帐户](../_images/governance-3-0.png)
*图 1.充当 Azure 帐户管理者和 Azure AD 全局管理员的 Azure 帐户。*

Azure AD **全局管理员**有权创建用户帐户：  

![充当 Azure 帐户管理者和 Azure AD 全局管理员的 Azure 帐户](../_images/governance-3-0a.png)
*图 2.Azure AD 全局管理员在租户中创建所需的用户帐户。*

前两个帐户（**App1 工作负荷所有者**和 **App2 工作负荷所有者**）各自与组织中负责管理工作负荷的个人相关联。 **网络操作**帐户由负责共享基础结构资源的个人拥有。 最后，**订阅所有者**帐户与拥有订阅的负责人相关联。

## <a name="resource-access-permissions-model-of-least-privilege"></a>最低特权的资源访问权限模型

创建标识管理系统和用户帐户后，必须确定如何将基于角色的访问控制 (RBAC) 角色应用到每个帐户，以支持最低特权的权限模型。

其他要求包括，与每个工作负荷关联的资源应相互隔离，防止某个工作负荷所有者对其不拥有的其他任何工作负荷进行管理访问。 另外还要求只使用 [Azure RBAC 的内置角色][rbac-built-in-roles]实现此模型。

每个 RBAC 角色在 Azure 中的三个范围之一应用：**订阅**、**资源组**和个人**资源**。 角色在较低的范围继承。 例如，如果在订阅级别为某个用户分配了[内置的所有者角色][rbac-built-in-owner]，则该角色也会在资源组和个人资源级别分配到该用户，除非该级别被覆盖。

因此，若要创建最低特权访问模型，必须确定特定类型的用户能够在上述每个范围执行的操作。 例如，对工作负荷所有者的要求是，只有权管理对与其工作负荷相关联的资源的访问，而不能管理对任何其他资源的访问。 如果在订阅范围分配了[内置的所有者角色][rbac-built-in-owner]，则每个工作负荷所有者对所有工作负荷都拥有管理访问权限。

让我们看看两个示例权限模型，以更好地理解这一概念。 在第一个示例中，模型仅信任服务管理员来创建资源组。 在第二个示例中，模型在订阅范围将内置的所有者角色分配到每个工作负荷所有者。 

这两个示例都在订阅范围为订阅服务管理员分配了[内置的所有者角色][rbac-built-in-owner]。 前文提到，[内置的所有者角色][rbac-built-in-owner]会授予所有权限，包括资源访问权限的管理。
![充当所有者角色的订阅服务管理员](../_images/governance-2-1.png)
*图 3.具有分配了内置所有者角色的服务管理员的订阅。* 

1. 在第一个示例中，**工作负荷所有者 A** 在订阅范围没有任何权限 - 默认情况下，没有资源访问管理权限。 此用户想要为其工作负荷部署和管理资源。 他（她）必须联系**服务管理员**来请求创建资源组。
![工作负荷所有者请求创建资源组 A](../_images/governance-2-2.png)  

2. **服务管理员**审查其请求，然后创建**资源组 A**。此时，**工作负荷所有者 A** 仍然无权执行任何操作。
![服务管理员创建资源组 A](../_images/governance-2-3.png)

3. **服务管理员**将**工作负荷所有者 A** 添加到**资源组 A**，并分配[内置的参与者角色](/azure/role-based-access-control/built-in-roles#contributor)。 参与者角色授予**资源组 A** 中的所有权限，但无法管理访问权限。
![服务管理员将工作负荷所有者 A 添加到资源组 A](../_images/governance-2-4.png)

4. 假设**工作负荷所有者 A** 要求在进行工作负荷的容量规划时，安排两个团队成员来查看 CPU 和网络流量监视数据。 由于**工作负荷所有者 A** 充当参与者角色，因此无权将用户添加到**资源组 A**。他（她）必须将此请求发送到**服务管理员**。
![工作负荷所有者请求将工作负荷参与者添加到资源组](../_images/governance-2-5.png)

5. **服务管理员**审查请求，并将两个**工作负荷参与者**用户添加到**资源组 A**。这两个用户都不需要资源的管理权限，因此为他们分配了[内置的读取者角色](/azure/role-based-access-control/built-in-roles#contributor)。 
![服务管理员将工作负荷参与者添加到资源组 A](../_images/governance-2-6.png)

6. 接下来，**工作负荷所有者 B** 还需要创建一个资源组来包含其工作负荷的资源。 与**工作负荷所有者 A** 一样，**工作负荷所有者 B** 最初无权在订阅范围执行任何操作，因此，他（她）必须将请求发送到**服务管理员**。 
![工作负荷所有者 B 请求创建资源组 B](../_images/governance-2-7.png)

7. **服务管理员**审查请求，然后创建**资源组 B**。![服务管理员创建资源组 B](../_images/governance-2-8.png)

8. 然后，**服务管理员**将**工作负荷所有者 B** 添加到**资源组 B**，并分配[内置的参与者角色](https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#contributor)。 
![服务管理员将工作负荷所有者 B 添加到资源组 B](../_images/governance-2-9.png)

此时，每个工作负荷所有者在其自身的资源组中是隔离的。 工作负荷所有者或其团队成员对其他任何资源组中的资源拥有管理访问权限。 

![包含资源组 A 和 B 的订阅](../_images/governance-2-10.png)
*图 4.两个工作负荷所有者在其自身资源组中保持隔离的订阅。*

此模型属于最低特权模型 - 在正确的资源管理范围为每个用户分配了正确的权限。

但是，请考虑本示例中由**服务管理员**执行的每项任务。 这是一个很简单的示例。由于只有两个工作负荷所有者，因此看上去不会有任何问题。但是，很容易就能想像到，在大型组织中会出现哪种问题。 例如，如果存在大量导致延迟的积压请求，则**服务管理员**可能成为瓶颈。  

让我们看看第二个示例，其中演示了如何减少**服务管理员**执行的任务数目。 

1. 在此模型中，在订阅范围为**工作负荷所有者 A** 分配了[内置的所有者角色][rbac-built-in-owner]，使他（她）能够创建自己的资源组：**资源组 A**。![服务管理员将工作负荷所有者 A 添加到订阅](../_images/governance-2-11.png)

2. 创建**资源组 A** 后，**工作负荷所有者 A** 默认会添加，并继承角色订阅范围的[内置所有者][rbac-built-in-owner]。
![工作负荷所有者 A 创建资源组 A](../_images/governance-2-12.png)

3. [内置所有者角色][rbac-built-in-owner]为**工作负荷所有者 A** 授予资源组的管理访问权限。 **工作负荷所有者 A** 添加两个**工作负荷参与者**，并为每个参与者分配[内置的读取者角色][rbac-built-in-owner]。 
![工作负荷所有者 A 添加工作负荷参与者](../_images/governance-2-13.png)

4. 现在，**服务管理员**将**工作负荷所有者 B** 添加到具有内置所有者角色的订阅。 
![服务管理员将工作负荷所有者 B 添加到订阅](../_images/governance-2-14.png)

5. **工作负荷所有者 B** 创建**资源组 B**，并按默认添加。 同样，**工作负荷所有者 B** 继承订阅范围的内置所有者角色。
![工作负荷所有者 B 创建资源组 B](../_images/governance-2-15.png)

请注意，在此模型中，**服务管理员**执行的操作要比第一个示例中要少，因为管理访问权限委托给了每个工作负荷所有者。

![包含资源组 A 和 B 的订阅](../_images/governance-2-16.png)
*图 5.具有一个服务管理员和两个工作负荷所有者（都分配有内置的所有者角色）的订阅。*

但是，由于**工作负荷所有者 A** 和**工作负荷所有者 B** 都在订阅范围分配有内置的所有者角色，因此他们都继承了对方资源组的内置所有者角色。 这意味着，他们不仅对对方的资源拥有完全访问权限，而且还能委托对方资源组的管理访问权限。 例如，**工作负荷所有者 B** 有权将其他任何用户添加到**资源组 A**，并可以向该用户分配任何角色，包括内置的所有者角色。

如果根据要求比较每个示例，可以看到，这两个示例支持订阅范围的单个受信任用户，该用户有权向两个工作负荷所有者授予资源访问权限。 默认情况下，其中的两个工作负荷所有者没有资源管理访问权限，要求**服务管理员**显式向其分配权限。 但是，只有第一个示例能够满足以下要求：与每个工作负荷关联的资源相互隔离，防止任何工作负荷所有者有权访问其他任何工作负荷的的资源。

## <a name="resource-management-model"></a>资源管理模型

设计最低特权的权限模型后，让我们继续了解这些治理模型的一些实际应用。 回顾前面所述的要求，我们必须支持以下三个环境：
1. **共享基础结构：** 包含所有工作负荷共享的资源的单个组。 这些资源包括网络网关、防火墙和安全服务等。  
2. **开发：** 包含表示多个非生产就绪工作负荷的资源的多个组。 这些资源用于概念证明、测试和其他开发人员活动。 这些资源可能有更宽松的治理模型，目的是提高开发敏捷性。
3. **生产：** 包含表示多个生产工作负荷的资源的多个组。 这些资源用于托管私用和公用的应用程序项目。 这些资源通常具有最严格的治理和安全模型，以防未经授权访问资源、应用程序代码和数据。

对于上述每个环境，我们的要求是按**工作负荷所有者**和/或**环境**跟踪成本数据。 也就是说，我们需要了解**共享基础结构**的持续成本、**开发**和**生产**环境中的个人产生的成本，以及**开发**和**生产**的总体成本。 

我们知道资源划分为两个级别：**订阅**和**资源组**。 因此，首先要确定如何按**订阅**组织环境。 只存在两种可能：单个订阅或多个订阅。 

在学习其中每个模型的示例之前，让我们看看 Azure 中订阅的管理结构。 

回顾前面所述的要求：组织中有一个人负责订阅，此用户在 Azure AD 租户中拥有**订阅所有者**帐户。 但是，此帐户无权创建订阅。 只有 **Azure 帐户所有者**有权执行此操作：![](../_images/governance-3-0b.png)
*图 6.Azure 帐户所有者创建订阅。*

创建订阅后，**Azure 帐户所有者**可将具有**所有者**角色的**订阅所有者**帐户添加到订阅：

![](../_images/governance-3-0c.png)
*图 7.Azure 帐户所有者将具有**所有者**角色的**订阅所有者**用户帐户添加到订阅。*

现在，**订阅所有者**可以创建**资源组**，并委托资源访问管理权限。

让我们探讨一个使用单个订阅的资源管理模型示例。 首先确定如何使资源组与三个环境相符。 有两种做法：
1. 使每个环境与单个资源组相符。 将所有共享基础结构资源部署到单个**共享基础结构**资源组。 将与开发工作负荷关联的所有资源部署到单个**开发**资源组。 将与生产工作负荷关联的所有资源部署到**生产**环境的单个**生产**资源组。 
2. 为每个工作负荷创建单独的资源组，使用命名约定和标记，使资源组与三个环境中的每个相符。  

首先让我们评估第一种做法。 我们将使用上一部分所述的权限模型，其中的单个订阅服务管理员创建了资源组，并将具有内置**参与者**或**读取者**角色的用户添加到这些资源组。 

1. 部署的第一个资源组表示**共享基础结构**环境。 **订阅所有者**为共享基础结构资源创建名为 **netops-shared-rg** 的资源组。 
![](../_images/governance-3-0d.png)
2. **订阅所有者**将**网络操作用户**帐户添加到资源组，并分配**参与者**角色。 
![](../_images/governance-3-0e.png)
3. **网络操作用户**创建 [VPN 网关](/azure/vpn-gateway/vpn-gateway-about-vpngateways)，并将其配置为连接到本地 VPN 设备。 **网络操作**用户还对每个资源应用一对[标记](/azure/azure-resource-manager/resource-group-using-tags)：*environment:shared* 和 *managedBy:netOps*。 当**订阅服务管理员**导出成本报告时，成本将与其中的每个标记相符。 这样，**订阅服务管理员**便可以使用 *environment* 标记和 *managedBy* 标记来透视成本。 请注意插图右上方的**资源限制**计数器。 每个 Azure 订阅都有[服务限制](/azure/azure-subscription-service-limits)，旨在帮助你了解这些限制的影响，我们会遵守每个订阅的虚拟网络限制。 每个订阅的虚拟网络数默认限制为 50 个，部署第一个虚拟网络后，还有 49 个虚拟网络可用。
![](../_images/governance-3-1.png)
4. 再部署两个资源组，其中的第一个资源组名为 *prod-rg*。 此资源组与**生产**环境相符。 第二个资源组名为 *dev-rg*，与**开发**环境相符。 与生产工作负荷关联的所有资源部署到**生产**环境，与开发工作负荷关联的所有资源部署到**开发**环境。 本示例只将两个工作负荷部署到这两种环境，因此，我们不会遇到任何 Azure 订阅服务限制。 但是，请务必注意，每个资源组的资源数限制为 800 个。 因此，如果我们不断地将工作负荷添加到每个资源组，则有可能会达到此限制。 
![](../_images/governance-3-2.png)
5. 第一个**工作负荷所有者**将请求发送到**订阅服务管理员**，并已添加到具有**参与者**角色的每个**开发**和**生产**环境资源组。 如前所述，**参与者**角色允许用户执行任何操作，但不允许向其他用户分配角色。 第一个**工作负荷所有者**现在可以创建与其工作负荷关联的资源。
![](../_images/governance-3-3.png)
6. 第一个**工作负荷所有者**在每个资源组（共两个）中创建一个虚拟网络，其中的每个虚拟网络包含一对虚拟机。 第一个**工作负荷所有者**向所有资源应用 *environment* 和 *managedBy* 标记。 请注意，Azure 服务限制计数器现在显示剩余 47 个虚拟网络。
![](../_images/governance-3-4.png)
7. 创建每个虚拟网络时，该网络并未建立本地连接。 在此类体系结构中，每个虚拟网络必须对等互连到**共享基础结构**环境中的 *hub-vnet*。 虚拟网络对等互连在两个独立的虚拟网络之间创建连接，并允许网络流量在两者之间遍历。 请注意，虚拟网络对等互连在本质上并非是可传递的。 必须在连接的两个虚拟网络中指定对等互连；如果只有一个虚拟网络指定了对等互连，则连接是不完整的。 为了演示这种效果，第一个**工作负荷所有者**在 **prod-vnet** 与 **hub-vnet** 之间指定了对等互连。 已创建第一个对等互连，但流量并未流动，因为尚未指定从 **hub-vnet** 到 **prod-vnet** 的互补性对等互连。 第一个**工作负荷所有者**联系**网络操作**用户，并请求建立这种互补性对等连接。
![](../_images/governance-3-5.png)
8. **网络操作**用户审查请求，批准请求，然后在 **hub-vnet** 的设置中指定对等互连。 对等连接现在是完整的，网络流量可在两个虚拟网络之间流动。
![](../_images/governance-3-6.png)
9. 现在，第二个**工作负荷所有者**将请求发送到**订阅服务管理员**，并已添加到具有**参与者**角色的现有**生产**和**开发**环境资源组。 第二个**工作负荷所有者**对每个资源组中的所有资源的权限与第一个**工作负荷所有者**相同。 
![](../_images/governance-3-7.png)
10. 第二个**工作负荷所有者**在 **prod-vnet** 虚拟网络中创建子网，然后添加两个虚拟机。 第二个**工作负荷所有者**向每个资源应用 *environment* 和 *managedBy* 标记。
![](../_images/governance-3-8.png) 

此示例资源管理模型使我们能够管理三个所需环境中的资源。 共享基础结构资源受到保护，因为订阅中只有一个用户有权访问这些资源。 每个工作负荷所有者能够利用共享基础结构资源，但对于实际的共享资源本身没有任何权限。 但是，此管理模型并不符合工作负荷隔离的要求 - 两个**工作负荷所有者**都能访问对方工作负荷的资源。 

对于此模型，还有一个重要的考虑因素比较容易忽略。 在本示例中，**app1 工作负荷所有者**请求与 **hub-vnet** 建立网络对等互连连接，以便连接到本地。 **网络操作**用户已根据连同工作负荷一起部署的资源评估该请求。 当**订阅所有者**添加具有**参与者**角色的 **app2 工作负荷所有者**时，该工作负荷所有者用户对 **prod-rg** 资源组中的所有资源拥有管理访问权限。 

![](../_images/governance-3-10.png)

这意味着，**app2 工作负荷所有者**有权在 **prod-vnet** 虚拟网络中部署自己的包含虚拟机的子网。 默认情况下，这些虚拟机现在有权访问本地网络。 **网络操作**用户并不知道这些虚拟机，并且未批准建立本地连接。

接下来，让我们探讨单个订阅，其中包含不同环境和工作负荷的多个资源组。 请注意，在前面的示例中，每个环境的资源很容易识别，因为它们在同一个资源组中。 既然我们不再使用这种分组，因此需要依赖于资源组命名约定来提供该功能。 

1. 在此模型中，**共享基础结构**资源仍具有单独的资源组，因此没有变化。 每个工作负荷需要两个资源组 - 每个**开发**和**生产**环境各有一个资源组。 针对第一个工作负荷，**订阅所有者**创建了两个资源组。 第一个资源组名为 **app1-prod-rg**，第二个资源组名为 **app1-dev-rg**。 如前所述，此命名约定分别将资源标识为与第一个工作负荷 **app1**，以及 **dev** 或 **prod** 环境相关联。 同样，*订阅*所有者将具有**参与者**角色的 **app1 工作负荷所有者**添加到资源组。
![](../_images/governance-3-12.png)
2. 类似于第一个示例，**app1 工作负荷所有者**将名为 **app1-prod-vnet** 的虚拟网络部署到**生产**环境中，将名为 **app1-dev-vnet** 的另一个虚拟网络部署到**开发**环境。 同样，**app1 工作负荷所有者**将请求发送到**网络操作**用户，以创建对等连接。 请注意，**app1 工作负荷所有者**添加了与第一个示例中相同的标记，限制计数器显示订阅中剩余的虚拟网络数递减到 47 个。
![](../_images/governance-3-13.png)
3. 现在，**订阅所有者**为 **app2 工作负荷所有者**创建两个资源组。 遵循适用于**app1 工作负荷所有者**的相同约定，将资源组命名为 **app2-prod-rg** 和 **app2-dev-rg**。 **订阅所有者**将具有**参与者**角色的 **app2 工作负荷所有者**添加到每个资源组。
![](../_images/governance-3-14.png)
4. *app2 工作负荷所有者*使用相同的命名约定将虚拟网络和虚拟机部署到资源组。 添加标记，限制计数器显示*订阅*中剩余的虚拟网络数递减到 45 个。
![](../_images/governance-3-15.png)
5. *app2 工作负荷所有者*将请求发送到*网络操作*用户，以便在 *app2-prod-vnet* 与 *hub-vnet* 之间建立对等互连。 *网络操作*用户创建对等连接。
![](../_images/governance-3-16.png)

生成的管理模型类似于第一个示例，但两者存在一些重要差别：
* 已按工作负载和环境将两个工作负荷相隔离。
* 与第一个示例模型不同，此模型需要两个额外的虚拟网络。 尽管这与只使用两个工作负荷没有重大的差别，但此模型的工作负荷数目理论限制为 24 个。 
* 资源不再分组到每个环境的单个资源组中。 将资源分组需要了解每个环境使用的命名约定。 
* *网络操作*用户已审查并批准每个虚拟网络对等互连。

现在，让我们探讨一个使用多个订阅的资源管理模型。 在此模型中，我们要使以下每个环境与单独的订阅相符：**共享服务**订阅、**生产**订阅和**开发**订阅。 此模型的考虑因素与使用单个订阅的模型类似，两者都需要确定如何使资源组与工作负荷相符。 我们已确定，为每个工作负荷创建资源组能够满足工作负荷隔离要求，因此，我们会在此示例中继续使用该模型。

1. 此模型包含三个*订阅*：*共享基础结构*、*生产*和*开发*。 这三个订阅中的每一个都需要一个*订阅所有者*。本示例为简单起见，对所有三个订阅使用了相同的用户帐户。 *共享基础结构*资源的管理方式类似于前两个示例，第一个工作负荷与*生产*环境中的 *app1-rg*，以及*开发*环境中的同名资源组相关联。 *app1 工作负荷所有者*已添加到具有*参与者*角色的每个资源组。 
![](../_images/governance-3-17.png)
2. 与前面的示例一样，*app1 工作负荷所有者*创建了资源，并请求与*共享基础结构*虚拟网络建立对等连接。 *app1 工作负荷所有者*仅添加了 *managedBy* 标记，因为不再需要 *environment* 标记。 因此，每个环境的资源现已分组到相同的*订阅*，而 *environment* 标记是多余的。 限制计数器显示剩余的虚拟网络数递减到 49 个。
![](../_images/governance-3-18.png)
3. 最后，*订阅所有者*针对第二个工作负荷重复上述过程添加资源组，其中包含具有 *参与者角色的 *app2 工作负荷所有者*。 每个环境订阅的限制计数器显示剩余的虚拟网络数递减到 48 个。 

相比上面的第二个示例，此管理模型存在一定的优势。 但是，重要差别在于，限制不是一个很大的问题，因为虚拟网络分散在两个*订阅*之间。 缺点是，必须跨所有三个*订阅*聚合按标记跟踪的成本数据。 

因此，可以根据要求的优先级选择这两个示例资源管理模型中的任何一个。 如果你预见到组织不会达到单个订阅的服务限制，则可以使用包含多个资源组的单个订阅。 相反，如果预计组织中会出现许多工作负载，则对每个环境使用多个订阅可能会更好。

## <a name="implementing-the-resource-management-model"></a>实现资源管理模型

你已了解用于治理 Azure 资源访问权限的多个不同模型。 现在，让我们执行所需的每个步骤，针对设计指南中的每个**共享基础结构**、**生产**和**开发**环境，实施包含一个订阅的资源管理模型。 我们将为所有三个环境创建一个**订阅所有者**。 每个工作负荷将在某个**资源组**中隔离，该资源组包含具有**参与者**角色的**工作负荷所有者**。

> [!NOTE]
> 请阅读[了解 Azure 中的资源访问][understand-resource-access-in-azure]，详细了解 Azure 帐户与订阅之间的关系。 

执行以下步骤:

1. 如果组织没有 [Azure 帐户](/azure/active-directory/sign-up-organization)，请创建一个帐户。 注册 Azure 帐户的人员将成为 Azure 帐户管理员，组织的领导层必须选择一个充当此角色的人员。 此人将会负责：
    * 创建订阅，以及
    * 创建和管理用于存储这些订阅的用户标识的 [Azure Active Directory (AD)](/azure/active-directory/active-directory-whatis) 租户。    
2. 组织领导团队确定哪个人员承担以下责任：
    * 管理用户标识；创建组织的 Azure 帐户时，默认会创建 [Azure AD 租户](/azure/active-directory/develop/active-directory-howto-tenant)，并且默认会将帐户管理员添加为 [Azure AD 全局管理员](/azure/active-directory/active-directory-assign-admin-roles-azure-portal#details-about-the-global-administrator-role)。 组织可以选择另一个用户来管理用户标识，只需[将 Azure AD 全局管理员角色分配到该用户](/azure/active-directory/active-directory-users-assign-role-azure-portal)即可。 
    * 订阅，表示这些用户将负责：
        * 管理与该订阅中的资源用量相关的成本；
        * 实现和维护用于资源访问的最低权限模型；
        * 跟踪服务限制。
    * 共享基础结构服务（如果组织决定使用此模型），表示此用户将负责：
        * 建立本地到 Azure 的网络连接，以及 
        * 通过虚拟网络对等互连管理 Azure 中的网络连接。
    * 工作负荷所有者。 
3. Azure AD 全局管理员为以下人员[创建新用户帐户](/azure/active-directory/add-users-azure-active-directory)：
    * 与每个环境关联的每个订阅的**订阅所有者**。 请注意，仅当订阅**服务管理员**的任务不包括管理每个订阅/环境的资源访问权限时，才需要创建帐户。
    * **网络操作用户**，以及
    * **工作负荷所有者**。
4. Azure 帐户管理员可以使用 [Azure 帐户门户](https://account.azure.com)创建以下三个订阅：
    * **共享基础结构**环境的订阅；
    * **生产**环境的订阅； 
    * **开发**环境的订阅。 
5. Azure 帐户管理员[将订阅服务所有者添加到每个订阅](/azure/billing/billing-add-change-azure-subscription-administrator#add-an-rbac-owner-admin-for-a-subscription-in-azure-portal)。
6. 为**工作负荷所有者**创建审批过程，以请求创建资源组。 可通过许多方式实施审批过程，例如，通过电子邮件，或者使用 [Sharepoint 工作流](https://support.office.com/article/introduction-to-sharepoint-workflow-07982276-54e8-4e17-8699-5056eff4d9e3)等过程管理工具。 审批过程可以遵循以下步骤：  
    * **工作负荷所有者**为**开发**环境和/或**生产**环境中的所需 Azure 资源准备物料清单，并将其提交给**订阅所有者**。
    * **订阅所有者**审查物料清单并验证请求的资源，以确保请求的资源适合规划的用途 - 例如，检查请求的[虚拟机大小](/azure/virtual-machines/windows/sizes)是否正确。
    * 如果请求未获批准，则会通知**工作负荷所有者**。 如果请求获批准，**订阅所有者**将遵循组织的[命名约定](/azure/architecture/best-practices/naming-conventions)[创建请求的资源组](/azure/azure-resource-manager/resource-group-portal#manage-resource-groups)，添加具有[**参与者**角色](/azure/role-based-access-control/built-in-roles#contributor)的[**工作负荷所有者**](/azure/role-based-access-control/role-assignments-portal#add-access)，并通知**工作负荷所有者**已创建资源组。
7. 为工作负荷所有者创建审批过程，以请求共享基础结构所有者建立虚拟网络对等连接。 与前面的步骤一样，可以使用电子邮件或过程管理工具来实施此审批过程。

实施治理模型后，可以部署共享基础结构服务。

## <a name="next-steps"></a>后续步骤
> [!div class="nextstepaction"]
> [了解如何部署基本的基础结构](../infrastructure/basic-workload.md)

<!-- links -->
[understand-resource-access-in-azure]: /azure/role-based-access-control/rbac-and-directory-admin-roles

<!-- links -->

[rbac-built-in-owner]: /azure/role-based-access-control/built-in-roles#owner
[rbac-built-in-roles]: /azure/role-based-access-control/built-in-roles
