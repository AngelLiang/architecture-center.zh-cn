---
title: Azure 应用程序的故障和灾难恢复
description: 在 Azure 中概述的灾难恢复方法
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: f00341b06b8092c798d6260317226190cbace66b
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646494"
---
# <a name="failure-and-disaster-recovery-for-azure-applications"></a><span data-ttu-id="68218-103">Azure 应用程序的故障和灾难恢复</span><span class="sxs-lookup"><span data-stu-id="68218-103">Failure and disaster recovery for Azure applications</span></span>

<span data-ttu-id="68218-104">*灾难恢复*是还原应用程序中的灾难性损失唤醒功能的过程。</span><span class="sxs-lookup"><span data-stu-id="68218-104">*Disaster recovery* is the process of restoring application functionality in the wake of a catastrophic loss.</span></span>

<span data-ttu-id="68218-105">发生灾难期间降低的功能的容忍程度是从到下一个应用程序而异的业务决策。</span><span class="sxs-lookup"><span data-stu-id="68218-105">Your tolerance for reduced functionality during a disaster is a business decision that varies from one application to the next.</span></span> <span data-ttu-id="68218-106">它可能是可接受的某些应用程序是完全不可用或部分可用并且具有降低的功能，或者延迟一段时间的处理。</span><span class="sxs-lookup"><span data-stu-id="68218-106">It might be acceptable for some applications to be completely unavailable or to be partially available with reduced functionality or delayed processing for a period of time.</span></span> <span data-ttu-id="68218-107">对于其他应用程序，任何缩减的功能是不可接受的。</span><span class="sxs-lookup"><span data-stu-id="68218-107">For other applications, any reduced functionality is unacceptable.</span></span>

## <a name="disaster-recovery-plan"></a><span data-ttu-id="68218-108">灾难恢复计划</span><span class="sxs-lookup"><span data-stu-id="68218-108">Disaster recovery plan</span></span>

<span data-ttu-id="68218-109">首先创建恢复计划。</span><span class="sxs-lookup"><span data-stu-id="68218-109">Start by creating a recovery plan.</span></span> <span data-ttu-id="68218-110">经过充分测试后，该计划被视为完成。</span><span class="sxs-lookup"><span data-stu-id="68218-110">The plan is considered complete after it has been fully tested.</span></span> <span data-ttu-id="68218-111">包括人员、 流程和还原中已为你的客户定义的服务级别协议 (SLA) 的功能所需的应用程序。</span><span class="sxs-lookup"><span data-stu-id="68218-111">Include the people, processes, and applications needed to restore functionality within the service-level agreement (SLA) you've defined for your customers.</span></span>

<span data-ttu-id="68218-112">请考虑以下建议在创建和测试灾难恢复计划时：</span><span class="sxs-lookup"><span data-stu-id="68218-112">Consider the following suggestions when creating and testing your disaster recovery plan:</span></span>

- <span data-ttu-id="68218-113">在计划中，包括与支持部门联系以及升级事务的过程。</span><span class="sxs-lookup"><span data-stu-id="68218-113">In your plan, include the process for contacting support and for escalating issues.</span></span> <span data-ttu-id="68218-114">此信息将有助于避免长时间的停机时间，因为第一次解决恢复过程。</span><span class="sxs-lookup"><span data-stu-id="68218-114">This information will help to avoid prolonged downtime as you work out the recovery process for the first time.</span></span>
- <span data-ttu-id="68218-115">评估应用程序故障造成的业务影响。</span><span class="sxs-lookup"><span data-stu-id="68218-115">Evaluate the business impact of application failures.</span></span>
- <span data-ttu-id="68218-116">选择用于关键任务应用程序的跨区域恢复体系结构。</span><span class="sxs-lookup"><span data-stu-id="68218-116">Choose a cross-region recovery architecture for mission-critical applications.</span></span>
- <span data-ttu-id="68218-117">标识包括自动化和测试在内的灾难恢复计划的特定所有者。</span><span class="sxs-lookup"><span data-stu-id="68218-117">Identify a specific owner of the disaster recovery plan, including automation and testing.</span></span>
- <span data-ttu-id="68218-118">记录的过程，尤其是任何手动步骤。</span><span class="sxs-lookup"><span data-stu-id="68218-118">Document the process, especially any manual steps.</span></span>
- <span data-ttu-id="68218-119">自动执行尽可能多地过程。</span><span class="sxs-lookup"><span data-stu-id="68218-119">Automate the process as much as possible.</span></span>
- <span data-ttu-id="68218-120">定期建立的所有引用和事务数据和测试备份还原的备份策略。</span><span class="sxs-lookup"><span data-stu-id="68218-120">Establish a backup strategy for all reference and transactional data, and test backup restoration regularly.</span></span>
- <span data-ttu-id="68218-121">设置您的应用程序所使用的 Azure 服务堆栈的警报。</span><span class="sxs-lookup"><span data-stu-id="68218-121">Set up alerts for the stack of the Azure services consumed by your application.</span></span>
- <span data-ttu-id="68218-122">培训操作人员执行计划。</span><span class="sxs-lookup"><span data-stu-id="68218-122">Train operations staff to execute the plan.</span></span>
- <span data-ttu-id="68218-123">执行常规灾难模拟以验证并改进计划。</span><span class="sxs-lookup"><span data-stu-id="68218-123">Perform regular disaster simulations to validate and improve the plan.</span></span>

<span data-ttu-id="68218-124">如果您使用的[Azure Site Recovery](/azure/site-recovery/)若要复制的虚拟机 (Vm)，创建完全自动的恢复计划故障转移整个应用程序。</span><span class="sxs-lookup"><span data-stu-id="68218-124">If you're using [Azure Site Recovery](/azure/site-recovery/) to replicate virtual machines (VMs), create a fully automated recovery plan to fail over the entire application.</span></span>

## <a name="manual-responses"></a><span data-ttu-id="68218-125">手动响应</span><span class="sxs-lookup"><span data-stu-id="68218-125">Manual responses</span></span>

<span data-ttu-id="68218-126">尽管自动化是理想之选，但某些灾难恢复策略将需要手动响应。</span><span class="sxs-lookup"><span data-stu-id="68218-126">Although automation is ideal, some strategies for disaster recovery require manual responses.</span></span>

### <a name="alerts"></a><span data-ttu-id="68218-127">警报</span><span class="sxs-lookup"><span data-stu-id="68218-127">Alerts</span></span>

<span data-ttu-id="68218-128">监视应用程序中是否出现了可能需要主动干预的警示。</span><span class="sxs-lookup"><span data-stu-id="68218-128">Monitor your application for warning signs that may require proactive intervention.</span></span> <span data-ttu-id="68218-129">例如，如果 Azure SQL 数据库或 Azure Cosmos DB 在不断地限制应用程序，您可能需要增大数据库容量或优化查询。</span><span class="sxs-lookup"><span data-stu-id="68218-129">For example, if Azure SQL Database or Azure Cosmos DB consistently throttles your application, you might need to increase your database capacity or optimize your queries.</span></span> <span data-ttu-id="68218-130">即使应用程序可能会以透明方式处理限制错误，遥测也仍应该引发警报，以便能够跟进。</span><span class="sxs-lookup"><span data-stu-id="68218-130">Even though the application might handle the throttling errors transparently, your telemetry should still raise an alert so that you can follow up.</span></span>

<span data-ttu-id="68218-131">有关服务限制和配额阈值，我们建议对 Azure 资源指标和诊断日志配置警报。</span><span class="sxs-lookup"><span data-stu-id="68218-131">For service limits and quota thresholds, we recommend configuring alerts on Azure resources metrics and diagnostics logs.</span></span> <span data-ttu-id="68218-132">如果可能，请设置指标，将延迟低于诊断日志的警报。</span><span class="sxs-lookup"><span data-stu-id="68218-132">When possible, set up alerts on metrics, which are lower latency than diagnostics logs.</span></span>

<span data-ttu-id="68218-133">通过 [资源运行状况](/azure/service-health/resource-health-checks-resource-types)，Azure 提供了一些内置的运行状况状态检查可帮助你诊断 Azure 服务限制问题。</span><span class="sxs-lookup"><span data-stu-id="68218-133">Through [Resource Health](/azure/service-health/resource-health-checks-resource-types), Azure provides some built-in health status checks that can help you diagnose Azure service throttling issues.</span></span>

### <a name="failover"></a><span data-ttu-id="68218-134">故障转移</span><span class="sxs-lookup"><span data-stu-id="68218-134">Failover</span></span>

<span data-ttu-id="68218-135">配置每个 Azure 应用程序和其 Azure 服务的灾难恢复策略。</span><span class="sxs-lookup"><span data-stu-id="68218-135">Configure a disaster recovery strategy for each Azure application and its Azure services.</span></span> <span data-ttu-id="68218-136">可接受的部署策略，以支持灾难恢复可能会因所需的所有组件的每个应用程序的 Sla。</span><span class="sxs-lookup"><span data-stu-id="68218-136">Acceptable deployment strategies to support disaster recovery may vary based on the SLAs required for all components of each application.</span></span>  

<span data-ttu-id="68218-137">Azure 提供不同功能在许多 Azure 服务中以允许为手动故障转移，如 [redis 缓存地域副本](/azure/azure-cache-for-redis/cache-how-to-geo-replication)，或为自动故障转移，如 [SQL 自动故障转移组](/azure/sql-database/sql-database-auto-failover-group)。</span><span class="sxs-lookup"><span data-stu-id="68218-137">Azure provides different features within many Azure services to allow for manual failover, such as [redis cache geo-replicas](/azure/azure-cache-for-redis/cache-how-to-geo-replication), or for automated failover, such as [SQL auto-failover groups](/azure/sql-database/sql-database-auto-failover-group).</span></span> <span data-ttu-id="68218-138">例如：</span><span class="sxs-lookup"><span data-stu-id="68218-138">For example:</span></span>

- <span data-ttu-id="68218-139">对于主要使用虚拟机的应用程序，可以为 web 应用和逻辑层使用 Azure Site Recovery。</span><span class="sxs-lookup"><span data-stu-id="68218-139">For an application that mainly uses virtual machines, you can use Azure Site Recovery for the web and logic tiers.</span></span> <span data-ttu-id="68218-140">有关详细信息，请参阅[Azure 到 Azure 灾难恢复体系结构](/azure/site-recovery/azure-to-azure-architecture)。</span><span class="sxs-lookup"><span data-stu-id="68218-140">For more information, see [Azure to Azure disaster recovery architecture](/azure/site-recovery/azure-to-azure-architecture).</span></span> <span data-ttu-id="68218-141">对于 Vm 上的 SQL Server，请使用[SQL Server Always On 可用性组](/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-dr)。</span><span class="sxs-lookup"><span data-stu-id="68218-141">For SQL Server on VMs, use [SQL Server Always On availability groups](/azure/virtual-machines/windows/sql/virtual-machines-windows-portal-sql-availability-group-dr).</span></span>
- <span data-ttu-id="68218-142">对于使用应用服务和 Azure SQL 数据库的应用程序，可以使用较小的层应用服务计划配置在次要区域发生故障转移时哪些措施。</span><span class="sxs-lookup"><span data-stu-id="68218-142">For an application that uses App Service and Azure SQL Database, you can use a smaller tier App Service plan configured in the secondary region, which autoscales when a failover occurs.</span></span> <span data-ttu-id="68218-143">对数据库层使用故障转移组。</span><span class="sxs-lookup"><span data-stu-id="68218-143">Use failover groups for the database tier.</span></span>

<span data-ttu-id="68218-144">在任一方案中， [Azure 流量管理器](/azure/traffic-manager/traffic-manager-overview) 跨区域提供自动故障转移配置文件。</span><span class="sxs-lookup"><span data-stu-id="68218-144">In either scenario, an [Azure Traffic Manager](/azure/traffic-manager/traffic-manager-overview) profile provides for the automated failover across regions.</span></span> <span data-ttu-id="68218-145">[负载均衡器](/azure/load-balancer/load-balancer-overview)或 [应用程序网关](/azure/application-gateway/overview) 应设置次要区域中来支持更快故障转移时的可用性。</span><span class="sxs-lookup"><span data-stu-id="68218-145">[Load balancers](/azure/load-balancer/load-balancer-overview) or [application gateways](/azure/application-gateway/overview) should be set up in the secondary region to support faster availability upon failover.</span></span>

### <a name="operational-readiness-testing"></a><span data-ttu-id="68218-146">操作就绪性测试</span><span class="sxs-lookup"><span data-stu-id="68218-146">Operational readiness testing</span></span>

<span data-ttu-id="68218-147">针对故障转移到次要区域和故障回复到主要区域，请执行操作就绪性测试。</span><span class="sxs-lookup"><span data-stu-id="68218-147">Perform an operational readiness test for failover to the secondary region and for failback to the primary region.</span></span> <span data-ttu-id="68218-148">许多 Azure 服务支持通过手动故障转移或测试性故障转移进行灾难恢复演练。</span><span class="sxs-lookup"><span data-stu-id="68218-148">Many Azure services support manual failover or test failover for disaster recovery drills.</span></span> <span data-ttu-id="68218-149">或者，你可以通过关闭或删除 Azure 服务模拟服务中断。</span><span class="sxs-lookup"><span data-stu-id="68218-149">Alternatively, you can simulate an outage by shutting down or removing Azure services.</span></span>

## <a name="application-failure"></a><span data-ttu-id="68218-150">应用程序故障</span><span class="sxs-lookup"><span data-stu-id="68218-150">Application failure</span></span>

<span data-ttu-id="68218-151">应用程序故障是可恢复或不可恢复。</span><span class="sxs-lookup"><span data-stu-id="68218-151">Application failures are either recoverable or nonrecoverable.</span></span> <span data-ttu-id="68218-152">您可以缓解可恢复的错误，但不可恢复的错误会使应用程序停止。</span><span class="sxs-lookup"><span data-stu-id="68218-152">You can mitigate a recoverable error, but nonrecoverable errors will bring down the application.</span></span>

- <span data-ttu-id="68218-153">可以通过自动处理故障并采取备用措施以透明方式解决一些失败。</span><span class="sxs-lookup"><span data-stu-id="68218-153">Some failures can be addressed transparently by handling faults automatically and taking alternate actions.</span></span> <span data-ttu-id="68218-154">例如，流量管理器会自动处理主机虚拟机中的底层硬件或操作系统软件导致失败。</span><span class="sxs-lookup"><span data-stu-id="68218-154">For example, Traffic Manager automatically handles failures that result from the underlying hardware or operating system software in the host virtual machine.</span></span>
- <span data-ttu-id="68218-155">但出现一些错误，应用程序可以继续处理用户请求，并降低的功能。</span><span class="sxs-lookup"><span data-stu-id="68218-155">With some errors, the application can continue handling user requests with reduced functionality.</span></span>
- <span data-ttu-id="68218-156">更严重的服务中断可能会使应用程序不可用。</span><span class="sxs-lookup"><span data-stu-id="68218-156">More severe service disruptions might render the application unavailable.</span></span>

<span data-ttu-id="68218-157">设计良好的系统将在服务级别的职责分隔开来&mdash;在设计时和运行时。</span><span class="sxs-lookup"><span data-stu-id="68218-157">A well-designed system separates responsibilities at the service level &mdash; at design time and at runtime.</span></span> <span data-ttu-id="68218-158">这种分离可防止中断导致整个应用程序依赖的服务中断。</span><span class="sxs-lookup"><span data-stu-id="68218-158">This separation prevents a dependent service disruption from bringing down the entire application.</span></span> <span data-ttu-id="68218-159">例如，考虑以下模块与 web 电子商务应用程序：</span><span class="sxs-lookup"><span data-stu-id="68218-159">For example, consider a web commerce application with the following modules:</span></span>

![将链接添加到艺术](./_images/disaster-recovery.png)

<span data-ttu-id="68218-161">如果托管订单数据库出现故障，订单处理服务无法处理销售事务。</span><span class="sxs-lookup"><span data-stu-id="68218-161">If the database for hosting orders goes down, the Order Processing service can't process sales transactions.</span></span> <span data-ttu-id="68218-162">根据体系结构，它可能是不可能为订单提交和订单处理服务，以继续。</span><span class="sxs-lookup"><span data-stu-id="68218-162">Depending on the architecture, it might be impossible for the Order Submission and Order Processing services to continue.</span></span> <span data-ttu-id="68218-163">但是，如果产品数据存储在不同的位置中，产品目录是仍然可用，即使应用程序的其他部分可能不可用。</span><span class="sxs-lookup"><span data-stu-id="68218-163">However, if product data is stored in a different location, the Product Catalog is still available, even though other parts of the application might be unavailable.</span></span>

<span data-ttu-id="68218-164">由你来确定应用程序将如何通知用户的所有临时问题并生成到系统的相应通知。</span><span class="sxs-lookup"><span data-stu-id="68218-164">It's up to you to determine how the application will inform users of any temporary problems and to build appropriate notifications into the system.</span></span> <span data-ttu-id="68218-165">在上一示例中，应用程序可能允许查看产品以及将它们添加到购物车。</span><span class="sxs-lookup"><span data-stu-id="68218-165">In the previous example, the application might allow for viewing products and for adding them to a shopping cart.</span></span> <span data-ttu-id="68218-166">但是，当客户尝试进行购买，应用程序应通知订购功能是暂时不可用。</span><span class="sxs-lookup"><span data-stu-id="68218-166">However, when the customer attempts to make a purchase, the application should notify them that the ordering functionality is temporarily unavailable.</span></span> <span data-ttu-id="68218-167">尽管不适合客户，这种方法可以防止应用程序范围的服务中断。</span><span class="sxs-lookup"><span data-stu-id="68218-167">Although not ideal for the customer, this approach prevents an application-wide service disruption.</span></span>

## <a name="data-corruption-and-restoration"></a><span data-ttu-id="68218-168">数据损坏和还原</span><span class="sxs-lookup"><span data-stu-id="68218-168">Data corruption and restoration</span></span>

<span data-ttu-id="68218-169">如果数据存储区失败，可能有数据不一致时再次可用，尤其是如果复制了数据。</span><span class="sxs-lookup"><span data-stu-id="68218-169">If a data store fails, there might be data inconsistencies when it becomes available again, especially if the data was replicated.</span></span> <span data-ttu-id="68218-170">了解恢复时间目标 (RTO) 和恢复点目标 (RPO) 的复制的数据存储可以帮助您预测的数据丢失量。</span><span class="sxs-lookup"><span data-stu-id="68218-170">Understanding the recovery time objective (RTO) and recovery point objective (RPO) of replicated data stores can help you predict the amount of data loss.</span></span>

<span data-ttu-id="68218-171">若要了解跨区域故障转移是否已启动手动或通过 Microsoft，查看 Azure 服务 Sla。</span><span class="sxs-lookup"><span data-stu-id="68218-171">To understand whether the cross-regional failover is started manually or by Microsoft, review the Azure service SLAs.</span></span> <span data-ttu-id="68218-172">对于与没有相应的 Sla 跨区域故障转移的服务，Microsoft 通常决定何时将故障转移，并通常优先恢复主要区域中的数据。</span><span class="sxs-lookup"><span data-stu-id="68218-172">For services with no SLAs for cross-regional failover, Microsoft typically decides when to fail over and usually prioritizes recovery of data in the primary region.</span></span> <span data-ttu-id="68218-173">如果主要区域中的数据被视为不可恢复，Microsoft 故障转移到次要区域。</span><span class="sxs-lookup"><span data-stu-id="68218-173">If data in the primary region is deemed unrecoverable, Microsoft fails over to the secondary region.</span></span>

### <a name="restoring-data-from-backups"></a><span data-ttu-id="68218-174">从备份还原数据</span><span class="sxs-lookup"><span data-stu-id="68218-174">Restoring data from backups</span></span>

<span data-ttu-id="68218-175">备份保护您免受因意外删除或数据损坏导致的应用程序组件的丢失。</span><span class="sxs-lookup"><span data-stu-id="68218-175">Backups protect you from losing a component of the application because of accidental deletion or data corruption.</span></span> <span data-ttu-id="68218-176">它们保留从较早的时间，可用于将其还原组件的功能版本。</span><span class="sxs-lookup"><span data-stu-id="68218-176">They preserve a functional version of the component from an earlier time, which you can use to restore it.</span></span>

<span data-ttu-id="68218-177">灾难恢复策略也不能取代对于备份，但定期备份应用程序数据支持某些灾难恢复方案。</span><span class="sxs-lookup"><span data-stu-id="68218-177">Disaster recovery strategies are not a replacement for backups, but regular backups of application data support some disaster recovery scenarios.</span></span> <span data-ttu-id="68218-178">备份存储选项应基于您的灾难恢复策略。</span><span class="sxs-lookup"><span data-stu-id="68218-178">Your backup storage choices should be based on your disaster recovery strategy.</span></span>

<span data-ttu-id="68218-179">运行备份过程的频率决定 RPO。</span><span class="sxs-lookup"><span data-stu-id="68218-179">The frequency of running the backup process determines your RPO.</span></span> <span data-ttu-id="68218-180">例如，如果执行每小时备份，而灾难发生在备份之前两分钟，你将失去 58 分钟的数据。</span><span class="sxs-lookup"><span data-stu-id="68218-180">For example, if you perform hourly backups and a disaster occurs two minutes before the backup, you will lose 58 minutes of data.</span></span> <span data-ttu-id="68218-181">灾难恢复计划应包括将如何处理丢失的数据。</span><span class="sxs-lookup"><span data-stu-id="68218-181">Your disaster recovery plan should include how you will address lost data.</span></span>

<span data-ttu-id="68218-182">它是常见的一种数据存储到另一个存储中的引用数据中的数据。</span><span class="sxs-lookup"><span data-stu-id="68218-182">It's common for data in one data store to reference data in another store.</span></span> <span data-ttu-id="68218-183">例如，考虑具有一列的 SQL 数据库链接到 Azure 存储中的 blob。</span><span class="sxs-lookup"><span data-stu-id="68218-183">For example, consider a SQL Database with a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="68218-184">如果备份不会同时发生，数据库可能有一个指针指向在发生故障之前未备份的 blob。</span><span class="sxs-lookup"><span data-stu-id="68218-184">If backups don't happen simultaneously, the database might have a pointer to a blob that wasn't backed up before the failure.</span></span> <span data-ttu-id="68218-185">应用程序或灾难恢复计划必须实现过程来恢复之后处理这种不一致。</span><span class="sxs-lookup"><span data-stu-id="68218-185">The application or the disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>

> [!NOTE]
> <span data-ttu-id="68218-186">在某些情况下，例如，使用备份的 Vm [Azure 备份](/azure/backup/backup-azure-vms-first-look-arm)，可以仅从同一区域中的备份还原。</span><span class="sxs-lookup"><span data-stu-id="68218-186">In some scenarios, such as that of VMs backed up using [Azure Backup](/azure/backup/backup-azure-vms-first-look-arm), you can restore only from a backup in the same region.</span></span> <span data-ttu-id="68218-187">其他 Azure 服务，如[适用于 Redis 的 Azure 缓存](/azure/azure-cache-for-redis/cache-how-to-geo-replication)，提供异地复制的备份，可以使用跨区域还原服务。</span><span class="sxs-lookup"><span data-stu-id="68218-187">Other Azure services, such as [Azure Cache for Redis](/azure/azure-cache-for-redis/cache-how-to-geo-replication), provide geo-replicated backups, which you can use to restore services across regions.</span></span>

### <a name="azure-storage-and-azure-sql-database"></a><span data-ttu-id="68218-188">Azure 存储和 Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="68218-188">Azure Storage and Azure SQL Database</span></span>

<span data-ttu-id="68218-189">Azure 自动将三次不同的容错域中的 Azure 存储和 SQL 数据库数据存储在同一区域中。</span><span class="sxs-lookup"><span data-stu-id="68218-189">Azure automatically stores Azure Storage and SQL Database data three times within different fault domains in the same region.</span></span> <span data-ttu-id="68218-190">如果使用异地复制，则再将这些数据在另一个区域内存储三次。</span><span class="sxs-lookup"><span data-stu-id="68218-190">If you use geo-replication, the data is stored three additional times in a different region.</span></span> <span data-ttu-id="68218-191">但是，如果数据已损坏，或在主要副本中删除 （例如，由于用户错误），所做的更改复制到其他副本。</span><span class="sxs-lookup"><span data-stu-id="68218-191">However, if the data is corrupted or deleted in the primary copy (for example, because of user error), the changes replicate to the other copies.</span></span>

<span data-ttu-id="68218-192">具有用于管理潜在数据损坏或删除的两个选项：</span><span class="sxs-lookup"><span data-stu-id="68218-192">You have two options for managing potential data corruption or deletion:</span></span>

- <span data-ttu-id="68218-193">**创建自定义备份策略。**</span><span class="sxs-lookup"><span data-stu-id="68218-193">**Create a custom backup strategy.**</span></span> <span data-ttu-id="68218-194">您可以将备份存储在 Azure 或本地，具体取决于你的业务要求和治理监管。</span><span class="sxs-lookup"><span data-stu-id="68218-194">You can store your backups in Azure or on-premises, depending on your business requirements and governance regulations.</span></span>
- <span data-ttu-id="68218-195">**使用时间点还原选项**来恢复 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="68218-195">**Use the point-in-time restore option** to recover a SQL Database.</span></span>

#### <a name="azure-storage-recovery"></a><span data-ttu-id="68218-196">Azure 存储恢复</span><span class="sxs-lookup"><span data-stu-id="68218-196">Azure Storage recovery</span></span>

<span data-ttu-id="68218-197">可以为 Azure 存储开发自定义备份过程，也可以使用许多第三方备份工具之一。</span><span class="sxs-lookup"><span data-stu-id="68218-197">You can develop a custom backup process for Azure Storage or use one of many third-party backup tools.</span></span>

<span data-ttu-id="68218-198">Azure 存储提供数据复原能力，通过自动化副本，但它不会阻止应用程序代码或用户会损坏数据。</span><span class="sxs-lookup"><span data-stu-id="68218-198">Azure Storage provides data resiliency through automated replicas, but it doesn't prevent application code or users from corrupting data.</span></span> <span data-ttu-id="68218-199">保持数据保真应用程序或用户错误后的需要更高级的技术，如将数据复制到辅助存储位置和审核日志。</span><span class="sxs-lookup"><span data-stu-id="68218-199">Maintaining data fidelity after application or user error requires more advanced techniques, such as copying the data to a secondary storage location with an audit log.</span></span> <span data-ttu-id="68218-200">有几种选项：</span><span class="sxs-lookup"><span data-stu-id="68218-200">You have several options:</span></span>

- [<span data-ttu-id="68218-201">**块 blob。**</span><span class="sxs-lookup"><span data-stu-id="68218-201">**Block blobs.**</span></span>](/rest/api/storageservices/understanding-block-blobs--append-blobs--and-page-blobs) <span data-ttu-id="68218-202">创建每个块 Blob 的时间点快照。</span><span class="sxs-lookup"><span data-stu-id="68218-202">Create a point-in-time snapshot of each block blob.</span></span> <span data-ttu-id="68218-203">对于每个快照，则收取仅用于存储自上一快照状态以来 blob 内的更改所需的存储。</span><span class="sxs-lookup"><span data-stu-id="68218-203">For each snapshot, you are charged only for the storage required to store the differences within the blob since the previous snapshot state.</span></span> <span data-ttu-id="68218-204">因此，我们建议将复制到另一个 blob，或甚至另一个存储帐户时，依赖于原始 blob 快照。</span><span class="sxs-lookup"><span data-stu-id="68218-204">The snapshots are dependent on the original blob, so we recommend copying to another blob or even to another storage account.</span></span> <span data-ttu-id="68218-205">此方法可确保保护备份数据不受意外删除。</span><span class="sxs-lookup"><span data-stu-id="68218-205">This approach ensures that backup data is protected against accidental deletion.</span></span> <span data-ttu-id="68218-206">使用[AzCopy](/azure/storage/common/storage-use-azcopy)或[Azure PowerShell](/azure/storage/common/storage-powershell-guide-full)将 blob 复制到另一个存储帐户。</span><span class="sxs-lookup"><span data-stu-id="68218-206">Use [AzCopy](/azure/storage/common/storage-use-azcopy) or [Azure PowerShell](/azure/storage/common/storage-powershell-guide-full) to copy the blobs to another storage account.</span></span>

    <span data-ttu-id="68218-207">有关详细信息，请参阅 [Creating a Snapshot of a Blob](/rest/api/storageservices/creating-a-snapshot-of-a-blob)（创建 Blob 的快照）。</span><span class="sxs-lookup"><span data-stu-id="68218-207">For more information, see [Creating a Snapshot of a Blob](/rest/api/storageservices/creating-a-snapshot-of-a-blob).</span></span>

- [<span data-ttu-id="68218-208">**Azure 文件。**</span><span class="sxs-lookup"><span data-stu-id="68218-208">**Azure Files.**</span></span>](/azure/storage/files/storage-files-introduction) <span data-ttu-id="68218-209">使用[共享快照](/azure/storage/files/storage-snapshots-files)，AzCopy 或 PowerShell 将文件复制到另一个存储帐户。</span><span class="sxs-lookup"><span data-stu-id="68218-209">Use [share snapshots](/azure/storage/files/storage-snapshots-files), AzCopy, or PowerShell to copy your files to another storage account.</span></span>
- [<span data-ttu-id="68218-210">**Azure 表存储。**</span><span class="sxs-lookup"><span data-stu-id="68218-210">**Azure Table storage.**</span></span>](/azure/storage/tables/table-storage-overview) <span data-ttu-id="68218-211">使用 AzCopy 将表数据导出到其他区域中的其他存储帐户。</span><span class="sxs-lookup"><span data-stu-id="68218-211">Use AzCopy to export the table data into another storage account in another region.</span></span>

#### <a name="sql-database-recovery"></a><span data-ttu-id="68218-212">SQL 数据库恢复</span><span class="sxs-lookup"><span data-stu-id="68218-212">SQL Database recovery</span></span>

<span data-ttu-id="68218-213">若要从数据丢失，SQL 数据库自动保护你的业务执行完整数据库备份的组合每周、 每小时、 差异数据库备份和事务日志备份每 5 到 10 分钟。</span><span class="sxs-lookup"><span data-stu-id="68218-213">To protect your business from data loss, SQL Database automatically performs a combination of full database backups weekly, differential database backups hourly, and transaction log backups every 5 to 10 minutes.</span></span> <span data-ttu-id="68218-214">对于基本、 标准和高级 SQL 数据库层中，使用时间点还原到还原到较早的时间的数据库。</span><span class="sxs-lookup"><span data-stu-id="68218-214">For the Basic, Standard, and Premium SQL Database tiers, use point-in-time restore to restore a database to an earlier time.</span></span> <span data-ttu-id="68218-215">有关详细信息，请参阅以下文章：</span><span class="sxs-lookup"><span data-stu-id="68218-215">See the following articles for more information:</span></span>

- [<span data-ttu-id="68218-216">使用自动数据库备份恢复 Azure SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="68218-216">Recover an Azure SQL database using automated database backups</span></span>](/azure/sql-database/sql-database-recovery-using-backups)
- [<span data-ttu-id="68218-217">使用 Azure SQL 数据库确保业务连续性的相关概述</span><span class="sxs-lookup"><span data-stu-id="68218-217">Overview of business continuity with Azure SQL Database</span></span>](/azure/sql-database/sql-database-business-continuity)

<span data-ttu-id="68218-218">另一种选择是要用于自动将数据库更改复制到相同或不同 Azure 区域中的辅助数据库的 SQL 数据库活动异地复制。</span><span class="sxs-lookup"><span data-stu-id="68218-218">Another option is to use active geo-replication for SQL Database, which automatically replicates database changes to secondary databases in the same or different Azure region.</span></span> <span data-ttu-id="68218-219">有关详细信息，请参阅[创建和使用活动异地复制](/azure/sql-database/sql-database-active-geo-replication)。</span><span class="sxs-lookup"><span data-stu-id="68218-219">For more information, see [Creating and using active geo-replication](/azure/sql-database/sql-database-active-geo-replication).</span></span>

<span data-ttu-id="68218-220">您还可以使用手动程度更高的方法进行备份和还原：</span><span class="sxs-lookup"><span data-stu-id="68218-220">You can also use a more manual approach for backup and restore:</span></span>

- <span data-ttu-id="68218-221">使用**数据库复制**命令以创建事务上一致的数据库的备份副本。</span><span class="sxs-lookup"><span data-stu-id="68218-221">Use the **DATABASE COPY** command to create a backup copy of the database with transactional consistency.</span></span>
- <span data-ttu-id="68218-222">使用 Azure SQL 数据库导入/导出服务，它支持将数据库导出到 BACPAC 文件 （包含数据库架构和关联的数据压缩文件） 存储在 Azure Blob 存储中。</span><span class="sxs-lookup"><span data-stu-id="68218-222">Use the Azure SQL Database Import/Export Service, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span> <span data-ttu-id="68218-223">若要防止区域范围的服务中断，可将 BACPAC 文件复制到备用区域。</span><span class="sxs-lookup"><span data-stu-id="68218-223">To protect against a region-wide service disruption, copy the BACPAC files to an alternate region.</span></span>

### <a name="sql-server-on-vms"></a><span data-ttu-id="68218-224">VM 上的 SQL Server</span><span class="sxs-lookup"><span data-stu-id="68218-224">SQL Server on VMs</span></span>

<span data-ttu-id="68218-225">对于在 Vm 上运行的 SQL Server，有两个选项： 传统备份和日志传送。</span><span class="sxs-lookup"><span data-stu-id="68218-225">For SQL Server running on VMs, you have two options: traditional backups and log shipping.</span></span>

- <span data-ttu-id="68218-226">与传统的备份，可以还原到某个特定点的时间，但恢复过程较慢。</span><span class="sxs-lookup"><span data-stu-id="68218-226">With traditional backups, you can restore to a specific point in time, but the recovery process is slow.</span></span> <span data-ttu-id="68218-227">还原传统备份要求先进行初始的完整备份，然后将应用所有增量备份。</span><span class="sxs-lookup"><span data-stu-id="68218-227">Restoring traditional backups requires that you start with an initial full backup and then apply any incremental backups.</span></span>
- <span data-ttu-id="68218-228">你可以配置日志传送会话，延迟日志备份的还原。</span><span class="sxs-lookup"><span data-stu-id="68218-228">You can configure a log shipping session to delay the restore of log backups.</span></span> <span data-ttu-id="68218-229">这提供了一个窗口来从主要副本上进行的错误中恢复。</span><span class="sxs-lookup"><span data-stu-id="68218-229">This provides a window to recover from errors made on the primary replica.</span></span>

### <a name="azure-database-for-mysql-and-azure-database-for-postgresql"></a><span data-ttu-id="68218-230">Azure Database for MySQL 和 Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="68218-230">Azure Database for MySQL and Azure Database for PostgreSQL</span></span>

<span data-ttu-id="68218-231">在 Azure Database for MySQL 和 PostgreSQL 的 Azure 数据库，数据库服务每隔五分钟自动进行备份。</span><span class="sxs-lookup"><span data-stu-id="68218-231">In Azure Database for MySQL and Azure Database for PostgreSQL, the database service automatically makes a backup every five minutes.</span></span> <span data-ttu-id="68218-232">可以使用这些自动的备份还原服务器和其数据库从早的时间点的时间到新的服务器。</span><span class="sxs-lookup"><span data-stu-id="68218-232">You can use these automated backups to restore the server and its databases from an earlier point in time to a new server.</span></span> <span data-ttu-id="68218-233">有关详细信息，请参阅：</span><span class="sxs-lookup"><span data-stu-id="68218-233">For more information, see:</span></span>

- [<span data-ttu-id="68218-234">如何使用 Azure 门户在 Azure Database for MySQL 中备份和还原服务器</span><span class="sxs-lookup"><span data-stu-id="68218-234">How to back up and restore a server in Azure Database for MySQL by using the Azure portal</span></span>](/azure/mysql/howto-restore-server-portal)
- [<span data-ttu-id="68218-235">如何备份和还原使用 Azure 门户的 PostgreSQL 的 Azure 数据库中的服务器</span><span class="sxs-lookup"><span data-stu-id="68218-235">How to back up and restore a server in Azure Database for PostgreSQL using the Azure portal</span></span>](/azure/postgresql/howto-restore-server-portal)

### <a name="azure-cosmos-db"></a><span data-ttu-id="68218-236">Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="68218-236">Azure Cosmos DB</span></span>

<span data-ttu-id="68218-237">Cosmos DB 自动定期进行备份。</span><span class="sxs-lookup"><span data-stu-id="68218-237">Cosmos DB automatically makes a backup at regular intervals.</span></span> <span data-ttu-id="68218-238">备份单独存储在另一个存储服务，全球复制，以防受到区域灾难影响。</span><span class="sxs-lookup"><span data-stu-id="68218-238">Backups are stored separately in another storage service and are replicated globally to protect against regional disasters.</span></span> <span data-ttu-id="68218-239">如果意外删除了数据库或集合，可以提交支持票证或联系 Azure 支持，以便从上一次自动备份中还原数据。</span><span class="sxs-lookup"><span data-stu-id="68218-239">If you accidentally delete your database or collection, you can file a support ticket or call Azure support to restore the data from the last automatic backup.</span></span> <span data-ttu-id="68218-240">有关详细信息，请参阅[联机备份和 Azure Cosmos DB 中的按需还原](/azure/cosmos-db/online-backup-and-restore)。</span><span class="sxs-lookup"><span data-stu-id="68218-240">For more information, see [Online backup and on-demand restore in Azure Cosmos DB](/azure/cosmos-db/online-backup-and-restore).</span></span>

### <a name="azure-virtual-machines"></a><span data-ttu-id="68218-241">Azure 虚拟机</span><span class="sxs-lookup"><span data-stu-id="68218-241">Azure Virtual Machines</span></span>

<span data-ttu-id="68218-242">若要从应用程序错误或意外删除后保护 Azure 虚拟机，请使用[Azure 备份](/azure/backup/)。</span><span class="sxs-lookup"><span data-stu-id="68218-242">To protect Azure Virtual Machines from application errors or accidental deletion, use [Azure Backup](/azure/backup/).</span></span> <span data-ttu-id="68218-243">创建的备份是一致的跨多个 VM 磁盘。</span><span class="sxs-lookup"><span data-stu-id="68218-243">The created backups are consistent across multiple VM disks.</span></span> <span data-ttu-id="68218-244">此外，Azure 备份保管库可以进行跨区域以支持从区域损失恢复复制。</span><span class="sxs-lookup"><span data-stu-id="68218-244">In addition, the Azure Backup vault can be replicated across regions to support recovery from a regional loss.</span></span>

## <a name="network-outage"></a><span data-ttu-id="68218-245">网络中断</span><span class="sxs-lookup"><span data-stu-id="68218-245">Network outage</span></span>

<span data-ttu-id="68218-246">当 Azure 网络的某些部分中断时，您可能不能访问你的应用程序或数据。</span><span class="sxs-lookup"><span data-stu-id="68218-246">When parts of the Azure network are inaccessible, you might not be able to access your application or data.</span></span> <span data-ttu-id="68218-247">在这种情况下，我们建议设计灾难恢复策略，以运行大多数应用程序功能减弱。</span><span class="sxs-lookup"><span data-stu-id="68218-247">In this situation, we recommend designing the disaster recovery strategy to run most applications with reduced functionality.</span></span>

<span data-ttu-id="68218-248">如果减弱功能不会选择使用，剩余的选项将为应用程序停机时间或故障转移到备用区域。</span><span class="sxs-lookup"><span data-stu-id="68218-248">If reducing functionality isn't an option, the remaining options are application downtime or failover to an alternate region.</span></span>

<span data-ttu-id="68218-249">在缩减的功能方案中：</span><span class="sxs-lookup"><span data-stu-id="68218-249">In a reduced functionality scenario:</span></span>

- <span data-ttu-id="68218-250">如果你的应用程序不能因 Azure 网络中断而访问其数据，您可以通过使用缓存的数据与应用程序功能减弱本地运行。</span><span class="sxs-lookup"><span data-stu-id="68218-250">If your application can't access its data because of an Azure network outage, you might be able to run locally with reduced application functionality by using cached data.</span></span>
- <span data-ttu-id="68218-251">您可能能够将数据存储在其他位置，直到连接恢复。</span><span class="sxs-lookup"><span data-stu-id="68218-251">You might be able to store data in an alternate location until connectivity is restored.</span></span>

## <a name="dependent-service-failure"></a><span data-ttu-id="68218-252">从属服务故障</span><span class="sxs-lookup"><span data-stu-id="68218-252">Dependent service failure</span></span>

<span data-ttu-id="68218-253">对于每个依赖服务，你应了解的服务中断以及应用程序将响应的方式的影响。</span><span class="sxs-lookup"><span data-stu-id="68218-253">For each dependent service, you should understand the implications of a service disruption and the way that the application will respond.</span></span> <span data-ttu-id="68218-254">许多服务包括支持复原能力和可用性，因此，单独评估每个服务可能会提高灾难恢复计划的功能。</span><span class="sxs-lookup"><span data-stu-id="68218-254">Many services include features that support resiliency and availability, so evaluating each service independently is likely to improve your disaster recovery plan.</span></span> <span data-ttu-id="68218-255">例如，Azure 事件中心支持[故障转移](/azure/event-hubs/event-hubs-geo-dr#setup-and-failover-flow)到辅助命名空间。</span><span class="sxs-lookup"><span data-stu-id="68218-255">For example, Azure Event Hubs supports [failing over](/azure/event-hubs/event-hubs-geo-dr#setup-and-failover-flow) to the secondary namespace.</span></span>

## <a name="region-wide-service-disruptions"></a><span data-ttu-id="68218-256">区域范围的服务中断</span><span class="sxs-lookup"><span data-stu-id="68218-256">Region-wide service disruptions</span></span>

<span data-ttu-id="68218-257">许多故障是同一个 Azure 区域内可管理的。</span><span class="sxs-lookup"><span data-stu-id="68218-257">Many failures are manageable within the same Azure region.</span></span> <span data-ttu-id="68218-258">但是，在不太可能事件中的全区域服务中断，你的数据的本地冗余副本不可用。</span><span class="sxs-lookup"><span data-stu-id="68218-258">However, in the unlikely event of a region-wide service disruption, the locally redundant copies of your data aren't available.</span></span> <span data-ttu-id="68218-259">如果已启用异地复制，有 blob 和表在不同区域中的 3 个副本。</span><span class="sxs-lookup"><span data-stu-id="68218-259">If you've enabled geo-replication, there are three additional copies of your blobs and tables in a different region.</span></span> <span data-ttu-id="68218-260">如果 Microsoft 声明区域丢失，Azure 将重新映射到次要区域的所有 DNS 条目。</span><span class="sxs-lookup"><span data-stu-id="68218-260">If Microsoft declares the region lost, Azure remaps all the DNS entries to the secondary region.</span></span>

> [!NOTE]
> <span data-ttu-id="68218-261">此过程仅对区域范围的服务中断的进行，不在控件内。</span><span class="sxs-lookup"><span data-stu-id="68218-261">This process occurs only for region-wide service disruptions and is not within your control.</span></span> <span data-ttu-id="68218-262">考虑使用 [Azure Site Recovery](/azure/site-recovery/) 获取更有利的 RPO 和 RTO。</span><span class="sxs-lookup"><span data-stu-id="68218-262">Consider using [Azure Site Recovery](/azure/site-recovery/) to achieve better RPO and RTO.</span></span> <span data-ttu-id="68218-263">使用 Site Recovery，决定什么是可接受的服务中断以及何时故障转移到复制的 Vm。</span><span class="sxs-lookup"><span data-stu-id="68218-263">Using Site Recovery, you decide what is an acceptable outage and when to fail over to the replicated VMs.</span></span>

<span data-ttu-id="68218-264">对区域范围的服务中断的响应取决于你的部署和灾难恢复计划。</span><span class="sxs-lookup"><span data-stu-id="68218-264">Your response to a region-wide service disruption depends on your deployment and your disaster recovery plan.</span></span>

- <span data-ttu-id="68218-265">作为一种成本控制策略，对于非关键应用程序不需要保证的恢复时间，可能会有用才能重新部署到不同的区域。</span><span class="sxs-lookup"><span data-stu-id="68218-265">As a cost-control strategy, for non-critical applications that don't require a guaranteed recovery time, it might make sense to redeploy to a different region.</span></span>
- <span data-ttu-id="68218-266">对于托管在与已部署角色的另一个区域中但不在区域间分布流量的应用程序 (*主动/被动部署*)，切换到备用区域中的辅助托管服务。</span><span class="sxs-lookup"><span data-stu-id="68218-266">For applications that are hosted in another region with deployed roles but don't distribute traffic across regions (*active/passive deployment*), switch to the secondary hosted service in the alternate region.</span></span>
- <span data-ttu-id="68218-267">对于在另一个区域中具有全面的辅助部署应用程序 (*主动/主动部署*)，将流量路由到该区域。</span><span class="sxs-lookup"><span data-stu-id="68218-267">For applications that have a full-scale secondary deployment in another region (*active/active deployment*), route traffic to that region.</span></span>

<span data-ttu-id="68218-268">若要了解有关的全区域服务中断后恢复的详细信息，请参阅[的全区域服务中断后恢复](../resiliency/recovery-loss-azure-region.md)。</span><span class="sxs-lookup"><span data-stu-id="68218-268">To learn more about recovering from a region-wide service disruption, see [Recover from a region-wide service disruption](../resiliency/recovery-loss-azure-region.md).</span></span>

### <a name="vm-recovery"></a><span data-ttu-id="68218-269">VM 恢复</span><span class="sxs-lookup"><span data-stu-id="68218-269">VM recovery</span></span>

<span data-ttu-id="68218-270">对于关键应用程序，计划发生区域范围的服务中断时恢复 Vm。</span><span class="sxs-lookup"><span data-stu-id="68218-270">For critical apps, plan for recovering VMs in the event of a region-wide service disruption.</span></span>

- <span data-ttu-id="68218-271">使用 Azure 备份或另一种备份方法来创建应用程序一致的跨区域备份。</span><span class="sxs-lookup"><span data-stu-id="68218-271">Use Azure Backup or another backup method to create cross-region backups that are application consistent.</span></span> <span data-ttu-id="68218-272">（备份保管库的复制必须在配置的创建时间。）</span><span class="sxs-lookup"><span data-stu-id="68218-272">(Replication of the Backup vault must be configured at the time of creation.)</span></span>
- <span data-ttu-id="68218-273">使用 Site Recovery 来复制跨区域进行一次单击应用程序故障转移和故障转移测试。</span><span class="sxs-lookup"><span data-stu-id="68218-273">Use Site Recovery to replicate across regions for one-click application failover and failover testing.</span></span>
- <span data-ttu-id="68218-274">使用流量管理器自动执行用户流量故障转移到另一个区域。</span><span class="sxs-lookup"><span data-stu-id="68218-274">Use Traffic Manager to automate user traffic failover to another region.</span></span>

<span data-ttu-id="68218-275">若要了解详细信息，请参阅[恢复的全区域服务中断后，虚拟机](../resiliency/recovery-loss-azure-region.md#virtual-machines)。</span><span class="sxs-lookup"><span data-stu-id="68218-275">To learn more, see [Recover from a region-wide service disruption, Virtual machines](../resiliency/recovery-loss-azure-region.md#virtual-machines).</span></span>

### <a name="storage-recovery"></a><span data-ttu-id="68218-276">存储恢复</span><span class="sxs-lookup"><span data-stu-id="68218-276">Storage recovery</span></span>

<span data-ttu-id="68218-277">若要在发生区域范围的服务中断时保护你的存储：</span><span class="sxs-lookup"><span data-stu-id="68218-277">To protect your storage in the event of a region-wide service disruption:</span></span>

- <span data-ttu-id="68218-278">使用异地冗余存储。</span><span class="sxs-lookup"><span data-stu-id="68218-278">Use geo-redundant storage.</span></span>
- <span data-ttu-id="68218-279">知道你的存储是异地复制。</span><span class="sxs-lookup"><span data-stu-id="68218-279">Know where your storage is geo-replicated.</span></span> <span data-ttu-id="68218-280">这会影响你在其中部署你需要与你的存储保持区域关系的数据的其他实例。</span><span class="sxs-lookup"><span data-stu-id="68218-280">This affects where you deploy other instances of your data that require regional affinity with your storage.</span></span>
- <span data-ttu-id="68218-281">故障转移后检查数据的一致性，并且如有必要，还原从备份。</span><span class="sxs-lookup"><span data-stu-id="68218-281">Check data for consistency after failover and, if necessary, restore from a backup.</span></span>

<span data-ttu-id="68218-282">若要了解详细信息，请参阅[设计高度可用的应用程序使用 RA-GRS](/azure/storage/common/storage-designing-ha-apps-with-ragrs)。</span><span class="sxs-lookup"><span data-stu-id="68218-282">To learn more, see [Designing highly available applications using RA-GRS](/azure/storage/common/storage-designing-ha-apps-with-ragrs).</span></span>

### <a name="sql-database-and-sql-server"></a><span data-ttu-id="68218-283">SQL 数据库和 SQL Server</span><span class="sxs-lookup"><span data-stu-id="68218-283">SQL Database and SQL Server</span></span>

<span data-ttu-id="68218-284">Azure SQL 数据库提供两种类型的恢复：</span><span class="sxs-lookup"><span data-stu-id="68218-284">Azure SQL Database provides two types of recovery:</span></span>

- <span data-ttu-id="68218-285">使用异地还原从另一个区域中的备份副本还原数据库。</span><span class="sxs-lookup"><span data-stu-id="68218-285">Use geo-restore to restore a database from a backup copy in another region.</span></span> <span data-ttu-id="68218-286">有关详细信息，请参阅[恢复 Azure SQL 数据库使用自动的数据库备份](/azure/sql-database/sql-database-recovery-using-backups)。</span><span class="sxs-lookup"><span data-stu-id="68218-286">For more information, see [Recover an Azure SQL database using automated database backups](/azure/sql-database/sql-database-recovery-using-backups).</span></span>
- <span data-ttu-id="68218-287">使用活动异地复制故障转移到辅助数据库。</span><span class="sxs-lookup"><span data-stu-id="68218-287">Use active geo-replication to fail over to a secondary database.</span></span> <span data-ttu-id="68218-288">有关详细信息，请参阅[创建和使用活动异地复制](/azure/sql-database/sql-database-active-geo-replication)。</span><span class="sxs-lookup"><span data-stu-id="68218-288">For more information, see [Creating and using active geo-replication](/azure/sql-database/sql-database-active-geo-replication).</span></span>

<span data-ttu-id="68218-289">在 Vm 上运行的 SQL Server，请参阅[的 Azure 虚拟机中 SQL Server 的高可用性和灾难恢复](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)。</span><span class="sxs-lookup"><span data-stu-id="68218-289">For SQL Server running on VMs, see [High availability and disaster recovery for SQL Server in Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

## <a name="service-specific-guidance"></a><span data-ttu-id="68218-290">服务特定指南</span><span class="sxs-lookup"><span data-stu-id="68218-290">Service-specific guidance</span></span>

<span data-ttu-id="68218-291">以下文章介绍了特定 Azure 服务的灾难恢复：</span><span class="sxs-lookup"><span data-stu-id="68218-291">The following articles describe disaster recovery for specific Azure services:</span></span>

| <span data-ttu-id="68218-292">服务</span><span class="sxs-lookup"><span data-stu-id="68218-292">Service</span></span>                       | <span data-ttu-id="68218-293">文章</span><span class="sxs-lookup"><span data-stu-id="68218-293">Article</span></span>                                                                                                                                                                                       |
|-------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="68218-294">Azure Database for MySQL</span><span class="sxs-lookup"><span data-stu-id="68218-294">Azure Database for MySQL</span></span>      | [<span data-ttu-id="68218-295">有关使用 Azure Database for MySQL 确保业务连续性的概述</span><span class="sxs-lookup"><span data-stu-id="68218-295">Overview of business continuity with Azure Database for MySQL</span></span>](/azure/mysql/concepts-business-continuity)                                                  |
| <span data-ttu-id="68218-296">Azure Database for PostgreSQL</span><span class="sxs-lookup"><span data-stu-id="68218-296">Azure Database for PostgreSQL</span></span> | [<span data-ttu-id="68218-297">有关使用 Azure Database for PostgreSQL 确保业务连续性的概述</span><span class="sxs-lookup"><span data-stu-id="68218-297">Overview of business continuity with Azure Database for PostgreSQL</span></span>](/azure/postgresql/concepts-business-continuity)                                        |
| <span data-ttu-id="68218-298">Azure 云服务</span><span class="sxs-lookup"><span data-stu-id="68218-298">Azure Cloud Services</span></span>          | [<span data-ttu-id="68218-299">发生影响 Azure 云服务的 Azure 服务中断时该怎么办</span><span class="sxs-lookup"><span data-stu-id="68218-299">What to do in the event of an Azure service disruption that impacts Azure Cloud Services</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance) |
| <span data-ttu-id="68218-300">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="68218-300">Cosmos DB</span></span>                     | [<span data-ttu-id="68218-301">使用 Azure Cosmos DB 的高可用性</span><span class="sxs-lookup"><span data-stu-id="68218-301">High availability with Azure Cosmos DB</span></span>](/azure/cosmos-db/high-availability)                                                                                |
| <span data-ttu-id="68218-302">Azure 密钥保管库</span><span class="sxs-lookup"><span data-stu-id="68218-302">Azure Key Vault</span></span>               | [<span data-ttu-id="68218-303">Azure Key Vault 可用性和冗余</span><span class="sxs-lookup"><span data-stu-id="68218-303">Azure Key Vault availability and redundancy</span></span>](/azure/key-vault/key-vault-disaster-recovery-guidance)                                                        |
| <span data-ttu-id="68218-304">Azure 存储</span><span class="sxs-lookup"><span data-stu-id="68218-304">Azure Storage</span></span>                 | [<span data-ttu-id="68218-305">Azure 存储中的灾难恢复和存储帐户故障转移（预览版）</span><span class="sxs-lookup"><span data-stu-id="68218-305">Disaster recovery and storage account failover (preview) in Azure Storage</span></span>](/azure/storage/common/storage-disaster-recovery-guidance)                       |
| <span data-ttu-id="68218-306">SQL 数据库</span><span class="sxs-lookup"><span data-stu-id="68218-306">SQL Database</span></span>                  | [<span data-ttu-id="68218-307">还原 Azure SQL 数据库或故障转移到次要区域</span><span class="sxs-lookup"><span data-stu-id="68218-307">Restore an Azure SQL Database or failover to a secondary region</span></span>](/azure/sql-database/sql-database-disaster-recovery)                                       |
| <span data-ttu-id="68218-308">虚拟机</span><span class="sxs-lookup"><span data-stu-id="68218-308">Virtual Machines</span></span>              | [<span data-ttu-id="68218-309">要执行 Azure 发生服务中断时影响 Azure 云</span><span class="sxs-lookup"><span data-stu-id="68218-309">What to do in the event of an Azure service disruption impacts Azure Cloud</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance)               |
| <span data-ttu-id="68218-310">Azure 虚拟网络</span><span class="sxs-lookup"><span data-stu-id="68218-310">Azure Virtual Network</span></span>         | [<span data-ttu-id="68218-311">虚拟网络 - 业务连续性</span><span class="sxs-lookup"><span data-stu-id="68218-311">Virtual Network – Business Continuity</span></span>](/azure/virtual-network/virtual-network-disaster-recovery-guidance)                                                  |

## <a name="next-steps"></a><span data-ttu-id="68218-312">后续步骤</span><span class="sxs-lookup"><span data-stu-id="68218-312">Next steps</span></span>

- [<span data-ttu-id="68218-313">从数据损坏或意外删除中恢复</span><span class="sxs-lookup"><span data-stu-id="68218-313">Recover from data corruption or accidental deletion</span></span>](../resiliency/recovery-data-corruption.md)
- [<span data-ttu-id="68218-314">全区域服务中断后恢复</span><span class="sxs-lookup"><span data-stu-id="68218-314">Recover from a region-wide service disruption</span></span>](../resiliency/recovery-loss-azure-region.md)