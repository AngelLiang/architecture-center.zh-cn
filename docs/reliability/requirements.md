---
title: 定义可复原的 Azure 应用程序的要求
description: 收集 Azure 应用程序的可用性和可恢复性要求的概述
author: MikeWasson
ms.date: 04/10/2019
ms.topic: article
ms.service: architecture-center
ms.subservice: cloud-design-principles
ms.openlocfilehash: 2af2ce4200c285abfda1395862d21efc3c17e577
ms.sourcegitcommit: 579c39ff4b776704ead17a006bf24cd4cdc65edd
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59646491"
---
# <a name="developing-requirements-for-resilient-azure-applications"></a>开发可复原的 Azure 应用程序的要求

构建*复原*（从故障中恢复） 和*可用性*（而无需大量的停机时间正常运行） 到你的应用开始与收集要求。 例如，长的停机时间是可接受？ 潜在的停机时间价格业务是多少？ 客户的可用性要求是什么？ 多少投入使你的应用程序具有高可用性？ 什么是风险和成本？

## <a name="identify-distinct-workloads"></a>标识不同的工作负载

云解决方案通常包括多个应用程序的*工作负荷*。 工作负荷是不同的功能或逻辑上独立于其他任务根据业务逻辑和数据存储需求的任务。 例如，电子商务应用可能具有以下工作负荷：

- 浏览和搜索产品目录。
- 创建和跟踪订单。
- 查看推荐商品。

每个工作负荷具有不同的可用性、 可伸缩性、 数据一致性和灾难恢复要求。 通过平衡成本与每个工作负载的风险使您的业务决策。

此外将工作负荷分解服务级别目标。 如果服务包含的关键并不太重要的工作负荷，以不同的方式对其进行管理，并指定服务功能和要满足其可用性要求所需的实例数。

## <a name="plan-for-usage-patterns"></a>使用模式的计划

在关键和非关键时段标识要求之间的差异。 系统是否必须在某些关键时段保持可用？ 例如，税务申报应用程序不能在申报截止时间期间失败和视频流服务不应在实时事件滞后。 在这些情况下，权衡成本与风险。

- 若要确保正常运行时间并满足服务级别协议 (Sla)，在关键时段，计划冗余跨多个区域以防出现故障时，即使它的成本的详细信息。
- 相反，在非关键时段，最小化成本在单个区域中运行应用程序。
- 在某些情况下，可以通过使用具有基于使用量的计费的新式无服务器技术降低其他费用。

## <a name="establish-availability-and-recovery-metrics"></a>建立可用性和恢复的度量值

创建两个集的度量值要求过程的一部分的基线号。 第一组可帮助你确定将冗余添加到云服务的位置，并为客户提供的服务级别协议。 第二个设置可帮助规划灾难恢复。

### <a name="availability-metrics"></a>可用性指标

这些度量值用于计划冗余和确定客户的 Sla。

- **平均恢复 (MTTR) 时间**是平均值所需的时间发生故障后还原一个组件。
- **平均无故障 (MTBF) 时间**是如何完成长时间组件可以合理期望到最后一个之间中断。

### <a name="recovery-metrics"></a>恢复指标

获得这些值的执行风险评估，并确保了解成本和停机时间和数据丢失的风险。 这是系统的非功能性要求，应符合业务要求。

- **恢复时间目标 (RTO)** 是应用程序是否在事件发生后不可用的最长可接受时间。
- **恢复点目标 (RPO)** 是在发生灾难期间是可接受的数据丢失的最大持续时间。

如果 MTTR 值*任何*高度可用的安装程序中的关键组件超过 RTO 的系统，在系统中的失败可能会导致不可接受的业务中断。 也就是说，不能还原系统中定义的 RTO。

## <a name="determine-workload-availability-targets"></a>确定工作负荷的可用性目标

在解决方案中定义自己的目标 Sla 为每个工作负荷，以便可以确定体系结构是否满足业务要求。

### <a name="consider-cost-and-complexity"></a>请考虑成本和复杂性

其他条件相同，更高的可用性是更好。 但是，如果追求更多九，增加的成本和复杂性。 99.99%的运行时间相当于大约五分钟内的每月总停机时间。 是否值得提高复杂性和成本来实现五个九？ 答案取决于业务要求。

下面是定义 SLA 时需要考虑的其他一些因素：

- 若要实现 4 个 9 （99.99%)，不能依赖于人工干预来从故障中恢复。 应用程序必须能够自我诊断和自我修复。
- 超过 4 个 9，却很难以足够快的速度检测服务中断，以便满足 SLA。
- 请考虑衡量 SLA 时所依据的时限。 该时限越小，容限就越严格。 它没有意义定义根据每小时或每日运行时间 SLA。
- 考虑 MTBF 和 MTTR 度量。 更高版本 SLA，频率越低服务可以向下去服务必须恢复更快。
- 获取来自客户的应用程序中，每个部分的可用性目标的协议，并记下此信息。 否则，您的设计可能不符合客户期望。

### <a name="identify-dependencies"></a>标识依赖项

执行依赖项映射练习来标识内部和外部依赖关系。 示例包括与安全或标识，如 Active Directory 或第三方服务，例如的支付提供商相关的依赖项，或消息传送服务发送电子邮件。

应特别注意到可能是单点故障或导致瓶颈的外部依赖项。 如果工作负荷需要 99.99%运行时间，但依赖于具有 99.9%的 SLA 的服务，该服务不能是系统的单一故障点。 一种补救措施是建立回退路径以防服务发生故障时。 或者，采取其他措施来从该服务中的失败中恢复。

下表显示了各个 SLA 级别的潜在累积停机时间。

| **SLA** | **每周故障时间** | **每月停机时间** | **每年的停机时间** |
|---------|-----------------------|------------------------|-----------------------|
| 99%     | 1.68 小时            | 7.2 小时              | 3.65 天             |
| 99.9%   | 10.1 分钟          | 43.2 分钟           | 8.76 小时            |
| 99.95%  | 5 分钟             | 21.6 分钟           | 4.38 小时            |
| 99.99%  | 1.01 分钟          | 4.32 分钟           | 52.56 分钟         |
| 99.999% | 6 秒             | 25.9 秒           | 5.26 分钟          |

## <a name="understand-service-level-agreements"></a>了解服务级别协议

在 Azure 中，[服务级别协议](https://azure.microsoft.com/en-us/support/legal/sla/)描述 Microsoft 的关于运行时间和连接承诺。 如果针对特定服务的 SLA 为 99.9%，你应期望服务能够在 99.9%的时间可用。 不同的服务具有不同 Sla。

Azure SLA 还包括用于获取的服务信用，如果不满足 SLA，以及特定的定义的预配*可用性*为每个服务。 SLA 的此项规定充当强制策略。

### <a name="composite-slas"></a>复合 SLA

*复合 Sla*涉及多个服务支持的应用程序，每个都有不同的可用性级别。 例如，考虑将写入到 Azure SQL 数据库的应用服务 web 应用。 在撰写本文时，这些 Azure 服务的 SLA 如下：

- 应用服务 web 应用 = 99.95%
- SQL 数据库 = 99.99%

此应用程序的预期最大停机时间是多少？ 如果任一服务发生故障，整个应用程序也会发生故障。 每个服务发生故障的概率是独立的因此为此应用程序的复合 SLA 为 99.95%× 99.99%= 99.94%。 这是比单个 Sla 更低的不让人意外，因为依赖于多个服务的应用程序具有更多的潜在故障点。

可以通过创建独立的回退路径来提高复合 SLA。 例如，如果 SQL 数据库不可用，将事务放入队列供以后处理。

![复合 SLA](_images/composite-sla.png)

如果采用这种设计，即使应用程序无法连接到数据库，它也能保持可用性。 但是，如果数据库和队列同时发生故障，则应用程序也会发生故障。 预期同时发生故障百分比是时间的 0.0001 × 0.001，因此此组合路径的复合 SLA 是时间的：

- 数据库*或*队列 = 1.0 − (0.0001 × 0.001) = 99.99999%

总复合 SLA 是：

- Web 应用*并*(数据库*或*队列) = 99.95%× 99.99999%= \~99.95%

有几个这种方法的缺点。 应用程序逻辑更复杂，因此需要支付队列，，您需要考虑数据一致性问题。

### <a name="slas-for-multiregion-deployments"></a>对于多区域部署的服务级别协议

*对于多区域部署的 Sla*涉及部署多个区域中的应用程序和使用 Azure 流量管理器在一个区域中的应用程序出现故障时故障转移的高可用性技术。

多区域部署的复合 SLA 的计算方式如下：

- *N*是在一个区域中部署的应用程序的复合 SLA。
- *R*是部署应用程序的区域数量。

应用程序失败，同时在所有区域中的预期的可能性是 ((1 − N) \^ R)。 例如，如果单区域 SLA 为 99.95%:

- 两个区域的组合的 SLA = (1 − （1 − 0.9995） \^ 2) = 99.999975%
- 四个区域的组合的 SLA = (1 − （1 − 0.9995） \^ 4) = 99.999999%

[流量管理器的 SLA](https://azure.microsoft.com/en-us/support/legal/sla/traffic-manager/v1_0/)也是一个因素。 故障转移不是在主动-被动配置中，这可能会导致在故障转移期间的停机时间瞬间完成的。 请参阅[流量管理器终结点监视和故障转移](/azure/traffic-manager/traffic-manager-monitoring)。

## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [架构师的弹性和可用性](./architect.md)
